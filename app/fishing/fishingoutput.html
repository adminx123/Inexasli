<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fishing Regulations Output</title>

  <!-- Preconnect and font links -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../styles/outputstyles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    .fishing-display {
      font-family: "Inter", sans-serif;
      font-size: 16px;
      line-height: 1.6;
      white-space: normal;
    }

    .fishing-header {
      text-align: center;
      margin-bottom: 25px;
    }

    .status-indicator {
      display: inline-block;
      padding: 8px 16px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 14px;
      margin-bottom: 15px;
    }

    .status-in-season {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status-out-season {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .regulations-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 25px;
    }

    .regulation-card {
      background: white;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .regulation-title {
      font-weight: 600;
      color: #2c3e50;
      margin-bottom: 10px;
      font-size: 18px;
    }

    .regulation-value {
      font-size: 16px;
      color: #34495e;
      margin-bottom: 8px;
    }

    .lure-section {
      background: #f8f9fa;
      border: 1px solid #dee2e6;
      border-radius: 8px;
      padding: 20px;
      margin-top: 20px;
    }

    .lure-title {
      font-weight: 600;
      color: #495057;
      margin-bottom: 15px;
      font-size: 18px;
    }

    .lure-list {
      list-style: none;
      padding: 0;
    }

    .lure-item {
      padding: 8px 0;
      border-bottom: 1px solid #e9ecef;
    }

    .lure-item:last-child {
      border-bottom: none;
    }

    .species-banner {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 20px;
      border-radius: 8px;
      text-align: center;
      margin-bottom: 25px;
    }

    .species-name {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .query-type {
      font-size: 14px;
      opacity: 0.9;
    }
  </style>
</head>

<body>
  <div class="device-container">
    <div class="output-wrapper">
      <div class="api-output">
        <div class="fishing-display">
          <div class="fishing-header">
            <h1>Fishing Regulations Check</h1>
            <p>BC Canada Fishing Information</p>
          </div>

          <!-- Species Identification Banner -->
          <div class="species-banner" id="species-banner">
            <div class="species-name" id="species-name">Loading...</div>
            <div class="query-type" id="query-type">Analyzing your fishing data</div>
          </div>

          <!-- Season Status -->
          <div id="season-status" style="text-align: center; display: none;">
            <div class="status-indicator" id="season-indicator">
              Checking season status...
            </div>
          </div>

          <!-- Regulations Grid -->
          <div class="regulations-grid" id="regulations-grid">
            <!-- Regulations will be populated here -->
          </div>

          <!-- Lure Recommendations (only for planning) -->
          <div class="lure-section" id="lure-section" style="display: none;">
            <div class="lure-title">
              <i class="fas fa-fish"></i> Recommended Lures & Techniques
            </div>
            <ul class="lure-list" id="lure-list">
              <!-- Lure recommendations will be populated here -->
            </ul>
          </div>

          <!-- Loading State -->
          <div id="loading-state" style="text-align: center; padding: 40px;">
            <i class="fas fa-spinner fa-spin" style="font-size: 24px; color: #667eea;"></i>
            <p style="margin-top: 15px; color: #666;">Analyzing fishing regulations...</p>
          </div>

          <!-- Error State -->
          <div id="error-state" style="display: none; text-align: center; padding: 40px;">
            <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: #dc3545;"></i>
            <p style="margin-top: 15px; color: #dc3545;" id="error-message">Unable to load fishing information</p>
          </div>
        </div>
      </div>

      <!-- Navigation -->
      <div class="navigation-buttons">
        <button class="nav-button secondary" onclick="window.location.href='fishingiq.html'">
          <i class="fas fa-arrow-left"></i> New Search
        </button>
        <button class="nav-button primary" onclick="window.location.href='../categories.html'">
          <i class="fas fa-home"></i> Home
        </button>
      </div>
    </div>
  </div>

  <script>
    // Utility functions are available globally via window
    const getLocal = window.getLocal;

    // Load and display fishing results
    document.addEventListener('DOMContentLoaded', async function() {
      try {
        // Get stored results
        const fishingResults = getLocal('fishingResults');

        if (!fishingResults) {
          showError('No fishing data found. Please complete the fishing form first.');
          return;
        }

        // Display results
        displayFishingResults(fishingResults);

      } catch (error) {
        console.error('Error loading fishing results:', error);
        showError('Failed to load fishing results. Please try again.');
      }
    });

    function displayFishingResults(data) {
      hideLoading();

      // Update species banner
      const speciesName = document.getElementById('species-name');
      const queryType = document.getElementById('query-type');

      if (data.intent === 'caught') {
        speciesName.textContent = data.species || 'Unknown Species';
        queryType.textContent = 'Fish Identification & Regulations';
      } else {
        speciesName.textContent = data.species || 'Target Species';
        queryType.textContent = 'Fishing Planning & Regulations';
      }

      // Update season status
      if (data.seasonStatus) {
        const seasonIndicator = document.getElementById('season-indicator');
        const seasonContainer = document.getElementById('season-status');

        seasonContainer.style.display = 'block';

        if (data.seasonStatus.toLowerCase().includes('in season')) {
          seasonIndicator.className = 'status-indicator status-in-season';
          seasonIndicator.innerHTML = '<i class="fas fa-check-circle"></i> In Season';
        } else {
          seasonIndicator.className = 'status-indicator status-out-season';
          seasonIndicator.innerHTML = '<i class="fas fa-times-circle"></i> Out of Season';
        }
      }

      // Display regulations
      const regulationsGrid = document.getElementById('regulations-grid');

      const regulations = [
        { title: 'Minimum Length', value: data.minLength || 'Check local regulations' },
        { title: 'Minimum Weight', value: data.minWeight || 'Check local regulations' },
        { title: 'Daily Bag Limit', value: data.bagLimit || 'Check local regulations' },
        { title: 'Special Regulations', value: data.regulations || 'No special restrictions noted' }
      ];

      regulations.forEach(reg => {
        const card = document.createElement('div');
        card.className = 'regulation-card';
        card.innerHTML = `
          <div class="regulation-title">${reg.title}</div>
          <div class="regulation-value">${reg.value}</div>
        `;
        regulationsGrid.appendChild(card);
      });

      // Display lure recommendations (only for planning)
      if (data.intent === 'planning' && data.lures) {
        const lureSection = document.getElementById('lure-section');
        const lureList = document.getElementById('lure-list');

        lureSection.style.display = 'block';

        if (Array.isArray(data.lures)) {
          data.lures.forEach(lure => {
            const item = document.createElement('li');
            item.className = 'lure-item';
            item.textContent = lure;
            lureList.appendChild(item);
          });
        } else {
          const item = document.createElement('li');
          item.className = 'lure-item';
          item.textContent = data.lures;
          lureList.appendChild(item);
        }
      }
    }

    function hideLoading() {
      document.getElementById('loading-state').style.display = 'none';
    }

    function showError(message) {
      hideLoading();
      const errorState = document.getElementById('error-state');
      const errorMessage = document.getElementById('error-message');

      errorMessage.textContent = message;
      errorState.style.display = 'block';
    }
  </script>
</body>
</html>
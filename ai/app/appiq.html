

  <div class="row1">
    <label class="category-label">App Purpose</label>
    <textarea id="app-purpose" rows="4" placeholder="e.g., task management"></textarea>
  </div>
  <div class="row1">
    <label class="category-label">Development Status</label>
    <div class="grid-container" id="app-code-status">
      <div class="grid-item" data-value="code-started">I Have Code Started</div>
      <div class="grid-item" data-value="no-code">I Have No Code</div>
    </div>
  </div>
  <div class="row1">
    <label class="category-label">App Features</label>
    <div class="grid-container" id="app-features">
      <div class="grid-item" data-value="Notifications">I Want Notifications</div>
      <div class="grid-item" data-value="User Accounts">I Want User Accounts</div>
      <div class="grid-item" data-value="Payments">I Want Payments</div>
      <div class="grid-item" data-value="Offline Mode">I Want Offline Mode</div>
      <div class="grid-item" data-value="Contact Form">I Want a Contact Form</div>
      <div class="grid-item" data-value="Mobile Responsiveness">I Want Mobile Responsiveness</div>
      <div class="grid-item" data-value="About Us">I Want About Us</div>
      <div class="grid-item" data-value="E-commerce Platform">I Want an E-commerce Platform</div>
      <div class="grid-item" data-value="Payment Gateway">I Want a Payment Gateway</div>
      <div class="grid-item" data-value="Gallery">I Want a Gallery</div>
      <div class="grid-item" data-value="Social Media Integration">I Want Social Media Integration</div>
      <div class="grid-item" data-value="Testimonials">I Want Testimonials</div>
      <div class="grid-item" data-value="FAQ Section">I Want an FAQ Section</div>
      <div class="grid-item" data-value="Blog Integration">I Want Blog Integration</div>
      <div class="grid-item" data-value="Custom Graphics">I Want Custom Graphics</div>
      <div class="grid-item" data-value="Calculation Functionality">I Want Calculation Functionality</div>
      <div class="grid-item" data-value="Event Calendar">I Want an Event Calendar</div>
    </div>
  </div>
  <div class="row1">
    <label class="category-label">Target Platform</label>
    <textarea id="app-platform" rows="1" placeholder="e.g., iOS, Android"></textarea>
  </div>
  <div class="row1">
    <label class="category-label">Budget</label>
    <textarea id="app-budget" rows="1" placeholder="e.g., $5000"></textarea>
  </div>
  <div class="row1">
    <label class="category-label">Timeline</label>
    <textarea id="app-timeline" rows="1" placeholder="e.g., 3 months"></textarea>
  </div>
  <button class="generate-btn" id="generate-app-btn">Generate App Plan Now!</button>
  <button class="clear-btn" id="clear-app-btn">Clear All</button>

  <script>
  /*
   * Copyright (c) 2025 INEXASLI. All rights reserved.
   * This code is protected under Canadian and international copyright laws.
   * Unauthorized use, reproduction, distribution, or modification of this code 
   * without explicit written permission via email from info@inexasli.com 
   * is strictly prohibited. Violators will be pursued and prosecuted to the 
   * fullest extent of the law in British Columbia, Canada, and applicable 
   * jurisdictions worldwide.
  */
  (function() {
    console.log("App IQ script initializing");

    // JSON storage helpers
    const setJSON = window.setJSON || function(name, value) {
      try {
        if (!name) return false;
        if (value === undefined) { localStorage.removeItem(name); return true; }
        localStorage.setItem(name, JSON.stringify(value));
        console.log(`[AppIQ] JSON saved ${name}`);
        return true;
      } catch (e) { console.error(`[AppIQ] Error storing JSON: ${e}`); return false; }
    };
    const getJSON = window.getJSON || function(name, defaultValue) {
      try {
        const item = localStorage.getItem(name);
        return item ? JSON.parse(item) : defaultValue;
      } catch (e) { console.error(`[AppIQ] Error retrieving JSON: ${e}`); return defaultValue; }
    };

    function customToggleGridItem(event) {
      event.stopPropagation(); event.preventDefault();
      const container = this.closest('.grid-container');
      // Single-selection for code status, multi-selection for features
      if (container.id === 'app-code-status') {
        container.querySelectorAll('.grid-item').forEach(i => i.classList.remove('selected'));
        this.classList.add('selected');
      } else {
        this.classList.toggle('selected');
      }
      saveGridItem(this);
      console.log(`[AppIQ] Toggled ${this.dataset.value} in ${container.id}`);
    }

    function saveGridItem(item) {
      console.log('[AppIQ] Saving all form data to JSON');
      setJSON('appIqInput', collectFormData());
    }

    function saveInput(input) {
      console.log('[AppIQ] Saving all form data to JSON');
      setJSON('appIqInput', collectFormData());
    }

    function collectFormData() {
      const formData = { purpose: null, codeStatus: null, features: [], platform: null, budget: null, timeline: null };
      const purposeEl = document.getElementById('app-purpose');
      if (purposeEl && purposeEl.value.trim()) formData.purpose = purposeEl.value.trim();
      const codeEl = document.querySelector('#app-code-status .grid-item.selected');
      if (codeEl) formData.codeStatus = codeEl.dataset.value;
      document.querySelectorAll('#app-features .grid-item.selected').forEach(i => formData.features.push(i.dataset.value));
      ['platform','budget','timeline'].forEach(field => {
        const el = document.getElementById(`app-${field}`);
        if (el && el.value.trim()) formData[field] = el.value.trim();
      });
      return formData;
    }

    function repopulateForm() {
      console.log('[AppIQ] Repopulating form from JSON storage');
      const data = getJSON('appIqInput', null);
      if (!data) return;
      if (data.purpose) document.getElementById('app-purpose').value = data.purpose;
      if (data.codeStatus) document.querySelector(`#app-code-status .grid-item[data-value="${data.codeStatus}"]`)?.classList.add('selected');
      data.features?.forEach(v => document.querySelector(`#app-features .grid-item[data-value="${v}"]`)?.classList.add('selected'));
      ['platform','budget','timeline'].forEach(f => {
        const el = document.getElementById(`app-${f}`);
        if (el && data[f]) el.value = data[f];
      });
    }

    function setupInputHandlers() {
      document.querySelectorAll('input, textarea, select').forEach(i => i.addEventListener('change', () => saveInput(i)));
    }

    function clearLocalStorage() {
      if (!confirm('Are you sure you want to clear all saved data? This action cannot be undone.')) return;
      localStorage.removeItem('appIqInput');
      localStorage.removeItem('appIqResponse');
      document.querySelectorAll('.grid-container .grid-item').forEach(i => i.classList.remove('selected'));
      document.querySelectorAll('input, textarea').forEach(i => i.value = '');
      document.querySelectorAll('select').forEach(s => s.selectedIndex = 0);
    }

    async function handleGenerateAppIq() {
      const btn = document.getElementById('generate-app-btn');
      const initText = btn.innerText;
      btn.innerText = 'Loading...'; btn.disabled = true;
      try {
        const formData = getJSON('appIqInput');
        if (!formData) { alert('Please complete the form before generating an app plan.'); throw new Error('No input data'); }
        const apiUrl = 'https://app.4hm7q4q75z.workers.dev/';
        const resp = await fetch(apiUrl, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(formData) });
        if (!resp.ok) throw new Error(`HTTP error! Status: ${resp.status}`);
        const data = await resp.json();
        setJSON('appIqResponse', data);
        btn.innerText = 'Success!'; setTimeout(() => btn.disabled = false, 1000);
        document.dispatchEvent(new CustomEvent('api-response-received', { detail: { module: 'appiq', type: 'worker-response', timestamp: Date.now() } }));
      } catch (e) {
        console.error('[AppIQ] Error:', e);
        alert('An error occurred while generating your app plan.');
        btn.innerText = 'Error'; setTimeout(() => { btn.innerText = initText; btn.disabled = false; }, 2000);
      }
    }

    function setupButtonHandlers() {
      document.getElementById('generate-app-btn').addEventListener('click', handleGenerateAppIq);
      document.getElementById('clear-app-btn').addEventListener('click', clearLocalStorage);
    }

    function initialize() {
      console.log('[AppIQ] Initializing...');
      document.querySelectorAll('.grid-container .grid-item').forEach(i => i.addEventListener('click', customToggleGridItem, { capture: true }));
      setupInputHandlers(); setupButtonHandlers(); repopulateForm();
    }

    initialize();
    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', initialize);
    document.addEventListener('data-in-loaded', () => setTimeout(initialize, 100));

    window.appIq = { initialize, saveGridItem, saveInput, clearLocalStorage, getFormData: collectFormData };
  })();
  </script>

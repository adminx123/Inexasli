<!--
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
-->

  <a href="/ai/landing/landing.html">
    <img src="/images/apple-touch-icon.png" alt="Logo" style="width: 25px; height: auto; display: block; margin: 15px;">
  </a>

  <div class="row1">
    <label class="category-label">Primary Goal</label>
    <select id="app-primary-goal">
      <option value="mobile-app">Mobile App Development</option>
      <option value="web-app">Web App Development</option>
      <option value="cross-platform">Cross-Platform App Development</option>
      <option value="enterprise">Enterprise App Solution</option>
      <option value="prototype">App Prototype</option>
      <option value="mvp">Minimum Viable Product</option>
      <option value="redesign">App Redesign/Update</option>
    </select>
  </div>
  <div class="row1">
    <label class="category-label">App Purpose</label>
    <textarea id="app-purpose" rows="4" placeholder="e.g., task management"></textarea>
  </div>
  <div class="row1">
    <label class="category-label">Development Status</label>
    <div class="grid-container" id="app-code-status">
      <div class="grid-item" data-value="code-started">I Have Code Started</div>
      <div class="grid-item" data-value="no-code">I Have No Code</div>
    </div>
  </div>
  <div class="row1">
    <label class="category-label">Sub-Scope Preferences</label>
    <div class="grid-container" id="app-features">
      <div class="grid-item" data-value="Notifications">I Want Notifications</div>
      <div class="grid-item" data-value="User Accounts">I Want User Accounts</div>
      <div class="grid-item" data-value="Payments">I Want Payments</div>
      <div class="grid-item" data-value="Offline Mode">I Want Offline Mode</div>
      <div class="grid-item" data-value="Contact Form">I Want a Contact Form</div>
      <div class="grid-item" data-value="Mobile Responsiveness">I Want Mobile Responsiveness</div>
      <div class="grid-item" data-value="About Us">I Want About Us</div>
      <div class="grid-item" data-value="E-commerce Platform">I Want an E-commerce Platform</div>
      <div class="grid-item" data-value="Payment Gateway">I Want a Payment Gateway</div>
      <div class="grid-item" data-value="Gallery">I Want a Gallery</div>
      <div class="grid-item" data-value="Social Media Integration">I Want Social Media Integration</div>
      <div class="grid-item" data-value="Testimonials">I Want Testimonials</div>
      <div class="grid-item" data-value="FAQ Section">I Want an FAQ Section</div>
      <div class="grid-item" data-value="Blog Integration">I Want Blog Integration</div>
      <div class="grid-item" data-value="Custom Graphics">I Want Custom Graphics</div>
      <div class="grid-item" data-value="Calculation Functionality">I Want Calculation Functionality</div>
      <div class="grid-item" data-value="Event Calendar">I Want an Event Calendar</div>
    </div>
  </div>
  <div class="row1">
    <label class="category-label">Scope</label>
    <textarea id="app-platform" rows="1" placeholder="e.g., iOS, Android"></textarea>
  </div>
  <div class="row1">
    <label class="category-label">Budget</label>
    <textarea id="app-budget" rows="1" placeholder="e.g., $5000"></textarea>
  </div>
  <div class="row1">
    <label class="category-label">Timeline</label>
    <textarea id="app-timeline" rows="1" placeholder="e.g., 3 months"></textarea>
  </div>
  <div class="row1">
    <label class="category-label">Synthesis Instructions</label>
    <select id="app-synthesis">
      <option value="phased-approach">Phased Development Approach</option>
      <option value="tech-focused">Technology-Focused Plan</option>
      <option value="feature-priority">Feature Priority Roadmap</option>
      <option value="cost-breakdown">Cost Breakdown Structure</option>
      <option value="timeline-focused">Timeline-Focused Plan</option>
      <option value="comprehensive">Comprehensive Development Plan</option>
    </select>
  </div>
  <div class="row1">
    <label class="category-label">Output Preferences</label>
    <select id="app-output-format">
      <option value="detailed-plan">Detailed Technical Plan</option>
      <option value="executive-summary">Executive Summary</option>
      <option value="bullet-points">Bullet Point Summary</option>
      <option value="visual-timeline">Visual Timeline</option>
      <option value="budget-breakdown">Budget Breakdown</option>
      <option value="technical-specs">Technical Specifications</option>
    </select>
  </div>
  <div class="row1">
    <label class="category-label">Additional Details</label>
    <textarea id="app-additional-details" rows="3" placeholder="Any special requirements or preferences for your app development plan:
Need accessibility features
Focus on data security
Include third-party integration options"></textarea>
  </div>
  <button class="generate-btn" id="generate-app-btn">Generate App Plan Now!</button>
  <button class="clear-btn" id="clear-app-btn">Clear All</button>

  <script>
  /*
   * Copyright (c) 2025 INEXASLI. All rights reserved.
   * This code is protected under Canadian and international copyright laws.
   * Unauthorized use, reproduction, distribution, or modification of this code 
   * without explicit written permission via email from info@inexasli.com 
   * is strictly prohibited. Violators will be pursued and prosecuted to the 
   * fullest extent of the law in British Columbia, Canada, and applicable 
   * jurisdictions worldwide.
  */
  (function() {
    console.log("App IQ script initializing");

    // JSON storage helpers
    const setJSON = window.setJSON || function(name, value) {
      try {
        if (!name) return false;
        if (value === undefined) { localStorage.removeItem(name); return true; }
        localStorage.setItem(name, JSON.stringify(value));
        console.log(`[AppIQ] JSON saved ${name}`);
        return true;
      } catch (e) { console.error(`[AppIQ] Error storing JSON: ${e}`); return false; }
    };
    const getJSON = window.getJSON || function(name, defaultValue) {
      try {
        const item = localStorage.getItem(name);
        return item ? JSON.parse(item) : defaultValue;
      } catch (e) { console.error(`[AppIQ] Error retrieving JSON: ${e}`); return defaultValue; }
    };

    function customToggleGridItem(event) {
      event.stopPropagation(); event.preventDefault();
      const container = this.closest('.grid-container');
      // Single-selection for code status, multi-selection for features
      if (container.id === 'app-code-status') {
        container.querySelectorAll('.grid-item').forEach(i => i.classList.remove('selected'));
        this.classList.add('selected');
      } else {
        this.classList.toggle('selected');
      }
      saveGridItem(this);
      console.log(`[AppIQ] Toggled ${this.dataset.value} in ${container.id}`);
    }

    function saveGridItem(item) {
      console.log('[AppIQ] Saving all form data to JSON');
      setJSON('appIqInput', collectFormData());
    }

    function saveInput(input) {
      console.log('[AppIQ] Saving all form data to JSON');
      setJSON('appIqInput', collectFormData());
    }

    function collectFormData() {
      const formData = { 
        primaryGoal: null,
        purpose: null, 
        codeStatus: null, 
        features: [], 
        platform: null, 
        budget: null, 
        timeline: null, 
        synthesis: null, 
        outputFormat: null,
        additionalDetails: null 
      };
      
      // Get primaryGoal from select element
      const primaryGoalEl = document.getElementById('app-primary-goal');
      if (primaryGoalEl && primaryGoalEl.value) formData.primaryGoal = primaryGoalEl.value;
      
      // Get purpose from textarea
      const purposeEl = document.getElementById('app-purpose');
      if (purposeEl && purposeEl.value.trim()) formData.purpose = purposeEl.value.trim();
      
      // Get code status from grid selection
      const codeEl = document.querySelector('#app-code-status .grid-item.selected');
      if (codeEl) formData.codeStatus = codeEl.dataset.value;
      
      // Get features from grid (multi-select)
      document.querySelectorAll('#app-features .grid-item.selected').forEach(i => formData.features.push(i.dataset.value));
      
      // Get platform/scope from textarea
      const platformEl = document.getElementById('app-platform');
      if (platformEl && platformEl.value.trim()) formData.platform = platformEl.value.trim();
      
      // Get budget from textarea
      const budgetEl = document.getElementById('app-budget');
      if (budgetEl && budgetEl.value.trim()) formData.budget = budgetEl.value.trim();
      
      // Get timeline from textarea
      const timelineEl = document.getElementById('app-timeline');
      if (timelineEl && timelineEl.value.trim()) formData.timeline = timelineEl.value.trim();
      
      // Get synthesis instructions from select
      const synthesisEl = document.getElementById('app-synthesis');
      if (synthesisEl && synthesisEl.value) formData.synthesis = synthesisEl.value;
      
      // Get output format from select
      const outputFormatEl = document.getElementById('app-output-format');
      if (outputFormatEl && outputFormatEl.value) formData.outputFormat = outputFormatEl.value;
      
      // Get additional details from textarea
      const additionalDetailsEl = document.getElementById('app-additional-details');
      if (additionalDetailsEl && additionalDetailsEl.value.trim()) formData.additionalDetails = additionalDetailsEl.value.trim();
      
      return formData;
    }

    function repopulateForm() {
      console.log('[AppIQ] Repopulating form from JSON storage');
      const data = getJSON('appIqInput', null);
      if (!data) return;
      
      // Repopulate primary goal select
      if (data.primaryGoal) {
        const primaryGoalEl = document.getElementById('app-primary-goal');
        if (primaryGoalEl) primaryGoalEl.value = data.primaryGoal;
      }
      
      // Repopulate purpose textarea
      if (data.purpose) {
        const purposeEl = document.getElementById('app-purpose');
        if (purposeEl) purposeEl.value = data.purpose;
      }
      
      // Repopulate code status grid selection
      if (data.codeStatus) {
        const codeStatusEl = document.querySelector(`#app-code-status .grid-item[data-value="${data.codeStatus}"]`);
        if (codeStatusEl) codeStatusEl.classList.add('selected');
      }
      
      // Repopulate features (multi-select grid)
      if (data.features && Array.isArray(data.features)) {
        data.features.forEach(feature => {
          const featureEl = document.querySelector(`#app-features .grid-item[data-value="${feature}"]`);
          if (featureEl) featureEl.classList.add('selected');
        });
      }
      
      // Repopulate simple text fields
      ['platform', 'budget', 'timeline'].forEach(field => {
        if (data[field]) {
          const el = document.getElementById(`app-${field}`);
          if (el) el.value = data[field];
        }
      });
      
      // Repopulate synthesis select
      if (data.synthesis) {
        const synthesisEl = document.getElementById('app-synthesis');
        if (synthesisEl) synthesisEl.value = data.synthesis;
      }
      
      // Repopulate output format select
      if (data.outputFormat) {
        const outputFormatEl = document.getElementById('app-output-format');
        if (outputFormatEl) outputFormatEl.value = data.outputFormat;
      }
      
      // Repopulate additional details textarea
      if (data.additionalDetails) {
        const additionalDetailsEl = document.getElementById('app-additional-details');
        if (additionalDetailsEl) additionalDetailsEl.value = data.additionalDetails;
      }
    }

    function setupInputHandlers() {
      document.querySelectorAll('input, textarea, select').forEach(i => i.addEventListener('change', () => saveInput(i)));
    }

    function clearLocalStorage() {
      if (!confirm('Are you sure you want to clear all saved data? This action cannot be undone.')) return;
      localStorage.removeItem('appIqInput');
      localStorage.removeItem('appIqResponse');
      document.querySelectorAll('.grid-container .grid-item').forEach(i => i.classList.remove('selected'));
      document.querySelectorAll('input, textarea').forEach(i => i.value = '');
      document.querySelectorAll('select').forEach(s => s.selectedIndex = 0);
    }

    async function handleGenerateAppIq() {
      const btn = document.getElementById('generate-app-btn');
      const initText = btn.innerText;
      btn.innerText = 'Loading...'; btn.disabled = true;
      try {
        const formData = getJSON('appIqInput');
        if (!formData) { alert('Please complete the form before generating an app plan.'); throw new Error('No input data'); }
        const apiUrl = 'https://app.4hm7q4q75z.workers.dev/';
        const resp = await fetch(apiUrl, { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify(formData) });
        if (!resp.ok) throw new Error(`HTTP error! Status: ${resp.status}`);
        const data = await resp.json();
        setJSON('appIqResponse', data);
        btn.innerText = 'Success!'; setTimeout(() => btn.disabled = false, 1000);
        document.dispatchEvent(new CustomEvent('api-response-received', { detail: { module: 'appiq', type: 'worker-response', timestamp: Date.now() } }));
      } catch (e) {
        console.error('[AppIQ] Error:', e);
        alert('An error occurred while generating your app plan.');
        btn.innerText = 'Error'; setTimeout(() => { btn.innerText = initText; btn.disabled = false; }, 2000);
      }
    }

    function setupButtonHandlers() {
      document.getElementById('generate-app-btn').addEventListener('click', handleGenerateAppIq);
      document.getElementById('clear-app-btn').addEventListener('click', clearLocalStorage);
    }

    function initialize() {
      console.log('[AppIQ] Initializing...');
      document.querySelectorAll('.grid-container .grid-item').forEach(i => i.addEventListener('click', customToggleGridItem, { capture: true }));
      setupInputHandlers(); setupButtonHandlers(); repopulateForm();
    }

    initialize();
    if (document.readyState === 'loading') document.addEventListener('DOMContentLoaded', initialize);
    document.addEventListener('data-in-loaded', () => setTimeout(initialize, 100));

    window.appIq = { initialize, saveGridItem, saveInput, clearLocalStorage, getFormData: collectFormData };
  })();
  </script>
</body>
</html>

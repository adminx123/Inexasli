<!--
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
 -->

 <!DOCTYPE html>
 <html lang="en">
 <head>
     <link rel="manifest" href="/manifest.json">
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
     <title>IncomeIQ™ Intro</title>
     <link rel="stylesheet" href="/style/styles.css">
     <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
     <link rel="icon" type="image/png" href="/images/favicon-96x96.png" sizes="96x96" />
     <link rel="icon" type="image/svg+xml" href="/images/favicon.svg" />
     <link rel="shortcut icon" href="/images/favicon.ico" />
     <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" />
 </head>
 <body>

    <div class="containerinter">
   
     
    
         <div class="benefit-card">
             <h2 style="text-align:center">| IncomeIQ™ |</h2>
             <h2  style="text-align:center">Ready to Unlock the Power of Financial Clarity?</h2>
             <p>Save time and find relief—master your money fast with a free tool that cuts the bullshit and shows how income, expenses, and more click together.</p>       
             <p>Embrace the confidence of financial smarts with deeper insights into the four pillars of personal finances to play with—for education only, so you’re ready to team up with a pro for the real moves.</p>
         </div>  
     
 
     
         <h2 class="tooltip1" data-tooltip="Where you’re legally considered to live for tax purposes, based on factors like time spent or ties to the country.">
             Select Tax Residency<span class="tooltip1-content"></span>
         </h2>
         <div class="form-field">
             <select id="country" style="width: 345px; max-width: 100%; margin: 0 auto; display: block;">
                 <option value="">Select Country</option>
                 <option value="CAN">Canada</option>
                 <option value="USA">USA</option>
                 <option value="UK">United Kingdom</option>
                 <option value="AUS">Australia</option>
                 <option value="OTHER">Other</option>
             </select>
         </div>

         <div id="subregionContainer" style="display: block;">
             <div class="form-field">
                 <select id="subregion" style="width: 345px; max-width: 100%; margin: 0 auto; display: block; margin-top: 5px;">
                     <option value="">Select Tax Subregion</option>
                 </select>
             </div>
         </div>

         <div id="residencyStatus" style="display: block; ">
            <div class="form-field">
                <select 
                    id="residency" 
                    style="width: 345px; max-width: 100%; margin: 0 auto; display: block; margin-top: 5px;">
                    <option value="">Select Residency Status</option>
                    <option value="Full_Resident">Full Resident (Lived entire year, full taxes)</option>
                    <option value="Part_Year_Resident">Part-Year Resident (Lived part-year, partial taxes)</option>
                    <option value="Non_Resident">Non Resident (Not living here, some taxes)</option>
                    <option value="Temporary_Resident">Temporary Resident (Temporary stay, tax exemptions)</option>
                </select>
            </div>
        </div>
 
        <h2 class="tooltip1" data-tooltip="What your legally status is for tax purposes">
            Select Filing Status<span class="tooltip1-content"></span>
        </h2>
        <div style="width: 345px; max-width: 100%; margin: 0 auto; display: block;" id="filingStatusSection">
            <div id="filingStatusContainer" class="form-field" style="max-width: 345px; margin: 0 auto; text-align: center;">
                <select id="filingStatus" style="width: 345px; max-width: 100%; margin: 0 auto; display: block; padding: 8px;">
                    <option value="">Select Filing Status</option>
                    
                    <!-- Canada Options -->
                    <optgroup label="Canada" class="filing-group" id="filing-CAN">
                        <option value="single_no_dependants">Single, No Dependants</option>
                        <option value="single_with_dependants">Single with Dependants</option>
                        <option value="single_with_disabled_dependants">Single with Disabled Dependants</option>
                        <option value="single_self_disabled">Single, Self-Disabled</option>
                        <option value="single_caregiver">Single, Caregiver</option>
                        <option value="common_law_no_dependants">Common-Law, No Dependants</option>
                        <option value="common_law_with_dependants">Common-Law with Dependants</option>
                        <option value="common_law_with_disabled_dependants">Common-Law with Disabled Dependants</option>
                        <option value="common_law_self_disabled">Common-Law, Self-Disabled</option>
                        <option value="common_law_spouse_disabled">Common-Law, Spouse-Disabled</option>
                        <option value="common_law_caregiver">Common-Law, Caregiver</option>
                        <option value="married_no_dependants">Married, No Dependants</option>
                        <option value="married_with_dependants">Married with Dependants</option>
                        <option value="married_with_disabled_dependants">Married with Disabled Dependants</option>
                        <option value="married_self_disabled">Married, Self-Disabled</option>
                        <option value="married_spouse_disabled">Married, Spouse-Disabled</option>
                        <option value="married_caregiver">Married, Caregiver</option>
                        <option value="widowed_no_dependants">Widowed, No Dependants</option>
                        <option value="widowed_with_dependants">Widowed with Dependants</option>
                        <option value="widowed_with_disabled_dependants">Widowed with Disabled Dependants</option>
                        <option value="separated_no_dependants">Separated, No Dependants</option>
                        <option value="separated_with_dependants">Separated with Dependants</option>
                        <option value="separated_with_disabled_dependants">Separated with Disabled Dependants</option>
                    </optgroup>
                    
                    <!-- USA Options -->
                    <optgroup label="USA" class="filing-group" id="filing-USA">
                        <option value="single_no_dependants">Single, No Dependants</option>
                        <option value="single_with_dependants">Single with Dependants</option>
                        <option value="single_with_disabled_dependants">Single with Disabled Dependants</option>
                        <option value="single_self_disabled">Single, Self-Disabled</option>
                        <option value="single_caregiver">Single, Caregiver</option>
                        <option value="married_filing_jointly_no_dependants">Married Filing Jointly, No Dependants</option>
                        <option value="married_filing_jointly_with_dependants">Married Filing Jointly with Dependants</option>
                        <option value="married_filing_jointly_with_disabled_dependants">Married Filing Jointly with Disabled Dependants</option>
                        <option value="married_filing_jointly_self_disabled">Married Filing Jointly, Self-Disabled</option>
                        <option value="married_filing_jointly_spouse_disabled">Married Filing Jointly, Spouse-Disabled</option>
                        <option value="married_filing_jointly_caregiver">Married Filing Jointly, Caregiver</option>
                        <option value="married_filing_separately_no_dependants">Married Filing Separately, No Dependants</option>
                        <option value="married_filing_separately_with_dependants">Married Filing Separately with Dependants</option>
                        <option value="married_filing_separately_with_disabled_dependants">Married Filing Separately with Disabled Dependants</option>
                        <option value="married_filing_separately_self_disabled">Married Filing Separately, Self-Disabled</option>
                        <option value="head_of_household_no_dependants">Head of Household, No Dependants</option>
                        <option value="head_of_household_with_dependants">Head of Household with Dependants</option>
                        <option value="head_of_household_with_disabled_dependants">Head of Household with Disabled Dependants</option>
                        <option value="head_of_household_caregiver">Head of Household, Caregiver</option>
                        <option value="qualifying_widow_no_dependants">Qualifying Widow(er), No Dependants</option>
                        <option value="qualifying_widow_with_dependants">Qualifying Widow(er) with Dependants</option>
                        <option value="qualifying_widow_with_disabled_dependants">Qualifying Widow(er) with Disabled Dependants</option>
                    </optgroup>
                    
                    <!-- UK Options -->
                    <optgroup label="United Kingdom" class="filing-group" id="filing-UK">
                        <option value="single_no_dependants">Single, No Dependants</option>
                        <option value="single_with_dependants">Single with Dependants</option>
                        <option value="single_with_disabled_dependants">Single with Disabled Dependants</option>
                        <option value="single_self_disabled">Single, Self-Disabled</option>
                        <option value="single_caregiver">Single, Caregiver</option>
                        <option value="married_or_civil_partnership_no_dependants">Married or Civil Partnership, No Dependants</option>
                        <option value="married_or_civil_partnership_with_dependants">Married or Civil Partnership with Dependants</option>
                        <option value="married_or_civil_partnership_with_disabled_dependants">Married or Civil Partnership with Disabled Dependants</option>
                        <option value="married_or_civil_partnership_self_disabled">Married or Civil Partnership, Self-Disabled</option>
                        <option value="married_or_civil_partnership_spouse_disabled">Married or Civil Partnership, Spouse-Disabled</option>
                        <option value="married_or_civil_partnership_caregiver">Married or Civil Partnership, Caregiver</option>
                        <option value="widowed_no_dependants">Widowed, No Dependants</option>
                        <option value="widowed_with_dependants">Widowed with Dependants</option>
                        <option value="widowed_with_disabled_dependants">Widowed with Disabled Dependants</option>
                        <option value="separated_no_dependants">Separated, No Dependants</option>
                        <option value="separated_with_dependants">Separated with Dependants</option>
                        <option value="separated_with_disabled_dependants">Separated with Disabled Dependants</option>
                    </optgroup>
                    
                    <!-- Australia Options -->
                    <optgroup label="Australia" class="filing-group" id="filing-AUS">
                        <option value="single_no_dependants">Single, No Dependants</option>
                        <option value="single_with_dependants">Single with Dependants</option>
                        <option value="single_with_disabled_dependants">Single with Disabled Dependants</option>
                        <option value="single_self_disabled">Single, Self-Disabled</option>
                        <option value="single_caregiver">Single, Caregiver</option>
                        <option value="married_or_de_facto_no_dependants">Married or De Facto, No Dependants</option>
                        <option value="married_or_de_facto_with_dependants">Married or De Facto with Dependants</option>
                        <option value="married_or_de_facto_with_disabled_dependants">Married or De Facto with Disabled Dependants</option>
                        <option value="married_or_de_facto_self_disabled">Married or De Facto, Self-Disabled</option>
                        <option value="married_or_de_facto_spouse_disabled">Married or De Facto, Spouse-Disabled</option>
                        <option value="married_or_de_facto_caregiver">Married or De Facto, Caregiver</option>
                        <option value="widowed_no_dependants">Widowed, No Dependants</option>
                        <option value="widowed_with_dependants">Widowed with Dependants</option>
                        <option value="widowed_with_disabled_dependants">Widowed with Disabled Dependants</option>
                        <option value="separated_no_dependants">Separated, No Dependants</option>
                        <option value="separated_with_dependants">Separated with Dependants</option>
                        <option value="separated_with_disabled_dependants">Separated with Disabled Dependants</option>
                    </optgroup>
                    
                    <!-- Other Options -->
                    <optgroup label="Other" class="filing-group" id="filing-OTHER">
                        <option value="single_no_dependants">Single, No Dependants</option>
                        <option value="single_with_dependants">Single with Dependants</option>
                        <option value="single_with_disabled_dependants">Single with Disabled Dependants</option>
                        <option value="single_self_disabled">Single, Self-Disabled</option>
                        <option value="single_caregiver">Single, Caregiver</option>
                        <option value="coupled_no_dependants">Coupled, No Dependants</option>
                        <option value="coupled_with_dependants">Coupled with Dependants</option>
                        <option value="coupled_with_disabled_dependants">Coupled with Disabled Dependants</option>
                        <option value="coupled_self_disabled">Coupled, Self-Disabled</option>
                        <option value="coupled_spouse_disabled">Coupled, Spouse-Disabled</option>
                        <option value="coupled_caregiver">Coupled, Caregiver</option>
                        <option value="widowed_no_dependants">Widowed, No Dependants</option>
                        <option value="widowed_with_dependants">Widowed with Dependants</option>
                        <option value="widowed_with_disabled_dependants">Widowed with Disabled Dependants</option>
                        <option value="separated_no_dependants">Separated, No Dependants</option>
                        <option value="separated_with_dependants">Separated with Dependants</option>
                        <option value="separated_with_disabled_dependants">Separated with Disabled Dependants</option>
                    </optgroup>
                </select>
            </div>
        </div>
     
 
     <div class="specifics" style="display: none;">
         

            <h2 class="tooltip1" data-tooltip="Relevant personal information.">
                Select Personal Details<span class="tooltip1-content"></span>
            </h2>

             <div class="form-field">
                
                 <input type="number" placeholder="Your Age" inputmode="numeric" id="ageSelf" min="0" style="width: 345px; max-width: 100%; margin: 0 auto; display: block;">
             </div>

             <div class="form-field">
                 
                <select id="employmentStatus" style="width: 345px; max-width: 100%; margin: 0 auto; display: block; margin-top: 5px;">
                    <option value="">Select Your Employment Status</option>
                    <option value="employed">Employed</option>
                    <option value="self_employed">Self-Employed</option>
                    <option value="unemployed">Unemployed</option>
                    <option value="retired">Retired</option>
                    <option value="student">Student</option>
                </select>
            </div>
             
             <div class="spouseFields">
                 <div class="form-field">
                    
                     <input type="number" placeholder="Spouse Age" inputmode="numeric" id="ageSpouse" min="0" style="width: 345px; max-width: 100%; margin: 0 auto; display: block; margin-top: 5px;">
                 </div>
                 <div class="form-field">
                     <select id="employmentStatusSpouse" style="width: 345px; max-width: 100%; margin: 0 auto; display: block; margin-top: 5px;">
                         <option value="">Select Spouse Employment Status</option>
                         <option value="employed">Employed</option>
                         <option value="self_employed">Self-Employed</option>
                         <option value="unemployed">Unemployed</option>
                         <option value="retired">Retired</option>
                         <option value="student">Student</option>
                     </select>
                 </div>
             </div>
 
            
 
             <div class="dependantsContainer">
                 <div class="form-field">
                     <label for="birthYearDisabledDependants" class="category-label tooltip" data-tooltip="Enter the birth years of disabled dependants, separated by commas.">
                         Birth Years of Disabled Dependants<span class="tooltip-content"></span>
                     </label>
                     <textarea id="birthYearDisabledDependants" placeholder="e.g., 2005, 2010, 2015" style="width: 345px; max-width: 100%; margin: 0 auto; display: block;"></textarea>
                 </div>
             </div>
         </div>
     </div>
 
    
</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Polyfill for setLocal/getLocal if not present
    const setLocal = window.setLocal || function (key, value, days) {
        try { localStorage.setItem(key, encodeURIComponent(value)); } catch (e) { console.error(e); }
    };
    const getLocal = window.getLocal || function (key) {
        try { const v = localStorage.getItem(key); return v ? decodeURIComponent(v) : null; } catch (e) { return null; }
    };

    // Get DOM elements
    const countryDropdown = document.getElementById('country');
    const subregionDropdown = document.getElementById('subregion');
    const residency = document.getElementById('residency');
    const filingStatusDropdown = document.getElementById('filingStatus');
    const specificsDiv = document.querySelector('.specifics');
    const dependantsContainer = document.querySelector('.dependantsContainer');
    
    // Subregion Map
    const subregionMap = {
        CAN: ["Alberta", "British Columbia", "Manitoba", "New Brunswick", "Newfoundland and Labrador", "Nova Scotia", "Northwest Territories", "Nunavut", "Ontario", "Prince Edward Island", "Quebec", "Saskatchewan", "Yukon"],
        USA: ["Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado", "Connecticut", "Delaware", "Florida", "Georgia", "Hawaii", "Idaho", "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana", "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota", "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada", "New Hampshire", "New Jersey", "New Mexico", "New York", "North Carolina", "North Dakota", "Ohio", "Oklahoma", "Oregon", "Pennsylvania", "Rhode Island", "South Carolina", "South Dakota", "Tennessee", "Texas", "Utah", "Vermont", "Virginia", "Washington", "West Virginia", "Wisconsin", "Wyoming"],
        UK: ["England", "Scotland", "Wales", "Northern Ireland", "Greater London", "West Midlands", "South East", "North West", "East of England", "Yorkshire and The Humber", "South West", "East Midlands", "North East"],
        AUS: ["New South Wales", "Victoria", "Queensland", "South Australia", "Western Australia", "Tasmania", "Australian Capital Territory", "Northern Territory"],
        OTHER: ["Province", "State", "Region", "District", "Territory", "Prefecture", "County", "Municipality"]
    };
    
    // SIMPLIFIED: Show/hide filing status options based on country
    function updateFilingStatusOptions(country) {
        // Hide all option groups first
        document.querySelectorAll('#filingStatus optgroup').forEach(group => {
            group.style.display = 'none';
        });
        
        // Show only the relevant country's options
        if (country) {
            const targetGroup = document.getElementById(`filing-${country}`);
            if (targetGroup) {
                targetGroup.style.display = '';
            }
        }
        
        // Reset the filing status value when country changes
        filingStatusDropdown.value = '';
        setLocal('fillingStatus', '', 365);
        
        // Update visibility of dependent sections
        updateDependantsVisibility();
        updateMaritalStatusVisibility();
        updateSpecificsVisibility();
    }
    
    // Populate subregion dropdown based on selected country
    function updateSubregionDropdown(country) {
        subregionDropdown.innerHTML = '<option value="">Select Tax Subregion</option>';
        const savedSubregion = getLocal('selectedSubregion');
        
        if (country && subregionMap[country]) {
            subregionMap[country].forEach(subregionName => {
                const option = document.createElement('option');
                option.text = subregionName;
                option.value = subregionName;
                if (savedSubregion === subregionName) option.selected = true;
                subregionDropdown.appendChild(option);
            });
            document.getElementById('subregionContainer').style.display = 'block';
        } else {
            document.getElementById('subregionContainer').style.display = 'none';
        }
    }
    
    // Show/hide dependants container based on filing status
    function updateDependantsVisibility() {
        const selectedFilingStatus = filingStatusDropdown.value;
        const statusesWithDisabledDependants = [
            'single_with_disabled_dependants', 'widowed_with_disabled_dependants', 'separated_with_disabled_dependants',
            'married_with_disabled_dependants', 'common_law_with_disabled_dependants', 'coupled_with_disabled_dependants',
            'qualifying_widow_with_disabled_dependants', 'married_filing_jointly_with_disabled_dependants',
            'married_filing_separately_with_disabled_dependants', 'head_of_household_with_disabled_dependants',
            'married_or_civil_partnership_with_disabled_dependants', 'married_or_de_facto_with_disabled_dependants'
        ];
        
        dependantsContainer.style.display = statusesWithDisabledDependants.includes(selectedFilingStatus) ? 'block' : 'none';
    }
    
    // Show/hide spouse fields based on filing status
    function updateMaritalStatusVisibility() {
        const selectedFilingStatus = filingStatusDropdown.value;
        const singleStatuses = [
            'single_no_dependants', 'single_with_dependants', 'single_with_disabled_dependants', 'single_self_disabled', 'single_caregiver',
            'widowed_no_dependants', 'widowed_with_dependants', 'widowed_with_disabled_dependants', 'separated_no_dependants',
            'separated_with_dependants', 'separated_with_disabled_dependants', 'head_of_household_no_dependants',
            'head_of_household_with_dependants', 'head_of_household_with_disabled_dependants', 'head_of_household_caregiver',
            'qualifying_widow_no_dependants', 'qualifying_widow_with_dependants', 'qualifying_widow_with_disabled_dependants'
        ];
        
        document.querySelectorAll('.spouseFields').forEach(field => {
            field.style.display = singleStatuses.includes(selectedFilingStatus) || !selectedFilingStatus ? 'none' : 'block';
        });
    }
    
    // Show/hide personal details section based on filing status selection
    function updateSpecificsVisibility() {
        specificsDiv.style.display = filingStatusDropdown.value ? 'block' : 'none';
    }
    
    // Set up auto-transition when all required fields are filled
    function setupAutoTransition() {
        // Perform validation checks
        function validateAndTransition() {
            const country = countryDropdown.value;
            const subregion = subregionDropdown.value;
            const residencyValue = residency.value;
            const filingStatus = filingStatusDropdown.value;
            const ageSelf = document.getElementById('ageSelf').value;
            const ageSpouse = document.getElementById('ageSpouse').value;
            const employmentStatus = document.getElementById('employmentStatus').value;
            
            // Check if spouse fields are required based on filing status
            const spouseRequired = [
                'married_with_dependants','married_with_disabled_dependants','common_law_with_dependants',
                'common_law_with_disabled_dependants','married_filing_jointly_with_dependants',
                'married_filing_jointly_with_disabled_dependants','married_filing_separately_with_dependants',
                'married_filing_separately_with_disabled_dependants','married_no_dependants',
                'common_law_no_dependants','married_filing_jointly_no_dependants',
                'married_filing_separately_no_dependants','married_or_civil_partnership_no_dependants',
                'married_or_civil_partnership_with_dependants','married_or_de_facto_no_dependants',
                'married_or_de_facto_with_dependants','coupled_no_dependants','coupled_with_dependants'
            ].includes(filingStatus);
            
            // Perform validation checks
            if (!country || (!subregion && country !== 'OTHER') || !residencyValue || !filingStatus || 
                !ageSelf || !employmentStatus || (spouseRequired && !ageSpouse)) {
                return; // Not all required fields are filled
            }
            
            // All fields are valid, proceed to income tab
            // Get parent window (since this is loaded inside a container)
            const parentWindow = window.parent || window;
            
            // First, close the intro container
            const introContainer = parentWindow.document.querySelector('.data-container-intro');
            if (introContainer && introContainer.dataset.state === 'expanded') {
                const introClose = introContainer.querySelector('.close-data-container');
                if (introClose) {
                    introClose.click(); 
                }
            }
            
            // Wait a brief moment to ensure intro is closed
            setTimeout(() => {
                // Next, open the income container
                const incomeContainer = parentWindow.document.querySelector('.data-container-income');
                if (incomeContainer && incomeContainer.dataset.state === 'collapsed') {
                    const incomeLabel = incomeContainer.querySelector('.data-label');
                    if (incomeLabel) {
                        incomeLabel.click();
                    }
                }
            }, 300);
        }
        
        // Add event listeners to all form fields
        const formElements = [
            countryDropdown, subregionDropdown, residency, filingStatusDropdown,
            document.getElementById('ageSelf'), document.getElementById('ageSpouse'),
            document.getElementById('employmentStatus'), document.getElementById('employmentStatusSpouse')
        ];
        
        formElements.forEach(element => {
            if (element) {
                element.addEventListener('change', validateAndTransition);
            }
        });
        
        // Check immediately in case all fields are already filled
        setTimeout(validateAndTransition, 500);
    }
    
    // Initialize - restore saved values
    function initializeForm() {
        // Restore saved country and update related fields
        if (getLocal('selectedCountry')) {
            countryDropdown.value = getLocal('selectedCountry');
            updateSubregionDropdown(countryDropdown.value);
            updateFilingStatusOptions(countryDropdown.value);
        }
        
        // Restore saved subregion
        if (getLocal('selectedSubregion')) {
            // Subregion already populated in updateSubregionDropdown
        }
        
        // Restore saved residency
        if (getLocal('residency')) {
            residency.value = getLocal('residency');
        }
        
        // Restore saved filing status
        if (getLocal('fillingStatus')) {
            filingStatusDropdown.value = getLocal('fillingStatus');
            updateDependantsVisibility();
            updateMaritalStatusVisibility();
            updateSpecificsVisibility();
        }
        
        // Restore saved personal details
        ['ageSelf', 'ageSpouse'].forEach(id => {
            const input = document.getElementById(id);
            if (input && getLocal(id)) {
                input.value = getLocal(id);
            }
        });
        
        ['employmentStatus', 'employmentStatusSpouse'].forEach(id => {
            const select = document.getElementById(id);
            if (select && getLocal(id)) {
                select.value = getLocal(id);
            }
        });
        
        // Restore saved disabled dependants
        const textarea = document.getElementById('birthYearDisabledDependants');
        if (textarea && getLocal('birthYearDisabledDependants')) {
            textarea.value = getLocal('birthYearDisabledDependants');
        }
    }
    
    // Event listeners
    countryDropdown.addEventListener('change', function() {
        const selectedCountry = this.value;
        setLocal('selectedCountry', selectedCountry, 365);
        updateSubregionDropdown(selectedCountry);
        updateFilingStatusOptions(selectedCountry);
    });
    
    subregionDropdown.addEventListener('change', function() {
        setLocal('selectedSubregion', this.value, 365);
    });
    
    residency.addEventListener('change', function() {
        setLocal('residency', this.value, 365);
    });
    
    filingStatusDropdown.addEventListener('change', function() {
        setLocal('fillingStatus', this.value, 365);
        updateDependantsVisibility();
        updateMaritalStatusVisibility();
        updateSpecificsVisibility();
    });
    
    // Save personal details changes
    ['ageSelf', 'ageSpouse'].forEach(id => {
        const input = document.getElementById(id);
        if (input) {
            input.addEventListener('change', function() {
                setLocal(id, this.value, 365);
            });
        }
    });
    
    ['employmentStatus', 'employmentStatusSpouse'].forEach(id => {
        const select = document.getElementById(id);
        if (select) {
            select.addEventListener('change', function() {
                setLocal(id, this.value, 365);
            });
        }
    });
    
    const textarea = document.getElementById('birthYearDisabledDependants');
    if (textarea) {
        textarea.addEventListener('change', function() {
            setLocal('birthYearDisabledDependants', this.value, 365);
        });
    }
    
    // Run initialization and setup
    initializeForm();
    setupAutoTransition();
});
</script>
 </body>
 </html>
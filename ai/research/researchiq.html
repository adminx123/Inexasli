<!--
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
-->

<script src="../../utility/toolTip.js" type="module"></script>
<script src="../../payment/paymentform.js"></script>

<div class="device-container">

<div class="row1 product-description-container">
    <h2 class="product-description-heading">Streamline Your Research & Uncover Key Information!</h2>
    <p class="product-description-text">
        Embarking on a research project or need to gather information on a specific topic? ResearchIQ is designed to assist you. By outlining your research questions and areas of focus, you can leverage our AI to help identify relevant information, summarize key points, and provide a structured overview, making your research process more efficient.
    </p>
    <p class="product-description-disclaimer">
        <em>Important: The information and suggestions provided by this tool are for informational and educational purposes only and are generated by artificial intelligence. This tool is intended to be a starting point for research and does not replace thorough investigation or academic rigor. Always critically evaluate sources and verify information. We make no guarantees regarding the accuracy, completeness, or suitability of the information for your specific research needs. Use of this tool and its outputs is at your own risk.</em>
    </p>
    <p class="product-description-final">
        Let's begin your research journey!
    </p>
</div>

<div class="premium-blur">

        <div class="row1">
            <h3 class="tooltip1" data-tooltip="What is your main research question or objective?">
      Research Goal<span class="tooltip1-content"></span>
    </h3>
            <textarea id="research-goal" rows="2" placeholder="Understand market trends in renewable energy
Analyze Gen Z customer purchasing behaviors"></textarea>
        </div>
        <div class="row1">
            <h3 class="tooltip1" data-tooltip="Why are you conducting this research? What do you hope to achieve?">
      Research Purpose<span class="tooltip1-content"></span>
    </h3>
            <textarea id="research-purpose" rows="2" placeholder="Inform new product development strategy
Identify untapped market opportunities"></textarea>
        </div>
        <div class="row1">
            <h3 class="tooltip1" data-tooltip="Choose the overall approach: qualitative, quantitative, or mixed methods.">
      Research Type<span class="tooltip1-content"></span>
    </h3>
            <select id="research-type">
                <option value="" disabled selected>Select Research Type</option>
                <option value="qualitative">Qualitative Research</option>
                <option value="quantitative">Quantitative Research</option>
                <option value="mixed-methods">Mixed Methods</option>
            </select>
        </div>
        <div class="row1">
            <h3 class="tooltip1" data-tooltip="What is the scope or boundaries of your research? (e.g., region, age group)">
      Research Scope<span class="tooltip1-content"></span>
    </h3>
            <textarea id="research-scope" rows="2" placeholder="North American market only
Adults 25-40 years old"></textarea>
        </div>
        <div class="row1">
            <h3 class="tooltip1" data-tooltip="Select the main research methodology (e.g., literature review, empirical research, etc.)">
      Research Methodology<span class="tooltip1-content"></span>
    </h3>
            <select id="research-methodology">
                <option value="" disabled selected>Select Research Methodology</option>
                <option value="literature-review">Literature Review (90% usefulness)</option>
                <option value="empirical-research">Empirical Research (88% usefulness)</option>
                <option value="analytical-framework">Analytical Framework (85% usefulness)</option>
                <option value="data-visualization">Data Visualization (82% usefulness)</option>
                <option value="academic-report">Academic Report (80% usefulness)</option>
            </select>
        </div>
        <div class="row1">
            <h3 class="tooltip1" data-tooltip="What type of analysis do you prefer? (e.g., comparative, statistical, etc.)">
      Analysis Preference<span class="tooltip1-content"></span>
    </h3>
            <select id="analysis-preference">
                <option value="" disabled selected>Select Analysis Preference</option>
                <option value="comparative">Comparative Analysis</option>
                <option value="statistical">Statistical Analysis</option>
                <option value="historical">Historical Trends Analysis</option>
                <option value="competitive">Competitive Research</option>
                <option value="demographic">Market Demographics</option>
                <option value="cost-benefit">Cost-Benefit Analysis</option>
                <option value="case-studies">Case Studies</option>
                <option value="trend-analysis">Trend Analysis</option>
                <option value="gap-analysis">Gap Analysis</option>
                <option value="stakeholder-analysis">Stakeholder Analysis</option>
            </select>
        </div>
        <div class="row1">
            <h3 class="tooltip1" data-tooltip="Who is the intended audience for this research?">
      Target Audience<span class="tooltip1-content"></span>
    </h3>
            <textarea id="research-audience" rows="2" placeholder="Tech professionals in urban areas
Small business owners with 5-50 employees"></textarea>
        </div>
        <div class="row1">
            <h3 class="tooltip1" data-tooltip="What background or context should be considered for this research?">
      Research Context<span class="tooltip1-content"></span>
    </h3>
            <textarea id="research-context" rows="3" placeholder="Recent industry shift toward sustainability
Competitor launched similar product last quarter
Economic downturn affecting consumer spending"></textarea>
        </div>
        <div class="row1">
            <h3 class="tooltip1" data-tooltip="What are the expected deliverables or outputs? (e.g., report, dashboard, etc.)">
      Expected Deliverables<span class="tooltip1-content"></span>
    </h3>
            <select id="research-deliverables">
                <option value="" disabled selected>Select Expected Deliverables</option>
                <option value="systematic-review">Systematic Review</option>
                <option value="meta-analysis">Meta-Analysis</option>
                <option value="narrative-review">Narrative Review</option>
                <option value="scoping-review">Scoping Review</option>
                <option value="experimental-design">Experimental Design</option>
                <option value="survey-research">Survey Research</option>
                <option value="case-study">Case Study</option>
                <option value="longitudinal-study">Longitudinal Study</option>
                <option value="comparative-analysis">Comparative Analysis</option>
                <option value="gap-analysis">Gap Analysis</option>
                <option value="trend-analysis">Trend Analysis</option>
                <option value="stakeholder-analysis">Stakeholder Analysis</option>
                <option value="data-visualization">Data Visualization</option>
                <option value="executive-summary">Executive Summary</option>
                <option value="technical-report">Technical Report</option>
                <option value="policy-brief">Policy Brief</option>
                <option value="research-proposal">Research Proposal</option>
            </select>
        </div>
        <div class="row1">
            <h3 class="tooltip1" data-tooltip="Choose the preferred output format for your research results.">
      Output Format<span class="tooltip1-content"></span>
    </h3>
            <select id="output-format">
                <option value="" disabled selected>Select Output Format</option>
                <option value="structured-report">Structured Research Report</option>
                <option value="executive-summary">Executive Summary</option>
                <option value="academic-paper">Academic Paper Format</option>
                <option value="data-dashboard">Data Visualization Dashboard</option>
                <option value="presentation">Presentation Structure</option>
                <option value="annotated-bibliography">Annotated Bibliography</option>
                <option value="evidence-map">Evidence Map</option>
                <option value="knowledge-graph">Knowledge Graph</option>
                <option value="policy-brief">Policy Brief Format</option>
                <option value="technical-documentation">Technical Documentation</option>
            </select>
        </div>
        <div class="row1">
            <h3 class="tooltip1" data-tooltip="Add any extra details, requirements, or constraints for your research.">
      Additional Details<span class="tooltip1-content"></span>
    </h3>
            <textarea id="additional-details" rows="3" placeholder="Need privacy-compliant data collection methods
Research must consider environmental impact
Results needed within two weeks"></textarea>
            <button class="generate-btn" id="generate-research-btn">Generate Research Plan Now!</button>
        </div>

<script>
/*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
*/

(function() {
    console.log("ResearchIQ script initializing");

    // Mapping of methodology to allowed options
    const methodologyMap = {
        'literature-review': {
            deliverables: ['systematic-review','meta-analysis','narrative-review','scoping-review','executive-summary','annotated-bibliography','evidence-map'],
            outputFormats: ['structured-report','executive-summary','academic-paper','annotated-bibliography','evidence-map'],
            analysis: ['comparative','historical','case-studies','trend-analysis','gap-analysis']
        },
        'empirical-research': {
            deliverables: ['experimental-design','survey-research','case-study','longitudinal-study','comparative-analysis','trend-analysis','gap-analysis','stakeholder-analysis'],
            outputFormats: ['structured-report','academic-paper','data-dashboard','presentation','technical-documentation'],
            analysis: ['statistical','comparative','trend-analysis','demographic','cost-benefit','case-studies']
        },
        'analytical-framework': {
            deliverables: ['comparative-analysis','gap-analysis','stakeholder-analysis','policy-brief','executive-summary'],
            outputFormats: ['structured-report','policy-brief','presentation','knowledge-graph'],
            analysis: ['comparative','gap-analysis','stakeholder-analysis','cost-benefit']
        },
        'data-visualization': {
            deliverables: ['data-visualization','trend-analysis','executive-summary'],
            outputFormats: ['data-dashboard','presentation','knowledge-graph'],
            analysis: ['trend-analysis','demographic','statistical']
        },
        'academic-report': {
            deliverables: ['technical-report','executive-summary','policy-brief','research-proposal'],
            outputFormats: ['structured-report','academic-paper','policy-brief','technical-documentation'],
            analysis: ['comparative','case-studies','stakeholder-analysis']
        }
    };

    // Utility to filter dropdown options
    function filterDropdown(selectId, allowedValues) {
        const select = document.getElementById(selectId);
        if (!select) return;
        Array.from(select.options).forEach(opt => {
            if (!opt.value) return; // skip placeholder
            opt.style.display = allowedValues.includes(opt.value) ? '' : 'none';
        });
        // Reset selection if current value is not allowed
        if (!allowedValues.includes(select.value)) {
            select.value = '';
        }
    }

    // Listen for methodology changes
    document.getElementById('research-methodology').addEventListener('change', function(e) {
        const val = e.target.value;
        if (methodologyMap[val]) {
            filterDropdown('research-deliverables', methodologyMap[val].deliverables);
            filterDropdown('output-format', methodologyMap[val].outputFormats);
            filterDropdown('analysis-preference', methodologyMap[val].analysis);
        } else {
            // Show all if nothing selected
            filterDropdown('research-deliverables', Array.from(document.getElementById('research-deliverables').options).map(o=>o.value).filter(Boolean));
            filterDropdown('output-format', Array.from(document.getElementById('output-format').options).map(o=>o.value).filter(Boolean));
            filterDropdown('analysis-preference', Array.from(document.getElementById('analysis-preference').options).map(o=>o.value).filter(Boolean));
        }
    });

    // Initialize FormPersistence for researchiq module
    const fields = [
        { id: 'research-goal', type: 'textarea' },
        { id: 'research-purpose', type: 'textarea' },
        { id: 'research-type', type: 'dropdown' },
        { id: 'research-methodology', type: 'dropdown' },
        { id: 'research-scope', type: 'textarea' },
        { id: 'analysis-preference', type: 'dropdown' },
        { id: 'research-audience', type: 'textarea' },
        { id: 'research-context', type: 'textarea' },
        { id: 'research-deliverables', type: 'dropdown' },
        { id: 'output-format', type: 'dropdown' },
        { id: 'additional-details', type: 'textarea' }
    ];

    // FormPersistence will be initialized by datain.js as window.researchFormPersistence
    // No need to create a new instance here

    // Listen for grid-item-toggled event from datain.js
    function handleGridItemToggled(event) {
        console.log('[ResearchIQ] Grid item toggled event received');
        // UI behavior only - persistence handled centrally
    }

    // Handle the generate button click
    async function handleGenerateResearchIq() {
        console.log('[ResearchIQ] Generate button clicked.');
        
        const result = await window.enhancedLoading(
            'generate-research-btn',
            'research',
            async () => {
                const formData = window.researchFormPersistence.getSavedFormData();
                if (!formData) {
                    console.error('[ResearchIQ] No input data found in localStorage.');
                    throw new Error('Please complete the form before generating a research plan.');
                }
                
                // Send data to worker
                const apiUrl = 'https://research.4hm7q4q75z.workers.dev/';
                
                console.log('[ResearchIQ] Sending researchIqInput to worker');
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                
                const responseData = await response.json();
                console.log('[ResearchIQ] Worker response:', responseData);
                
                if (responseData.message !== 'Success') {
                    throw new Error(`An error occurred: ${responseData.message || responseData.error || ''}`);
                }
                
                // Store the response
                window.researchFormPersistence.saveResponseData(responseData);
                
                // Dispatch an event to notify dataout.js that a response was received
                const event = new CustomEvent('api-response-received', {
                    detail: {
                        module: 'researchiq',
                        type: 'worker-response',
                        timestamp: Date.now()
                    }
                });
                document.dispatchEvent(event);
                console.log('[ResearchIQ] Dispatched api-response-received event');
                
                return responseData;
            }
        );
        
        // Enhanced loading either returns result or throws error - no need to check result.success
        console.log('[ResearchIQ] Research plan generated successfully');
    }

    // Initialization
    document.addEventListener('grid-item-toggled', handleGridItemToggled);
    document.getElementById('generate-research-btn').addEventListener('click', handleGenerateResearchIq);

    // Guided forms integration
    if (typeof GuidedForms !== 'undefined' && GuidedForms.researchiq) {
        new GuidedForms.researchiq();
    }
})();

(function() {
    let tooltipInitAttempts = 0;
    const maxAttempts = 20;
    function initTooltips() {
        tooltipInitAttempts++;
        if (typeof window.initializeTooltips === 'function') {
            try {
                window.initializeTooltips(document);
            } catch (error) {
                console.error('[ResearchIQ] Error initializing tooltips:', error);
            }
        } else if (tooltipInitAttempts < maxAttempts) {
            setTimeout(initTooltips, 100);
        } else {
            console.error('[ResearchIQ] Failed to initialize tooltips after maximum attempts');
        }
    }
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(initTooltips, 50);
        });
    } else {
        setTimeout(initTooltips, 100);
    }
})();
</script>
</div>
</div> <!-- Close mobile-container -->

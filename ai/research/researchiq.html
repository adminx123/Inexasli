<!--
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
-->

<script src="../../utility/toolTip.js" type="module"></script>
<script src="../../payment/paymentform.js"></script>

<div class="device-container">

<div class="row1 product-description-container">
    <h2 class="product-description-heading">Streamline Your Research & Uncover Key Information!</h2>
    <p class="product-description-text">
        Embarking on a research project or need to gather information on a specific topic? ResearchIQ is designed to assist you. By outlining your research questions and areas of focus, you can leverage our AI to help identify relevant information, summarize key points, and provide a structured overview, making your research process more efficient.
    </p>
    <p class="product-description-disclaimer">
        <em>Important: The information and suggestions provided by this tool are for informational and educational purposes only and are generated by artificial intelligence. This tool is intended to be a starting point for research and does not replace thorough investigation or academic rigor. Always critically evaluate sources and verify information. We make no guarantees regarding the accuracy, completeness, or suitability of the information for your specific research needs. Use of this tool and its outputs is at your own risk.</em>
    </p>
    <p class="product-description-final">
        Let's begin your research journey!
    </p>
</div>

<div class="premium-blur">

        <div class="row1">
            <h3 class="tooltip1" data-tooltip="What do you want the AI to research for you?">
      Research Topic or Question<span class="tooltip1-content"></span>
    </h3>
            <textarea id="research-topic" rows="3" placeholder="e.g. The impact of remote work on productivity in tech companies"></textarea>
        </div>
        <div class="row1">
            <h3 class="tooltip1" data-tooltip="Add any extra details or context to help the AI with your research.">
      Additional Details (optional)<span class="tooltip1-content"></span>
    </h3>
            <textarea id="additional-details" rows="3" placeholder="e.g. Focus on studies from 2020 onward, include both US and Europe, summarize key findings"></textarea>
        </div>
        <div class="row1">
            <h3 class="tooltip1" data-tooltip="Choose the format for your research report.">
      Report Format<span class="tooltip1-content"></span>
    </h3>
    <select id="output-format">
        <option value="structured-report">Structured Research Report</option>
        <option value="executive-summary">Executive Summary</option>
        <option value="academic-paper">Academic Paper Format</option>
        <option value="presentation">Presentation Slides/Outline</option>
        <option value="data-dashboard">Data Visualization Dashboard</option>
    </select>
        </div>
        <div class="row1">
            <label style="display: flex; align-items: center; gap: 8px;">
        <input type="checkbox" id="include-charts" />
        <span>Include charts/visualizations if possible</span>
    </label>
        </div>
        <div class="row1">
            <button class="generate-btn" id="generate-research-btn">Generate Research Report</button>
        </div>

<script>
/*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
*/

(function() {
    console.log("ResearchIQ script initializing");

    // Listen for methodology changes
    document.getElementById('research-methodology').addEventListener('change', function(e) {
        const val = e.target.value;
        if (methodologyMap[val]) {
            filterDropdown('research-deliverables', methodologyMap[val].deliverables);
            filterDropdown('output-format', methodologyMap[val].outputFormats);
            filterDropdown('analysis-preference', methodologyMap[val].analysis);
        } else {
            // Show all if nothing selected
            filterDropdown('research-deliverables', Array.from(document.getElementById('research-deliverables').options).map(o=>o.value).filter(Boolean));
            filterDropdown('output-format', Array.from(document.getElementById('output-format').options).map(o=>o.value).filter(Boolean));
            filterDropdown('analysis-preference', Array.from(document.getElementById('analysis-preference').options).map(o=>o.value).filter(Boolean));
        }
    });

    // Initialize FormPersistence for researchiq module
    const fields = [
        { id: 'research-goal', type: 'textarea' },
        { id: 'research-purpose', type: 'textarea' },
        { id: 'research-type', type: 'dropdown' },
        { id: 'research-methodology', type: 'dropdown' },
        { id: 'research-scope', type: 'textarea' },
        { id: 'analysis-preference', type: 'dropdown' },
        { id: 'research-audience', type: 'textarea' },
        { id: 'research-context', type: 'textarea' },
        { id: 'research-deliverables', type: 'dropdown' },
        { id: 'output-format', type: 'dropdown' },
        { id: 'additional-details', type: 'textarea' }
    ];

    // FormPersistence will be initialized by datain.js as window.researchFormPersistence
    // No need to create a new instance here

    // Listen for grid-item-toggled event from datain.js
    function handleGridItemToggled(event) {
        console.log('[ResearchIQ] Grid item toggled event received');
        // UI behavior only - persistence handled centrally
    }

    // Handle the generate button click
    async function handleGenerateResearchIq() {
        console.log('[ResearchIQ] Generate button clicked.');
        
        const result = await window.enhancedLoading(
            'generate-research-btn',
            'research',
            async () => {
                // Collect form data
                const formData = window.researchFormPersistence.getSavedFormData() || {};
                // Add chart/visualization preference
                formData.includeCharts = document.getElementById('include-charts')?.checked || false;
                
                if (!formData) {
                    console.error('[ResearchIQ] No input data found in localStorage.');
                    throw new Error('Please complete the form before generating a research plan.');
                }
                
                // Send data to worker
                const apiUrl = 'https://research.4hm7q4q75z.workers.dev/';
                
                console.log('[ResearchIQ] Sending researchIqInput to worker');
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                
                const responseData = await response.json();
                console.log('[ResearchIQ] Worker response:', responseData);
                
                if (responseData.message !== 'Success') {
                    throw new Error(`An error occurred: ${responseData.message || responseData.error || ''}`);
                }
                
                // Store the response
                window.researchFormPersistence.saveResponseData(responseData);
                
                // Dispatch an event to notify dataout.js that a response was received
                const event = new CustomEvent('api-response-received', {
                    detail: {
                        module: 'researchiq',
                        type: 'worker-response',
                        timestamp: Date.now()
                    }
                });
                document.dispatchEvent(event);
                console.log('[ResearchIQ] Dispatched api-response-received event');
                
                return responseData;
            }
        );
        
        // Enhanced loading either returns result or throws error - no need to check result.success
        console.log('[ResearchIQ] Research plan generated successfully');
    }

    // Initialization
    document.addEventListener('grid-item-toggled', handleGridItemToggled);
    document.getElementById('generate-research-btn').addEventListener('click', handleGenerateResearchIq);

    // Guided forms integration
    if (typeof GuidedForms !== 'undefined' && GuidedForms.researchiq) {
        new GuidedForms.researchiq();
    }
})();

(function() {
    let tooltipInitAttempts = 0;
    const maxAttempts = 20;
    function initTooltips() {
        tooltipInitAttempts++;
        if (typeof window.initializeTooltips === 'function') {
            try {
                window.initializeTooltips(document);
            } catch (error) {
                console.error('[ResearchIQ] Error initializing tooltips:', error);
            }
        } else if (tooltipInitAttempts < maxAttempts) {
            setTimeout(initTooltips, 100);
        } else {
            console.error('[ResearchIQ] Failed to initialize tooltips after maximum attempts');
        }
    }
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(initTooltips, 50);
        });
    } else {
        setTimeout(initTooltips, 100);
    }
})();
</script>
</div>
</div> <!-- Close mobile-container -->

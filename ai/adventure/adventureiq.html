<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Adventure IQ</title>
  <!--
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide. -->
</head>
<body>
  <!-- Navigation -->
  <a href="/ai/landing/landing.html">
    <img src="/images/apple-touch-icon.png" alt="Logo" style="width: 25px; height: auto; display: block; margin: 15px;">
  </a>

  <!-- Form Sections - identical structure to fitnessiq.html but with adventure IDs -->
  <div class="row1">
    <label class="category-label">Primary Goal</label>
    <select id="trip-primary-goal">
      <option value="leisure">Leisure & Relaxation</option>
      <option value="adventure">Adventure & Exploration</option>
      <option value="cultural">Cultural Immersion</option>
      <option value="educational">Educational Experience</option>
      <option value="business">Business Trip with Leisure</option>
      <option value="family">Family Bonding</option>
      <option value="romantic">Romantic Getaway</option>
      <option value="wellness">Health & Wellness Retreat</option>
      <option value="special-occasion">Special Occasion Celebration</option>
    </select>
  </div>
  <div class="row1">
    <label class="category-label">Trip Activities</label>
    <div class="grid-container" id="trip-activities">
      <div class="grid-item" data-value="Hiking">Hiking</div>
      <div class="grid-item" data-value="Sightseeing">Sightseeing</div>
      <div class="grid-item" data-value="Relaxation">Relaxation</div>
      <div class="grid-item" data-value="Attractions">Attractions</div>
      <div class="grid-item" data-value="Event">Event</div>
      <div class="grid-item" data-value="Cultural Tours">Cultural Tours</div>
      <div class="grid-item" data-value="Shopping">Shopping</div>
      <div class="grid-item" data-value="Adventure">Adventure</div>
      <div class="grid-item" data-value="Wildlife Watching">Wildlife Watching</div>
      <div class="grid-item" data-value="Water Sports">Water Sports</div>
      <div class="grid-item" data-value="Food Tours">Food Tours</div>
      <div class="grid-item" data-value="Museums">Museums</div>
      <div class="grid-item" data-value="Nightlife">Nightlife</div>
      <div class="grid-item" data-value="Wellness">Wellness</div>
      <div class="grid-item" data-value="Beach Time">Beach Time</div>
      <div class="grid-item" data-value="Skiing">Skiing</div>
      <div class="grid-item" data-value="Road Trips">Road Trips</div>
      <div class="grid-item" data-value="Camping">Camping</div>
      <div class="grid-item" data-value="Photography">Photography</div>
      <div class="grid-item" data-value="Historical Sites">Historical Sites</div>
    </div>
  </div>
  <div class="row1">
    <label class="category-label">Travel Companions</label>
    <div class="grid-container" id="trip-relationship">
      <div class="grid-item" data-value="Parents">With Parents</div>
      <div class="grid-item" data-value="Siblings">With Siblings</div>
      <div class="grid-item" data-value="Friends">With Friends</div>
      <div class="grid-item" data-value="Intimate Partner">With Intimate Partner</div>
      <div class="grid-item" data-value="Business Partner">With Business Partner</div>
      <div class="grid-item" data-value="Co-Worker">With Co-Worker</div>
      <div class="grid-item" data-value="Client">With Client</div>
    </div>
  </div>
  <div class="row1">
    <label class="category-label">Destination</label>
    <textarea id="trip-location" rows="3" placeholder="Trip Locations (one per line):
New York, 51st st
New Jersey, 6th ave
Hampton's"></textarea>
  </div>
  <div class="row1">
    <label class="category-label">Trip Details</label>
    <textarea id="trip-specifics" rows="4" placeholder="Specifics Needed (one per line):
Top rated hiking trails
Hikes under 5km
Best ice cream shops within 5km from city centre"></textarea>
    <textarea id="trip-plans" rows="3" placeholder="Trip Schedule (one per line):
Monday - 6am hike, 8pm dinner
Tuesday - 8am breakfast in city, 5pm visit with friends"></textarea>
  </div>
  <div class="row1">
    <label class="category-label">Packing Requirements</label>
    <select id="trip-packing">
      <option value="YM">Packing tips needed for male</option>
      <option value="YF">Packing tips needed for female</option>
      <option value="YMF">Packing tips needed for male & female</option>
      <option value="NN">Packing tips not needed</option>
    </select>
  </div>
  <div class="row1">
    <label class="category-label">Group Size</label>
    <input type="number" id="trip-people" placeholder="Amount of people on trip" min="1">
  </div>
  <div class="row1">
    <label class="category-label">Trip Duration</label>
    <input type="number" id="trip-days" placeholder="Trip Length (days)" min="1">
  </div>
  <div class="row1">
    <label class="category-label">Budget</label>
    <textarea id="trip-budget" rows="4" placeholder="Budget: $3000 usd"></textarea>
  </div>
  <div class="row1">
    <label class="category-label">Output Format</label>
    <select id="trip-output-format">
      <option value="detailed-itinerary">Detailed Day-by-Day Itinerary</option>
      <option value="bullet-points">Bullet Point Summary</option>
      <option value="travel-guide">Travel Guide with Maps</option>
      <option value="visual-timeline">Visual Timeline</option>
      <option value="packing-focused">Packing-Focused Plan</option>
      <option value="budget-breakdown">Budget Breakdown</option>
      <option value="thematic-experience">Thematic Experience</option>
      <option value="family-friendly">Family-Friendly Format</option>
    </select>
  </div>
  <div class="row1">
    <label class="category-label">Special Instructions</label>
    <textarea id="trip-special-instructions" rows="3" placeholder="Any special requirements or preferences for how your itinerary should be created:
Focus on sustainable travel options
Emphasize accessible attractions
Include more free time between activities"></textarea>
  </div>
  <button class="generate-btn" id="generate-adventure-btn">Generate Prompt Now!</button>
  <button class="clear-btn" id="clear-adventure-btn">Clear All</button>

  <script>
  /*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
*/
  (function() {
    console.log("Adventure IQ script initializing");

    // JSON storage helpers
    const setJSON = window.setJSON || function(name, value) {
      try {
        if (!name) return false;
        if (value === undefined) { localStorage.removeItem(name); return true; }
        localStorage.setItem(name, JSON.stringify(value));
        console.log(`[AdventureIQ] JSON saved ${name}`);
        return true;
      } catch (e) { console.error(`[AdventureIQ] Error storing JSON: ${e}`); return false; }
    };
    const getJSON = window.getJSON || function(name, defaultValue) {
      try {
        const item = localStorage.getItem(name);
        return item ? JSON.parse(item) : defaultValue;
      } catch (e) { console.error(`[AdventureIQ] Error retrieving JSON: ${e}`); return defaultValue; }
    };

    function customToggleGridItem(event) {
      event.stopPropagation(); event.preventDefault();
      const container = this.closest('.grid-container');
      // Multi vs single logic: only multi here for adventure
      this.classList.toggle('selected');
      saveGridItem(this);
      console.log(`[AdventureIQ] Toggled ${this.dataset.value} in ${container.id}`);
    }

    function saveGridItem(item) {
      console.log('[AdventureIQ] Saving all form data to JSON');
      setJSON('adventureIqInput', collectFormData());
    }

    function saveInput(input) {
      console.log('[AdventureIQ] Saving all form data to JSON');
      setJSON('adventureIqInput', collectFormData());
    }

    function collectFormData() {
      const formData = { 
        primaryGoal: null, 
        activities: [], 
        relationships: [], 
        location: null, 
        specifics: null, 
        plans: null, 
        packing: null, 
        people: null, 
        days: null, 
        budget: null,
        outputFormat: null,
        specialInstructions: null
      };
      document.querySelectorAll('#trip-activities .grid-item.selected').forEach(i => formData.activities.push(i.dataset.value));
      document.querySelectorAll('#trip-relationship .grid-item.selected').forEach(i => formData.relationships.push(i.dataset.value));
      ['primary-goal', 'location','specifics','plans','packing','people','days','budget','output-format','special-instructions'].forEach(field => {
        const el = document.getElementById(`trip-${field}`);
        if (el) formData[field === 'primary-goal' ? 'primaryGoal' : 
                 field === 'output-format' ? 'outputFormat' : 
                 field === 'special-instructions' ? 'specialInstructions' : field] = (el.value||'').trim() || null;
      });
      return formData;
    }

    function repopulateForm() {
      console.log('[AdventureIQ] Repopulating form from JSON storage');
      const data = getJSON('adventureIqInput', null);
      if (!data) return;
      data.activities?.forEach(v => document.querySelector(`#trip-activities .grid-item[data-value="${v}"]`)?.classList.add('selected'));
      data.relationships?.forEach(v => document.querySelector(`#trip-relationship .grid-item[data-value="${v}"]`)?.classList.add('selected'));
      
      // Handle dropdown and text fields
      if(data.primaryGoal) document.getElementById('trip-primary-goal').value = data.primaryGoal;
      ['location','specifics','plans','packing','people','days','budget'].forEach(f => {
        const el = document.getElementById(`trip-${f}`);
        if (el && data[f]) el.value = data[f];
      });
      
      // Handle new fields
      if(data.outputFormat) document.getElementById('trip-output-format').value = data.outputFormat;
      if(data.specialInstructions) document.getElementById('trip-special-instructions').value = data.specialInstructions;
    }

    function setupInputHandlers() {
      document.querySelectorAll('input, textarea, select').forEach(i => i.addEventListener('change', () => saveInput(i)));
    }

    function clearLocalStorage() {
      if (!confirm('Are you sure you want to clear all saved data? This action cannot be undone.')) return;
      localStorage.removeItem('adventureIqInput');
      localStorage.removeItem('adventureIqResponse');
      document.querySelectorAll('.grid-container .grid-item').forEach(i => i.classList.remove('selected'));
      document.querySelectorAll('input, textarea').forEach(i => i.value = '');
      document.querySelectorAll('select').forEach(s => s.selectedIndex = 0);
    }

    // Handle the generate button click
    async function handleGenerateAdventureIq() {
      const btn = document.getElementById('generate-adventure-btn');
      const initialText = btn.innerText;
      btn.innerText = 'Loading...';
      btn.setAttribute('disabled', 'true');
      
      console.log('[AdventureIQ] Generate button clicked.');
      
      try {
        // Use what's stored in localStorage
        const formData = getJSON('adventureIqInput');
        if (!formData) {
          console.error('[AdventureIQ] No input data found in localStorage.');
          alert('Please complete the form before generating a travel plan.');
          btn.innerText = initialText;
          btn.removeAttribute('disabled');
          return;
        }
        
        // Send data to worker
        const apiUrl = 'https://adventure.4hm7q4q75z.workers.dev/'; 
        
        console.log('[AdventureIQ] Sending adventureIqInput to worker');
        const response = await fetch(apiUrl, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });
        
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        
        const responseData = await response.json();
        console.log('[AdventureIQ] Worker response:', responseData);
        
        if (responseData.message !== 'Success') {
          throw new Error(`An error occurred: ${responseData.message || responseData.error || ''}`);
        }
        
        // Store the response using setJSON
        setJSON('adventureIqResponse', responseData);
        
        // Update button state
        btn.innerText = 'Success!';
        setTimeout(() => {
          btn.removeAttribute('disabled');
        }, 1000);
        
        // Dispatch an event to notify dataout.js that a response was received
        const event = new CustomEvent('api-response-received', {
          detail: {
            module: 'adventureiq',
            type: 'worker-response',
            timestamp: Date.now()
          }
        });
        document.dispatchEvent(event);
        console.log('[AdventureIQ] Dispatched api-response-received event');
        
      } catch (error) {
        console.error('[AdventureIQ] Error generating travel plan:', error);
        alert('An error occurred while generating your travel plan. Please try again later.');
        
        btn.innerText = 'Error';
        setTimeout(() => {
          btn.innerText = initialText;
          btn.removeAttribute('disabled');
        }, 2000);
      }
    }

    // Initialization
    document.querySelectorAll('.grid-container .grid-item').forEach(item => item.addEventListener('click', customToggleGridItem, { capture: true }));
    repopulateForm();
    setupInputHandlers();
    document.getElementById('generate-adventure-btn').addEventListener('click', handleGenerateAdventureIq);
    document.getElementById('clear-adventure-btn').addEventListener('click', clearLocalStorage);
  })();
  </script>
</body>
</html>


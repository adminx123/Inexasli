<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Adventure IQ</title>
  <!--
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide. -->
</head>
<body>
  <!-- Navigation -->
  <a href="/ai/landing/landing.html">
    <img src="/images/apple-touch-icon.png" alt="Logo" style="width: 25px; height: auto; display: block; margin: 15px;">
  </a>

  <!-- Form Sections - identical structure to fitnessiq.html but with adventure IDs -->
  <div class="row1">
    <label class="category-label">Trip Activities</label>
    <div class="grid-container" id="trip-activities">
      <div class="grid-item" data-value="Hiking">Hiking</div>
      <div class="grid-item" data-value="Sightseeing">Sightseeing</div>
      <div class="grid-item" data-value="Relaxation">Relaxation</div>
      <div class="grid-item" data-value="Attractions">Attractions</div>
      <div class="grid-item" data-value="Event">Event</div>
      <div class="grid-item" data-value="Cultural Tours">Cultural Tours</div>
      <div class="grid-item" data-value="Shopping">Shopping</div>
      <div class="grid-item" data-value="Adventure">Adventure</div>
      <div class="grid-item" data-value="Wildlife Watching">Wildlife Watching</div>
      <div class="grid-item" data-value="Water Sports">Water Sports</div>
      <div class="grid-item" data-value="Food Tours">Food Tours</div>
      <div class="grid-item" data-value="Museums">Museums</div>
      <div class="grid-item" data-value="Nightlife">Nightlife</div>
      <div class="grid-item" data-value="Wellness">Wellness</div>
      <div class="grid-item" data-value="Beach Time">Beach Time</div>
      <div class="grid-item" data-value="Skiing">Skiing</div>
      <div class="grid-item" data-value="Road Trips">Road Trips</div>
      <div class="grid-item" data-value="Camping">Camping</div>
      <div class="grid-item" data-value="Photography">Photography</div>
      <div class="grid-item" data-value="Historical Sites">Historical Sites</div>
    </div>
  </div>
  <div class="row1">
    <label class="category-label">Travel Companions</label>
    <div class="grid-container" id="trip-relationship">
      <div class="grid-item" data-value="Parents">With Parents</div>
      <div class="grid-item" data-value="Siblings">With Siblings</div>
      <div class="grid-item" data-value="Friends">With Friends</div>
      <div class="grid-item" data-value="Intimate Partner">With Intimate Partner</div>
      <div class="grid-item" data-value="Business Partner">With Business Partner</div>
      <div class="grid-item" data-value="Co-Worker">With Co-Worker</div>
      <div class="grid-item" data-value="Client">With Client</div>
    </div>
  </div>
  <div class="row1">
    <label class="category-label">Destination</label>
    <textarea id="trip-location" rows="3" placeholder="Trip Locations (one per line):
New York, 51st st
New Jersey, 6th ave
Hampton's"></textarea>
  </div>
  <div class="row1">
    <label class="category-label">Trip Details</label>
    <textarea id="trip-specifics" rows="4" placeholder="Specifics Needed (one per line):
Top rated hiking trails
Hikes under 5km
Best ice cream shops within 5km from city centre"></textarea>
    <textarea id="trip-plans" rows="3" placeholder="Trip Schedule (one per line):
Monday - 6am hike, 8pm dinner
Tuesday - 8am breakfast in city, 5pm visit with friends"></textarea>
  </div>
  <div class="row1">
    <label class="category-label">Packing Requirements</label>
    <select id="trip-packing">
      <option value="YM">Packing tips needed for male</option>
      <option value="YF">Packing tips needed for female</option>
      <option value="YMF">Packing tips needed for male & female</option>
      <option value="NN">Packing tips not needed</option>
    </select>
  </div>
  <div class="row1">
    <label class="category-label">Group Size</label>
    <input type="number" id="trip-people" placeholder="Amount of people on trip" min="1">
  </div>
  <div class="row1">
    <label class="category-label">Trip Duration</label>
    <input type="number" id="trip-days" placeholder="Trip Length (days)" min="1">
  </div>
  <div class="row1">
    <label class="category-label">Budget</label>
    <textarea id="trip-budget" rows="4" placeholder="Budget: $3000 usd"></textarea>
  </div>
  <button class="generate-btn" id="generate-adventure-btn">Generate Prompt Now!</button>
  <button class="clear-btn" id="clear-adventure-btn">Clear All</button>

  <script>
  /*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
*/
  (function() {
    console.log("Adventure IQ script initializing");
    const setJSON = window.setJSON || function(name, value) {
      try {
        if (name === undefined || name === null || name === '') {
          console.error('Invalid key name provided to setJSON');
          return false;
        }
        
        if (value === undefined) {
          console.warn(`Warning: Storing undefined value for ${name} in localStorage`);
          localStorage.removeItem(name);
          return true;
        }
        
        const jsonString = JSON.stringify(value);
        localStorage.setItem(name, jsonString);
        console.log(`[AdventureIQ] JSON saved ${name}`);
        return true;
      } catch (error) {
        console.error(`[AdventureIQ] Error storing JSON: ${error}`);
        return false;
      }
    };
    const getJSON = window.getJSON || function(name, defaultValue) {
      try {
        const item = localStorage.getItem(name);
        if (!item) return defaultValue;
        const parsedValue = JSON.parse(item);
        console.log(`[AdventureIQ] JSON retrieved ${name}`);
        return parsedValue;
      } catch (error) {
        console.error(`[AdventureIQ] Error retrieving JSON: ${error}`);
        return defaultValue;
      }
    };

    function customToggleGridItem(event) {
      event.stopPropagation(); event.preventDefault();
      const container = this.closest('.grid-container');
      if (container.id === 'adventure-...') {
        /* single selection logic as in fitnessiq */
      } else {
        this.classList.toggle('selected');
      }
      saveGridItem(this);
    }

    function saveGridItem(item) {
      console.log('[AdventureIQ] Saving all form data to JSON');
      const formData = collectFormData();
      setJSON('adventureIqInput', formData);
    }

    function saveInput(input) {
      console.log('[AdventureIQ] Saving all form data to JSON');
      const formData = collectFormData();
      setJSON('adventureIqInput', formData);
    }

    function collectFormData() {
      const formData = { 
        activities: [],
        relationships: [],
        location: null,
        specifics: null,
        plans: null,
        packing: null,
        people: null,
        days: null,
        budget: null
      };
      document.querySelectorAll('#trip-activities .grid-item.selected').forEach(item => {
        formData.activities.push(item.dataset.value);
      });
      document.querySelectorAll('#trip-relationship .grid-item.selected').forEach(item => {
        formData.relationships.push(item.dataset.value);
      });
      const locationInput = document.getElementById('trip-location');
      if (locationInput && locationInput.value.trim()) {
        formData.location = locationInput.value.trim();
      }
      const specificsInput = document.getElementById('trip-specifics');
      if (specificsInput && specificsInput.value.trim()) {
        formData.specifics = specificsInput.value.trim();
      }
      const plansInput = document.getElementById('trip-plans');
      if (plansInput && plansInput.value.trim()) {
        formData.plans = plansInput.value.trim();
      }
      const packingInput = document.getElementById('trip-packing');
      if (packingInput) {
        formData.packing = packingInput.value;
      }
      const peopleInput = document.getElementById('trip-people');
      if (peopleInput && peopleInput.value && !isNaN(peopleInput.value)) {
        formData.people = parseInt(peopleInput.value, 10);
      }
      const daysInput = document.getElementById('trip-days');
      if (daysInput && daysInput.value && !isNaN(daysInput.value)) {
        formData.days = parseInt(daysInput.value, 10);
      }
      const budgetInput = document.getElementById('trip-budget');
      if (budgetInput && budgetInput.value.trim()) {
        formData.budget = budgetInput.value.trim();
      }
      return formData;
    }

    function repopulateForm() {
      console.log("[AdventureIQ] Repopulating form from JSON storage");
      const storedData = getJSON('adventureIqInput', null);
      if (!storedData) return;
      document.querySelectorAll('.grid-container .grid-item').forEach(item => {
        const key = `grid_${item.parentElement.id}_${item.dataset.value.replace(/\s+/g, '_')}`;
        const value = getLocal(key);
        if (value === 'true') {
          item.classList.add('selected');
          console.log(`[AdventureIQ] Restored from localStorage: ${item.dataset.value}`);
        }
      });
      document.querySelectorAll('input, textarea').forEach(input => {
        if (!input.id) return;
        const key = `input_${input.id}`;
        const value = getLocal(key);
        if (value && value !== 'null') {
          input.value = value;
          console.log(`[AdventureIQ] Restored from localStorage: ${input.id} = ${value}`);
        }
      });
      document.querySelectorAll('select').forEach(select => {
        if (!select.id) return;
        const key = `input_${select.id}`;
        const value = getLocal(key);
        if (value && value !== 'null') {
          const optionExists = Array.from(select.options).some(opt => opt.value === value);
          if (optionExists) {
            select.value = value;
            console.log(`[AdventureIQ] Restored from localStorage: ${select.id} = ${value}`);
          }
        }
      });
      if (storedData) {
        console.log('[AdventureIQ] Found stored JSON form data, using as fallback');
        const hasExistingActivities = document.querySelector('#trip-activities .grid-item.selected');
        if (!hasExistingActivities && storedData.activities && Array.isArray(storedData.activities)) {
          storedData.activities.forEach(activity => {
            const item = document.querySelector(`#trip-activities .grid-item[data-value="${activity}"]`);
            if (item && !item.classList.contains('selected')) {
              item.classList.add('selected');
              console.log(`[AdventureIQ] Restored from JSON: activity ${activity}`);
            }
          });
        }
        const hasExistingRelationships = document.querySelector('#trip-relationship .grid-item.selected');
        if (!hasExistingRelationships && storedData.relationships && Array.isArray(storedData.relationships)) {
          storedData.relationships.forEach(relationship => {
            const item = document.querySelector(`#trip-relationship .grid-item[data-value="${relationship}"]`);
            if (item && !item.classList.contains('selected')) {
              item.classList.add('selected');
              console.log(`[AdventureIQ] Restored from JSON: relationship ${relationship}`);
            }
          });
        }
        const locationInput = document.getElementById('trip-location');
        if (locationInput && !locationInput.value && storedData.location) {
          locationInput.value = storedData.location;
          console.log(`[AdventureIQ] Restored from JSON: location`);
        }
        const specificsInput = document.getElementById('trip-specifics');
        if (specificsInput && !specificsInput.value && storedData.specifics) {
          specificsInput.value = storedData.specifics;
          console.log(`[AdventureIQ] Restored from JSON: specifics`);
        }
        const plansInput = document.getElementById('trip-plans');
        if (plansInput && !plansInput.value && storedData.plans) {
          plansInput.value = storedData.plans;
          console.log(`[AdventureIQ] Restored from JSON: plans`);
        }
        const packingInput = document.getElementById('trip-packing');
        if (packingInput && packingInput.value === 'NN' && storedData.packing) {
          packingInput.value = storedData.packing;
          console.log(`[AdventureIQ] Restored from JSON: packing ${storedData.packing}`);
        }
        const peopleInput = document.getElementById('trip-people');
        if (peopleInput && !peopleInput.value && storedData.people) {
          peopleInput.value = storedData.people;
          console.log(`[AdventureIQ] Restored from JSON: people ${storedData.people}`);
        }
        const daysInput = document.getElementById('trip-days');
        if (daysInput && !daysInput.value && storedData.days) {
          daysInput.value = storedData.days;
          console.log(`[AdventureIQ] Restored from JSON: days ${storedData.days}`);
        }
        const budgetInput = document.getElementById('trip-budget');
        if (budgetInput && !budgetInput.value && storedData.budget) {
          budgetInput.value = storedData.budget;
          console.log(`[AdventureIQ] Restored from JSON: budget`);
        }
      }
      document.querySelectorAll('.grid-container .grid-item.selected').forEach(item => {
        saveGridItem(item);
      });
      document.querySelectorAll('input, textarea, select').forEach(input => {
        if (input.value) {
          saveInput(input);
        }
      });
    }

    function setupInputHandlers() {
      document.querySelectorAll('input, textarea, select').forEach(input => {
        input.addEventListener('change', function() { saveInput(this); });
      });
    }

    function clearLocalStorage() {
      if (!confirm("Are you sure you want to clear all saved data?")) return;
      localStorage.removeItem('adventureIqInput');
      localStorage.removeItem('adventureIqResponse');
      document.querySelectorAll('.grid-container .grid-item').forEach(item => {
        item.classList.remove('selected');
      });
      document.querySelectorAll('input, textarea').forEach(input => {
        input.value = '';
      });
      const packingSelect = document.getElementById('trip-packing');
      if (packingSelect) {
        packingSelect.value = 'NN';
      }
      console.log('[AdventureIQ] All adventure data cleared');
      alert("All adventure data has been cleared successfully.");
    }

    async function handleGenerateAdventureIq() {
      const btn = document.getElementById('generate-adventure-btn');
      const initialText = btn.innerText;
      btn.innerText = 'Loading...'; btn.setAttribute('disabled', 'true');
      try {
        const formData = getJSON('adventureIqInput');
        if (!formData) {
          alert('Please complete the form before generating a prompt.');
          btn.innerText = initialText; btn.removeAttribute('disabled');
          return;
        }
        const apiUrl = 'https://adventureiqworker.4hm7q4q75z.workers.dev/';
        const response = await fetch(apiUrl, { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(formData) });
        const data = await response.json();
        if (data.message !== 'Success') {
          throw new Error(`An error occurred: ${data.message || data.error || ''}`);
        }
        setJSON('adventureIqResponse', data);
        btn.innerText = 'Success!';
        setTimeout(() => {
          btn.innerText = initialText;
          btn.removeAttribute('disabled');
        }, 2000);
        const event = new CustomEvent('api-response-received', {
          detail: {
            module: 'adventureiq',
            type: 'worker-response',
            timestamp: Date.now()
          }
        });
        document.dispatchEvent(event);
        console.log('[AdventureIQ] Dispatched api-response-received event');
      } catch (error) {
        console.error('[AdventureIQ] Error generating adventure plan:', error);
        alert('An error occurred while generating your adventure plan. Please try again later.');
        btn.innerText = 'Error';
        setTimeout(() => {
          btn.innerText = initialText;
          btn.removeAttribute('disabled');
        }, 2000);
      }
    }

    repopulateForm();
    setupInputHandlers();
    document.getElementById('generate-adventure-btn').addEventListener('click', handleGenerateAdventureIq);
    document.getElementById('clear-adventure-btn').addEventListener('click', clearLocalStorage);
    document.querySelectorAll('.grid-container .grid-item').forEach(item => item.addEventListener('click', customToggleGridItem, { capture: true }));
  })();
  </script>
</body>
</html>


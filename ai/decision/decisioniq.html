<!--
 * Copyright (c) 2025 INEXASLI. All rights reserv            <textarea id="decision-options" rows="3" placeholder="Option 1: Salesforce CRM Premium Package - $150/user/month
Option 2: HubSpot Enterprise Solution - $120/user/month
Option 3: Build custom solution in-house"></textarea>
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
-->


<div class="device-container" id="decisioniq-device-container">

<div class="row1 product-description-container">
    <h2 class="product-description-heading">DecisionIQ™</h2>
    <p class="product-description-text">
        DecisionIQ™ is a decision-making informational tool that helps you organize and structure your decision criteria. By inputting your options, constraints, and priorities, you'll help our system create queries for third-party AI providers to generate informational content about decision frameworks and analytical approaches. This content is designed to help you prepare better questions for consultations with qualified professionals.
    </p>
    <p class="product-description-final">
        Ready to organize your decision information!
    </p>
    <p class="product-description-disclaimer">
        <em>This is an informational tool only. All content is generated by third-party AI systems and is for educational and informational purposes. This is not professional business, legal, or strategic advice. AI can make mistakes and generate inaccurate information. For critical business decisions, consult qualified business advisors, legal professionals, or industry specialists.</em>
    </p>
</div>

        <div class="row1">
            <h3 class="tooltip1" data-tooltip="Clearly describe what decision you need to make or problem you need to solve.">
                Goal<span class="tooltip1-content"></span>
            </h3>
            <textarea id="goal" rows="2" placeholder="Choose a software vendor for our CRM system
Select new office location for regional headquarters"></textarea>
      
       
            <h3 class="tooltip1" data-tooltip="Choose the analytical framework that best suits your decision-making needs.">
                Analysis Type<span class="tooltip1-content"></span>
            </h3>
            <select id="analysis-type">
                <option value="" disabled selected>Select Analysis Type</option>
                <option value="swot">SWOT Analysis</option>
                <option value="pros-cons">Cost-Benefit / Pros-Cons Analysis</option>
                <option value="weighted-scoring">Weighted Scoring</option>
                <option value="decision-tree">Decision Tree</option>
            </select>
      
      
            <h3 class="tooltip1" data-tooltip="List all the potential options or alternatives you're considering for this decision.">
                Decision Options<span class="tooltip1-content"></span>
            </h3>
            <textarea id="options" rows="4" placeholder="Option 1: Salesforce CRM Premium Package
Option 2: HubSpot Enterprise Solution
Option 3: Build custom solution in-house"></textarea>
       
  <h3>Priority</h3>
            <textarea id="priorities" rows="2" placeholder="Cost effectiveness is our top priority"></textarea>
            

</div>

        
        <div class="row1">
       
            
          
            <h3>Constraint</h3>
            <textarea id="constraints" rows="2" placeholder="Budget limit $50,000 total implementation cost"></textarea>
            
            <h3>Timeline</h3>
            <textarea id="timeline" rows="2" placeholder="Must be implemented within 6 months"></textarea>
            
            <h3>Technical</h3>
            <textarea id="technical" rows="2" placeholder="Must integrate with existing Oracle database"></textarea>
            
            <h3>Stakeholders</h3>
            <textarea id="stakeholders" rows="2" placeholder="IT team and executive leadership must approve"></textarea>
            
            <h3>Compliance</h3>
            <textarea id="compliance" rows="2" placeholder="GDPR compliance required for European customers"></textarea>
        
       
            <button class="generate-btn" id="generate-decision-btn">Generate Analysis</button>
        </div>
 
<script type="module">
/*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
*/

// Rate limiting utilities are now available globally via window.rateLimiter

(function() {

  // Generate button handler - simplified to match calorie module pattern
  async function handleGenerateDecisionIq() {
    const formData = window.decisionFormPersistence.getSavedFormData();
    if (!formData) {
      console.error('[DecisionIQ] No input data found in localStorage.');
      alert('Please complete the form before generating a decision analysis.');
      return;
    }

    // Check rate limiting before proceeding
    if (window.rateLimiter.isRateLimited('decision', 10, 60 * 60 * 1000)) { // 10 requests per hour
      alert('You have exceeded the request limit for decision analysis. Please try again later.');
      return;
    }

    // Create worker payload with email for paid users (DRY function)
    const workerPayload = window.rateLimiter.createWorkerPayload('decision', formData);
    
    const dataContainer = document.querySelector('.data-container-in');
    let backendResponse = null;
    try {
      backendResponse = await window.enhancedLoading(
        'generate-decision-btn',
        'decision',
        async () => {
          // Send data to worker
          const apiUrl = 'https://inexasli.com/api/generate';
          const response = await fetch(apiUrl, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(workerPayload)
          });
          let responseData;
          try {
            responseData = await response.json();
          } catch (e) {
            responseData = { error: 'Invalid JSON', message: 'Invalid response from server.' };
          }
          // Always call handleRateLimitResponse with backend response
          window.rateLimiter.handleRateLimitResponse(dataContainer, responseData, !response.ok);
          if (!response.ok) {
            throw new Error(responseData.message || `HTTP error! Status: ${response.status}`);
          }
          if (responseData.message !== 'Success') {
            throw new Error(`An error occurred: ${responseData.message || responseData.error || ''}`);
          }
          
          // Store the response
          window.decisionFormPersistence.saveResponseData(responseData);
          
          // Dispatch an event to notify dataout.js that a response was received
          const event = new CustomEvent('api-response-received', {
            detail: {
              module: 'decisioniq',
              type: 'worker-response',
              timestamp: Date.now()
            }
          });
          document.dispatchEvent(event);
          
          return responseData;
        }
      );
      window.rateLimiter.incrementRequestCount('decision');
    } catch (error) {
      // If backendResponse is available, update rate limit display and show error
      if (backendResponse && dataContainer) {
        window.rateLimiter.handleRateLimitResponse(dataContainer, backendResponse, true);
      }
      // Optionally, show a toast/modal here for generic errors
      console.error('[DecisionIQ] Error:', error);
    }
  }

  // Initialization - simplified to match calorie module pattern
  const generateDecisionBtn = document.getElementById('generate-decision-btn');
  if (generateDecisionBtn) {
    generateDecisionBtn.addEventListener('click', handleGenerateDecisionIq);
    // Set flag to prevent duplicate handler attachment
    generateDecisionBtn.dataset.handlerAttached = 'true';
  }

})();
<!--
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
-->

<script src="../../payment/paymentform.js"></script>

<div class="device-container">
<div class="premium-blur">



        <div class="row1">
            <label class="category-label">Decision Goal</label>
            <textarea id="decision-goal" rows="2" placeholder="Choose a software vendor for our CRM system
Select new office location for regional headquarters"></textarea>
        </div>
        <div class="row1">
            <label class="category-label">Analysis Type</label>
            <select id="decision-analysis-type">
                <option value="" disabled selected>Select Analysis Type</option>
                <option value="swot">SWOT Analysis (90% usefulness)</option>
                <option value="cost-benefit">Cost-Benefit Analysis (85% usefulness)</option>
                <option value="pros-cons">Pros/Cons Analysis (80% usefulness)</option>
                <option value="weighted-scoring">Weighted Scoring (78% usefulness)</option>
                <option value="decision-tree">Decision Tree (75% usefulness)</option>
            </select>
        </div>
        <div class="row1">
            <label class="category-label">Priority Focus</label>
            <select id="decision-priority">
                <option value="" disabled selected>Select Priority Focus</option>
                <option value="speed">Speed - Quick implementation timeframe</option>
                <option value="accuracy">Accuracy - Precise, reliable solution</option>
                <option value="cost">Cost - Budget efficiency</option>
                <option value="long-term-impact">Long-Term Impact - Future benefits</option>
                <option value="simplicity">Simplicity - Ease of use/adoption</option>
                <option value="other">Other - Specified in considerations</option>
            </select>
        </div>
        <div class="row1">
            <label class="category-label">Decision Criteria</label>
            <div class="grid-container" id="decision-criteria">
                <div class="grid-item" data-value="Cost">Cost</div>
                <div class="grid-item" data-value="Quality">Quality</div>
                <div class="grid-item" data-value="Time">Timeline</div>
                <div class="grid-item" data-value="Risk">Risk</div>
                <div class="grid-item" data-value="Features">Features</div>
                <div class="grid-item" data-value="Scalability">Scalability</div>
                <div class="grid-item" data-value="Compatibility">Compatibility</div>
                <div class="grid-item" data-value="Reliability">Reliability</div>
                <div class="grid-item" data-value="User Experience">User Experience</div>
                <div class="grid-item" data-value="Custom">Custom (specify in instructions)</div>
            </div>
        </div>
        <div class="row1">
            <label class="category-label">Decision Options</label>
            <textarea id="decision-options" rows="2" placeholder="Salesforce CRM Premium Package
HubSpot Enterprise Solution"></textarea>
        </div>
        <div class="row1">
            <label class="category-label">Stakeholders</label>
            <div class="grid-container" id="decision-stakeholders">
                <div class="grid-item" data-value="team-members">Team Members</div>
                <div class="grid-item" data-value="executives">Executives</div>
                <div class="grid-item" data-value="customers">Customers</div>
                <div class="grid-item" data-value="partners">Partners</div>
                <div class="grid-item" data-value="regulators">Regulators</div>
                <div class="grid-item" data-value="other">Other</div>
            </div>
        </div>
        <div class="row1">
            <label class="category-label">Constraints Selection</label>
            <div class="grid-container" id="decision-constraint-types">
                <div class="grid-item" data-value="Budget">Budget</div>
                <div class="grid-item" data-value="Timeline">Timeline</div>
                <div class="grid-item" data-value="Resources">Resources</div>
                <div class="grid-item" data-value="Technical">Technical</div>
                <div class="grid-item" data-value="Regulatory">Regulatory</div>
                <div class="grid-item" data-value="Location">Location</div>
                <div class="grid-item" data-value="Legal">Legal</div>
            </div>
        </div>
        <div class="row1">
            <label class="category-label">Constraint Details</label>
            <input id="decision-budget-constraint" type="text" placeholder="Budget: $10,000 USD">
            <input id="decision-timeline-constraint" type="text" placeholder="Timeline: Implementation by Q3 2024">
            <input id="decision-resources-constraint" type="text" placeholder="Resources: Limited IT staff available">
            <input id="decision-technical-constraint" type="text" placeholder="Technical: Must integrate with existing Oracle database">
            <input id="decision-regulatory-constraint" type="text" placeholder="Regulatory: Compliance requirements">
            <input id="decision-location-constraint" type="text" placeholder="Location: Geographic limitations">
            <input id="decision-legal-constraint" type="text" placeholder="Legal: Contractual or liability issues">
            <input id="decision-other-constraint" type="text" placeholder="Other: Additional limiting factors">
        </div>
        <div class="row1">
            <label class="category-label">Specific Considerations</label>
            <textarea id="decision-instructions" rows="6" placeholder="Specific considerations: important details for decision
Solution must support team of 250+ employees worldwide
Need GDPR and HIPAA compliance for all data handling
Budget constraints require financing options over 36 months
Must integrate with existing Microsoft systems
Need multilingual support for global offices"></textarea>
        
       
            <button class="generate-btn" id="generate-decision-btn">Generate Decision Analysis Now!</button>
        </div>
 
<script>
/*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
*/
(function() {
  console.log("Decision IQ script initializing");

  // Generate button handler - CRITICAL MISSING FUNCTIONALITY
  async function handleGenerateDecisionIq() {
    try {
      const formData = window.decisionFormPersistence.getSavedFormData();
      if (!formData) { 
        alert('Please complete the form before generating a decision analysis.'); 
        return;
      }

      // Use enhanced loading with educational facts
      const result = await window.enhancedLoading(
        'generate-decision-btn',
        'decision',
        async () => {
          const apiUrl = 'https://decision.4hm7q4q75z.workers.dev/';
          const response = await fetch(apiUrl, { 
            method: 'POST', 
            headers: {'Content-Type':'application/json'}, 
            body: JSON.stringify(formData) 
          });
          
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          
          const responseData = await response.json();
          if (responseData.message !== 'Success') {
            throw new Error(`An error occurred: ${responseData.message || responseData.error || ''}`);
          }
          
          return responseData;
        }
      );

      // Store the response using centralized system
      window.decisionFormPersistence.saveResponseData(result);
      
      // Dispatch an event to notify dataout.js that a response was received
      const event = new CustomEvent('api-response-received', {
        detail: {
          module: 'decisioniq',
          type: 'worker-response',
          timestamp: Date.now()
        }
      });
      document.dispatchEvent(event);
      console.log('[DecisionIQ] Dispatched api-response-received event');
      
    } catch (error) {
      console.error('[DecisionIQ] Error generating decision analysis:', error);
      alert('An error occurred while generating your decision analysis. Please try again later.');
    }
  }

  // Simple initialization - set up event listeners
  function initialize() {
    console.log("[DecisionIQ] Initializing...");
    
    // Set up generate button event listener - CRITICAL MISSING FUNCTIONALITY
    const generateBtn = document.getElementById('generate-decision-btn');
    if (generateBtn) {
      generateBtn.removeEventListener('click', handleGenerateDecisionIq);
      generateBtn.addEventListener('click', handleGenerateDecisionIq);
      console.log("[DecisionIQ] Generate button event listener set up");
    } else {
      console.error("[DecisionIQ] Generate button not found!");
    }
    
    // Set up guided forms toggle button
    const guidedToggleBtn = document.getElementById('guided-forms-toggle');
    if (guidedToggleBtn) {
      guidedToggleBtn.removeEventListener('click', toggleGuidedForms);
      guidedToggleBtn.addEventListener('click', toggleGuidedForms);
    }
  }

  // Toggle guided forms functionality
  let guidedFormsInstance = null;
  
  function toggleGuidedForms() {
    console.log('[DecisionIQ] Toggling guided forms');
    const toggleBtn = document.getElementById('guided-forms-toggle');
    
    if (guidedFormsInstance) {
      // Disable guided forms
      guidedFormsInstance.destroy();
      guidedFormsInstance = null;
      toggleBtn.textContent = '🚀 Enable Guided Form';
      toggleBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
      console.log('[DecisionIQ] Guided forms disabled');
    } else {
      // Enable guided forms
      if (window.GuidedFormSystem) {
        guidedFormsInstance = new window.GuidedFormSystem({
          autoAdvance: true,
          showProgressIndicator: true,
          smoothTransitions: true,
          transitionDuration: 300,
          autoAdvanceDelay: 800,
          enableSkipping: true
        });
        
        guidedFormsInstance.init('device-container');
        
        toggleBtn.textContent = '⏹️ Disable Guided Form';
        toggleBtn.style.background = 'linear-gradient(135deg, #ea667e 0%, #a24b76 100%)';
        console.log('[DecisionIQ] Guided forms enabled');
      } else {
        console.error('[DecisionIQ] GuidedFormSystem not available');
        alert('Guided forms system is not loaded. Please refresh the page.');
      }
    }
  }

  // Initialize with multiple triggers to ensure reliability
  function runInitialization() {
    // Use a small delay to ensure DOM is ready
    setTimeout(initialize, 50);
  }

  // Initialize form persistence when DOM is ready
  function initializeDecisionIQ() {
    console.log("Decision IQ DOM ready, initializing form persistence");
    
    // Import and initialize form persistence
    import('../../utility/formPersistence.js').then(module => {
      const FormPersistence = module.FormPersistence;
      const persistence = FormPersistence.getInstance('decision', {
        singleSelection: ['decision-analysis-type', 'decision-priority'], // Single selection containers  
        multiSelection: ['decision-criteria', 'decision-constraint-types', 'decision-stakeholders'] // Multi selection containers
      });
      
      persistence.init({
        moduleName: 'decision',
        singleSelection: ['decision-analysis-type', 'decision-priority'],
        multiSelection: ['decision-criteria', 'decision-constraint-types', 'decision-stakeholders']
      });
      
      console.log("Decision IQ form persistence initialized");
      
      // Initialize the rest of the functionality after form persistence is set up
      runInitialization();
    }).catch(error => {
      console.error("Failed to initialize Decision IQ form persistence:", error);
    });
  }

  // Initialize immediately if DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeDecisionIQ);
  } else {
    initializeDecisionIQ();
  }

  // Handle loading through datain.js
  document.addEventListener('data-in-loaded', function(e) {
    console.log("[DecisionIQ] Detected load through datain.js, reinitializing");
    runInitialization();
  });

  // Additional safety net - try again after a short delay
  setTimeout(() => {
    const generateBtn = document.getElementById('generate-decision-btn');
    if (generateBtn && !generateBtn.onclick) {
      console.log("[DecisionIQ] Generate button found but no handler, trying initialization again");
      initialize();
    }
  }, 200);
  
  // Export functions for external access
  window.decisionIq = { 
    getFormData: () => window.decisionFormPersistence.getSavedFormData(),
    saveFormData: () => window.decisionFormPersistence.saveFormData()
  };

})();
</script>
</div>
</div>
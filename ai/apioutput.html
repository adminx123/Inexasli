<!--
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be prosecuted to the fullest extent of the law in British Columbia, Canada, and applicable jurisdictions worldwide.
-->
<div class="api-output-container">
  <div class="api-output" id="api-output">Loading...</div>
  <button class="copy-btn" onclick="copyApiOutput()">Copy</button>
</div>

<script>
/*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be prosecuted to the fullest extent of the law in British Columbia, Canada, and applicable jurisdictions worldwide.
 */

// Ultra simple display function - just shows whatever is in localStorage
function displayApiOutput() {
  try {
    // Get URL parameter
    const urlParams = new URLSearchParams(window.location.search);
    const gridItem = urlParams.get('gridItem') || 'default';
    console.log("SIMPLE DEBUG: gridItem =", gridItem);
    
    // Map to storage key
    const storageKeys = {
      'calorieiq': 'calorieIqResponse',
      'bookiq': 'bookIqResponse',
      'symptomiq': 'symptomIqResponse',
      'default': 'apiResponse'
    };
    
    const storageKey = storageKeys[gridItem.toLowerCase()] || storageKeys['default'];
    console.log("SIMPLE DEBUG: storageKey =", storageKey);
    
    // Get data from localStorage
    const storedData = localStorage.getItem(storageKey);
    console.log("SIMPLE DEBUG: storedData found =", !!storedData);
    
    if (storedData) {
      try {
        // Parse the outer JSON (from the worker response)
        const parsedData = JSON.parse(storedData);
        console.log("SIMPLE DEBUG: parsed worker response:", parsedData);
        
        if (parsedData.text) {
          try {
            // The text property might be a JSON string from xAI
            const parsedText = JSON.parse(parsedData.text);
            console.log("SIMPLE DEBUG: parsed text property:", parsedText);
            
            // Look for the "Response" field in the parsed text
            if (parsedText.Response) {
              document.getElementById('api-output').innerText = parsedText.Response;
              console.log("SIMPLE DEBUG: Displaying Response field");
            } else {
              // No Response field found, just display the parsed text
              document.getElementById('api-output').innerText = JSON.stringify(parsedText, null, 2);
              console.log("SIMPLE DEBUG: Displaying full parsed text content");
            }
          } catch (textParseError) {
            // If text isn't valid JSON, just display it directly
            document.getElementById('api-output').innerText = parsedData.text;
            console.log("SIMPLE DEBUG: Displaying text property directly (not JSON)");
          }
        } else if (parsedData.data) {
          // Old format with data property
          document.getElementById('api-output').innerText = parsedData.data;
          console.log("SIMPLE DEBUG: Displaying data property");
        } else {
          // No text or data property found
          document.getElementById('api-output').innerText = JSON.stringify(parsedData, null, 2);
          console.log("SIMPLE DEBUG: Displaying full response");
        }
      } catch (jsonError) {
        // If we can't parse the JSON, just show the raw data
        document.getElementById('api-output').innerText = storedData;
        console.log("SIMPLE DEBUG: Displaying raw localStorage content (JSON parse failed)");
      }
    } else {
      document.getElementById('api-output').innerText = 'No data available in localStorage for ' + storageKey;
      console.log("SIMPLE DEBUG: No data found in localStorage");
    }
  } catch (error) {
    document.getElementById('api-output').innerText = 'Error: ' + error.message;
    console.error("Error in displayApiOutput:", error);
  }
}

// Copy output to clipboard
function copyApiOutput() {
  const output = document.getElementById('api-output').innerText;
  navigator.clipboard.writeText(output)
    .then(() => {
      alert('Copied to clipboard!');
    })
    .catch(err => {
      alert('Failed to copy: ' + err);
    });
}

// Display output when page loads
document.addEventListener('DOMContentLoaded', function() {
  console.log("SIMPLE DEBUG: DOMContentLoaded fired");
  displayApiOutput();
});
</script>

<style>
.api-output-container {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  padding: 15px;
  max-width: 100%;
  word-wrap: break-word;
}

.api-output {
  white-space: pre-wrap;
  line-height: 1.5;
  margin-bottom: 15px;
  font-family: monospace;
}

.copy-btn {
  background-color: #3498db;
  color: white;
  border: none;
  padding: 8px 15px;
  border-radius: 4px;
  cursor: pointer;
  font-weight: bold;
}

.copy-btn:hover {
  background-color: #2980b9;
}
</style>
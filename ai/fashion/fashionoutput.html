<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fashion Analysis Output</title>
  
  <!-- Preconnect and font links -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="../styles/outputstyles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    /* Using device-container, output-wrapper and api-output styles from outputstyles.css */
    
    .fashion-display {
      font-family: "Inter", sans-serif;
      font-size: 16px;
      line-height: 1.6;
      white-space: normal;
    }
    
    .fashion-header {
      text-align: center;
      margin-bottom: 25px;
    }
    
    .style-score-section {
      background: white;
      color: #4a7c59;
      border: 1px solid #4a7c59;
      padding: 15px;
      border-radius: 5px;
      margin-bottom: 20px;
      text-align: center;
      font-weight: bold;
      font-size: 18px;
    }
    
    .outfit-analysis-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }
    
    .outfit-card {
      background: #f2f9f3;
      border: 1px solid #4a7c59;
      border-radius: 8px;
      padding: 15px;
      transition: transform 0.2s ease;
    }
    
    .outfit-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(74, 124, 89, 0.15);
    }
    
    .outfit-title {
      font-weight: 600;
      color: #2d5d3d;
      margin-bottom: 10px;
      font-size: 18px;
    }
    
    .outfit-rating {
      background: #4a7c59;
      color: white;
      padding: 5px 10px;
      border-radius: 15px;
      font-size: 14px;
      font-weight: 500;
      display: inline-block;
      margin-bottom: 10px;
    }
    
    .color-palette-section {
      background: #f8fdf9;
      border: 1px solid #4a7c59;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 25px;
    }
    
    .color-palette-title {
      font-weight: 600;
      color: #2d5d3d;
      margin-bottom: 15px;
      font-size: 20px;
      text-align: center;
    }
    
    .color-recommendations {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 15px;
    }
    
    .color-category {
      background: white;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 15px;
    }
    
    .color-category-title {
      font-weight: 600;
      color: #2d5d3d;
      margin-bottom: 10px;
      text-transform: uppercase;
      font-size: 14px;
      letter-spacing: 0.5px;
    }
    
    .styling-tips-section {
      background: #fff;
      border: 1px solid #4a7c59;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 25px;
    }
    
    .tips-title {
      font-weight: 600;
      color: #2d5d3d;
      margin-bottom: 15px;
      font-size: 20px;
      text-align: center;
    }
    
    .tip-item {
      background: #f2f9f3;
      border-left: 4px solid #4a7c59;
      padding: 15px;
      margin-bottom: 15px;
      border-radius: 0 6px 6px 0;
    }
    
    .tip-icon {
      color: #4a7c59;
      margin-right: 10px;
      font-size: 18px;
    }
    
    .fit-analysis-section {
      background: #f8fdf9;
      border: 1px solid #4a7c59;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 25px;
    }
    
    .fit-title {
      font-weight: 600;
      color: #2d5d3d;
      margin-bottom: 15px;
      font-size: 20px;
      text-align: center;
    }
    
    .improvement-suggestions {
      background: #fff4e6;
      border: 1px solid #ff9800;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 25px;
    }
    
    .improvement-title {
      font-weight: 600;
      color: #e65100;
      margin-bottom: 15px;
      font-size: 20px;
      text-align: center;
    }
    
    .suggestion-item {
      background: white;
      border: 1px solid #ffcc80;
      border-radius: 6px;
      padding: 15px;
      margin-bottom: 15px;
    }
    
    .star-rating {
      color: #ffd700;
      margin-right: 5px;
    }
    
    .data-section {
      background: #f5f5f5;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 15px;
      margin-top: 20px;
      font-size: 14px;
      color: #666;
    }
    
    .data-label {
      font-weight: 600;
      color: #333;
      margin-bottom: 5px;
    }
    
    .uploaded-images-display {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }
    
    .outfit-image {
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }
    
    .outfit-image img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      display: block;
    }
    
    /* Add magazine cover and article styles */
    .magazine-cover {
      background: linear-gradient(135deg, #f8f9fa 60%, #e0e7ef 100%);
      border-radius: 18px 18px 0 0;
      box-shadow: 0 6px 24px rgba(44,62,80,0.08);
      padding: 32px 24px 16px 24px;
      text-align: center;
      position: relative;
      margin-bottom: 0;
    }
    .magazine-title {
      font-family: 'Playfair Display', serif;
      font-size: 2.8rem;
      font-weight: 700;
      letter-spacing: 0.08em;
      color: #2d5d3d;
      margin-bottom: 18px;
      text-shadow: 0 2px 8px rgba(44,62,80,0.08);
    }
    .cover-image-section {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 220px;
      margin-bottom: 0;
    }
    .cover-image {
      border-radius: 12px;
      box-shadow: 0 4px 18px rgba(44,62,80,0.13);
      width: 220px;
      height: 220px;
      object-fit: cover;
      border: 4px solid #fff;
    }
    .cover-placeholder {
      width: 220px;
      height: 220px;
      background: #e0e7ef;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #aaa;
      font-size: 1.2rem;
      border: 4px solid #fff;
    }
    .magazine-article-section {
      background: #fff;
      border-radius: 0 0 18px 18px;
      box-shadow: 0 2px 8px rgba(44,62,80,0.04);
      padding: 32px 24px 24px 24px;
      margin-top: 0;
    }
    @media (max-width: 600px) {
      .magazine-cover, .magazine-article-section {
        padding: 16px 6px;
      }
      .cover-image, .cover-placeholder {
        width: 120px;
        height: 120px;
      }
      .magazine-title {
        font-size: 1.6rem;
      }
    }
  </style>
</head>
<body>
  <div class="device-container">
    <div class="output-wrapper">
      <div class="api-output">
        
        <div class="fashion-header">
          <h1><i class="fas fa-tshirt"></i> Your Fashion Analysis</h1>
          <p>AI-powered style critique and recommendations</p>
        </div>

        <div class="magazine-cover">
          <div class="magazine-title">FashionIQ</div>
          <div class="cover-image-section" id="cover-image-section"></div>
        </div>
        <div class="magazine-article-section">
          <div class="style-score-section" id="overall-score">
            <i class="fas fa-star star-rating"></i>
            Loading your fashion analysis...
          </div>
          <div class="fashion-display" id="fashion-content">
            <!-- AI response will be populated here -->
          </div>
          <div class="data-section">
            <div class="data-label">Your Style Profile:</div>
            <div id="style-data"></div>
          </div>
        </div>

      </div>
    </div>
  </div>

  <script>
  (function() {
    // Helper to safely get and parse JSON from localStorage
    function getJSON(key) {
      try {
        const item = localStorage.getItem(key);
        return item ? JSON.parse(item) : null;
      } catch (e) {
        console.error('[FashionOutput] Error parsing JSON for key', key, e);
        return null;
      }
    }

    function updateOutput() {
      const fashionContent = document.getElementById('fashion-content');
      const scoreSection = document.getElementById('overall-score');
      if (!fashionContent || !scoreSection) {
        setTimeout(updateOutput, 100);
        return;
      }
      let data = getJSON('fashionIqResponse');
      if (!data) {
        // Fallback: try direct parse
        const raw = localStorage.getItem('fashionIqResponse');
        if (raw) {
          try { data = JSON.parse(raw); } catch (e) { data = null; }
        }
      }
      if (data && data.message === 'Success' && data.data) {
        data = data.data;
      }
      if (!data) {
        fashionContent.innerHTML = `<div class="error-message"><i class="fas fa-exclamation-triangle"></i><h3>No Results Found</h3><p>No fashion analysis results were found. Please try again.</p></div>`;
        scoreSection.innerHTML = `<i class="fas fa-star star-rating"></i> No Score`;
        return;
      }
      // Try to extract content
      let content = null;
      if (data.choices && data.choices[0] && data.choices[0].message) {
        content = data.choices[0].message.content;
      } else if (data.content) {
        content = data.content;
      } else if (data.fashionAnalysis) {
        content = data.fashionAnalysis;
      } else if (typeof data === 'string') {
        content = data;
      }
      if (!content) {
        fashionContent.innerHTML = `<div class="error-message"><i class="fas fa-exclamation-triangle"></i><h3>Invalid Response Format</h3><pre>${JSON.stringify(data, null, 2)}</pre></div>`;
        scoreSection.innerHTML = `<i class="fas fa-star star-rating"></i> No Score`;
        return;
      }
      // Score extraction
      const scoreMatch = content.match(/(?:overall|total|style)\s*(?:score|rating):\s*(\d+(?:\.\d+)?(?:\/\d+)?|\d+\s*(?:out of|\/)\s*\d+)/i);
      if (scoreMatch) {
        scoreSection.innerHTML = `<i class=\"fas fa-star star-rating\"></i> Overall Style Score: ${scoreMatch[1]}`;
      } else {
        scoreSection.innerHTML = `<i class=\"fas fa-star star-rating\"></i> Style Analysis`;
      }
      // Format content
      let formattedContent = content
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\*(.*?)\*/g, '<em>$1</em>')
        .replace(/(\d+)\.\s/g, '<br><strong>$1.</strong> ')
        .replace(/\n\n/g, '</p><p>')
        .replace(/\n/g, '<br>');
      fashionContent.innerHTML = `<div class=\"formatted-response\"><p>${formattedContent}</p></div>`;
      // Images
      const userData = getJSON('fashionIqInput');
      const imagesDisplay = document.getElementById('images-display');
      if (userData && userData.images && imagesDisplay) {
        imagesDisplay.innerHTML = userData.images.map((img, i) => `<div class=\"outfit-image\"><img src=\"${img}\" alt=\"Outfit ${i+1}\"></div>`).join('');
      }
      // Images for magazine cover (first image as cover)
      const coverImageSection = document.getElementById('cover-image-section');
      if (userData && userData.images && userData.images.length && coverImageSection) {
        coverImageSection.innerHTML = `<img class="cover-image" src="${userData.images[0]}" alt="Magazine Cover">`;
      } else if (coverImageSection) {
        coverImageSection.innerHTML = '<div class="cover-placeholder">No Image Uploaded</div>';
      }
      // Style profile
      const styleData = document.getElementById('style-data');
      if (userData && styleData) {
        const profile = [
          userData.personalStyle && `Personal Style: ${userData.personalStyle}`,
          userData.skinTone && `Skin Tone: ${userData.skinTone}`,
          userData.hairColor && `Hair Color: ${userData.hairColor}`,
          userData.occasion && `Occasion: ${userData.occasion}`,
          userData.location && `Location: ${userData.location}`,
          userData.season && `Season: ${userData.season}`,
          userData.age && `Age: ${userData.age}`,
          userData.height && `Height: ${userData.height}`,
          userData.gender && `Gender: ${userData.gender}`
        ].filter(Boolean).join(' â€¢ ');
        styleData.textContent = profile || 'No profile data available';
      }
    }
    setTimeout(updateOutput, 50);
  })();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fashion Analysis Output</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f8f9fa;
      margin: 0;
      padding: 0;
    }
    .device-container {
      max-width: 420px;
      margin: 32px auto;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 6px 24px rgba(44,62,80,0.08);
      overflow: hidden;
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }
    .photo-frame {
      width: 100%;
      max-width: 420px;
      aspect-ratio: 1/1;
      background: #f2f9f3; /* Muted green background */
      display: flex;
      justify-content: center;
      align-items: center;
      border-bottom: 1px solid #e0e7ef;
      margin: 0 auto;
      min-height: 220px;
      max-height: 420px;
      overflow: hidden;
    }
    .photo-border-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 100%;
      background: #f2f9f3; /* Muted green background */
      border: none;
      box-shadow: none;
    }
    .photo-border-img {
      max-width: 100%;
      max-height: 100%;
      width: auto;
      height: auto;
      object-fit: contain;
      border-radius: 12px;
      background: #fff;
      display: block;
      border: 2.5px solid #4a7c59;
      box-shadow: 0 2px 8px rgba(44,62,80,0.06);
    }
    .photo-placeholder {
      width: 100%;
      height: 100%;
      min-height: 220px;
      background: #e0e7ef;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #aaa;
      font-size: 1.2rem;
    }
    .score-section {
      text-align: center;
      font-weight: 600;
      font-size: 1.1rem;
      color: #4a7c59;
      margin: 18px 0 8px 0;
      letter-spacing: 0.02em;
    }
    .fashion-content {
      padding: 0 18px 18px 18px;
      font-size: 1rem;
      color: #222;
      min-height: 80px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }
    .analysis-card {
      background: #f8f9fa;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(44,62,80,0.04);
      padding: 18px 14px;
      margin-top: 8px;
      width: 100%;
      max-width: 340px;
      min-height: 60px;
      text-align: left;
      font-size: 1.02rem;
      color: #2d5d3d;
      word-break: break-word;
    }
    .analysis-title {
      font-weight: 700;
      font-size: 1.08rem;
      margin-bottom: 6px;
      color: #4a7c59;
    }
    .json-warning {
      color: #e65100;
      font-size: 0.95rem;
      margin-bottom: 6px;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="device-container">
    <div class="photo-frame" id="photo-frame">
      <!-- Photo will be inserted here -->
    </div>
    <div class="score-section" id="overall-score">Loading...</div>
    <div class="fashion-content" id="fashion-content"></div>
  </div>
  <script>
  (function() {
    function getJSON(key) {
      try {
        const item = localStorage.getItem(key);
        return item ? JSON.parse(item) : null;
      } catch (e) {
        return null;
      }
    }
    function displayFashionAnalysis(data, container) {
      container.innerHTML = '';
      container.classList.add('fashion-display');
      // If string, just show it
      if (typeof data === 'string') {
        const div = document.createElement('div');
        div.className = 'analysis-card';
        div.innerHTML = data
          .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
          .replace(/\*(.*?)\*\*/g, '<em>$1</em>')
          .replace(/\n\n/g, '</p><p>')
          .replace(/\n/g, '<br>');
        container.appendChild(div);
        return;
      }
      // If object, show key fields in a beautiful, minimalist, user-captivating way
      const card = document.createElement('div');
      card.className = 'analysis-card';
      // --- Overall Score ---
      if (data.overallRating && typeof data.overallRating.score !== 'undefined') {
        const scoreDiv = document.createElement('div');
        scoreDiv.style.cssText = 'font-size:2.2rem;font-weight:700;color:#4a7c59;text-align:center;margin-bottom:8px;';
        scoreDiv.innerHTML = `<i class=\"fas fa-star star-rating\"></i> ${data.overallRating.score} / 10`;
        card.appendChild(scoreDiv);
        if (data.overallRating.explanation) {
          const expl = document.createElement('div');
          expl.style.cssText = 'color:#555;font-size:1.05rem;text-align:center;margin-bottom:16px;';
          expl.textContent = data.overallRating.explanation;
          card.appendChild(expl);
        }
      }
      // --- Category Scores ---
      if (Array.isArray(data.analysisScores) && data.analysisScores.length) {
        const catSection = document.createElement('div');
        catSection.style.cssText = 'margin-bottom:16px;';
        data.analysisScores.forEach(s => {
          const row = document.createElement('div');
          row.style.cssText = 'display:flex;justify-content:space-between;align-items:center;padding:4px 0;font-size:1rem;';
          row.innerHTML = `<span style='color:#2d5d3d;font-weight:500;'>${s.category}</span><span style='color:#4a7c59;font-weight:600;'>${s.score}/10</span>`;
          catSection.appendChild(row);
          if (s.feedback) {
            const fb = document.createElement('div');
            fb.style.cssText = 'color:#888;font-size:0.97rem;margin-bottom:6px;margin-left:2px;';
            fb.textContent = s.feedback;
            catSection.appendChild(fb);
          }
        });
        card.appendChild(catSection);
      }
      // --- Outfit Breakdown ---
      if (Array.isArray(data.outfitBreakdown) && data.outfitBreakdown.length) {
        const ob = data.outfitBreakdown[0];
        const obDiv = document.createElement('div');
        obDiv.style.cssText = 'margin-bottom:16px;';
        obDiv.innerHTML = `<div style='font-weight:600;color:#4a7c59;margin-bottom:4px;'>Outfit</div><div style='color:#222;margin-bottom:4px;'>${ob.garments.join(', ')}</div>`;
        if (ob.strengths && ob.strengths.length) {
          obDiv.innerHTML += `<div style='color:#2d5d3d;font-size:0.98rem;margin-bottom:2px;'><b>Strengths:</b> ${ob.strengths.join('; ')}</div>`;
        }
        if (ob.improvements && ob.improvements.length) {
          obDiv.innerHTML += `<div style='color:#e65100;font-size:0.98rem;'><b>Improvements:</b> ${ob.improvements.join('; ')}</div>`;
        }
        card.appendChild(obDiv);
      }
      // --- Body Type Analysis ---
      if (data.bodyTypeAnalysis) {
        const bta = data.bodyTypeAnalysis;
        const btaDiv = document.createElement('div');
        btaDiv.style.cssText = 'margin-bottom:16px;';
        btaDiv.innerHTML = `<div style='font-weight:600;color:#4a7c59;margin-bottom:4px;'>Body Type: <span style='color:#2d5d3d;'>${bta.estimatedBodyType}</span></div>`;
        if (bta.strengths && bta.strengths.length) {
          btaDiv.innerHTML += `<div style='color:#2d5d3d;font-size:0.98rem;'><b>Strengths:</b> ${bta.strengths.join('; ')}</div>`;
        }
        if (bta.recommendedStyles && bta.recommendedStyles.length) {
          btaDiv.innerHTML += `<div style='color:#4a7c59;font-size:0.98rem;'><b>Recommended Styles:</b> ${bta.recommendedStyles.join('; ')}</div>`;
        }
        if (bta.avoidStyles && bta.avoidStyles.length) {
          btaDiv.innerHTML += `<div style='color:#e65100;font-size:0.98rem;'><b>Avoid:</b> ${bta.avoidStyles.join('; ')}</div>`;
        }
        card.appendChild(btaDiv);
      }
      // --- Color Analysis ---
      if (data.colorAnalysis) {
        const ca = data.colorAnalysis;
        const caDiv = document.createElement('div');
        caDiv.style.cssText = 'margin-bottom:16px;';
        caDiv.innerHTML = `<div style='font-weight:600;color:#4a7c59;margin-bottom:4px;'>Color Analysis</div>`;
        if (ca.skinTone) caDiv.innerHTML += `<div style='color:#2d5d3d;'>Skin Tone: ${ca.skinTone}</div>`;
        if (ca.bestColors && ca.bestColors.length) caDiv.innerHTML += `<div style='color:#4a7c59;font-size:0.98rem;'><b>Best Colors:</b> ${ca.bestColors.join(', ')}</div>`;
        if (ca.avoidColors && ca.avoidColors.length) caDiv.innerHTML += `<div style='color:#e65100;font-size:0.98rem;'><b>Avoid:</b> ${ca.avoidColors.join(', ')}</div>`;
        if (ca.seasonalPalette) caDiv.innerHTML += `<div style='color:#2d5d3d;'>Palette: ${ca.seasonalPalette}</div>`;
        card.appendChild(caDiv);
      }
      // --- Specific Recommendations ---
      if (Array.isArray(data.specificRecommendations) && data.specificRecommendations.length) {
        const srDiv = document.createElement('div');
        srDiv.style.cssText = 'margin-bottom:16px;';
        srDiv.innerHTML = `<div style='font-weight:600;color:#4a7c59;margin-bottom:4px;'>Quick Tips</div>`;
        data.specificRecommendations.forEach(r => {
          srDiv.innerHTML += `<div style='color:#2d5d3d;font-size:0.98rem;margin-bottom:2px;'><b>${r.item}:</b> <span style='color:#4a7c59;'>${r.reason}</span> <span style='color:#888;font-size:0.95em;'>(${r.priority}, ${r.cost})</span></div>`;
        });
        card.appendChild(srDiv);
      }
      // --- Shopping List ---
      if (Array.isArray(data.shoppingList) && data.shoppingList.length) {
        const shopDiv = document.createElement('div');
        shopDiv.style.cssText = 'margin-bottom:16px;';
        shopDiv.innerHTML = `<div style='font-weight:600;color:#4a7c59;margin-bottom:4px;'>Shopping List</div>`;
        data.shoppingList.forEach(item => {
          shopDiv.innerHTML += `<div style='color:#2d5d3d;font-size:0.98rem;margin-bottom:2px;'><b>${item.item}</b> <span style='color:#888;font-size:0.95em;'>(${item.priceRange}, ${item.priority})</span></div>`;
        });
        card.appendChild(shopDiv);
      }
      // --- Style Evolution ---
      if (data.styleEvolution) {
        const se = data.styleEvolution;
        const seDiv = document.createElement('div');
        seDiv.style.cssText = 'margin-bottom:16px;';
        seDiv.innerHTML = `<div style='font-weight:600;color:#4a7c59;margin-bottom:4px;'>Style Evolution</div>`;
        if (se.currentLevel) seDiv.innerHTML += `<div style='color:#2d5d3d;'>Current: ${se.currentLevel}</div>`;
        if (se.nextSteps && se.nextSteps.length) seDiv.innerHTML += `<div style='color:#4a7c59;font-size:0.98rem;'><b>Next Steps:</b> ${se.nextSteps.join('; ')}</div>`;
        if (se.longTermGoals && se.longTermGoals.length) seDiv.innerHTML += `<div style='color:#2d5d3d;font-size:0.98rem;'><b>Long Term Goals:</b> ${se.longTermGoals.join('; ')}</div>`;
        card.appendChild(seDiv);
      }
      container.appendChild(card);
    }
    function updateOutput() {
      const fashionContent = document.getElementById('fashion-content');
      const scoreSection = document.getElementById('overall-score');
      const photoFrame = document.getElementById('photo-frame');
      let data = getJSON('fashionIqResponse');
      if (!data) {
        const raw = localStorage.getItem('fashionIqResponse');
        if (raw) {
          try { data = JSON.parse(raw); } catch (e) { data = null; }
        }
      }
      if (data && data.message === 'Success' && data.data) {
        data = data.data;
      }
      // Extract content
      let content = null;
      if (data && data.choices && data.choices[0] && data.choices[0].message) {
        content = data.choices[0].message.content;
      } else if (data && data.content) {
        content = data.content;
      } else if (data && data.fashionAnalysis) {
        content = data.fashionAnalysis;
      } else if (typeof data === 'string') {
        content = data;
      }
      // Score extraction
      let scoreMatch = null;
      if (typeof content === 'string') {
        scoreMatch = content.match(/(?:overall|total|style)\s*(?:score|rating):\s*(\d+(?:\.\d+)?(?:\/\d+)?|\d+\s*(?:out of|\/)\s*\d+)/i);
      }
      if (scoreMatch) {
        scoreSection.innerHTML = `<i class=\"fas fa-star star-rating\"></i> Overall Style Score: ${scoreMatch[1]}`;
      } else {
        scoreSection.innerHTML = `<i class=\"fas fa-star star-rating\"></i> Style Analysis`;
      }
      // Render content
      displayFashionAnalysis(content, fashionContent);
      // Photo
      const userData = getJSON('fashionIqInput');
      if (userData && userData.images && userData.images.length) {
        photoFrame.innerHTML = `<div class="photo-border-wrapper"><img class="photo-border-img" src="${userData.images[0]}" alt="Outfit Photo"></div>`;
      } else {
        photoFrame.innerHTML = '<div class="photo-placeholder">No Image Uploaded</div>';
      }
    }
    setTimeout(updateOutput, 50);
  })();
  </script>
</body>
</html>

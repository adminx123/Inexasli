<!-- /*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
 */ -->

<div class="device-container">

  <div class="row1 product-description-container">
    <h2 class="product-description-heading">Get AI-Powered Fashion Critique!</h2>
    <p class="product-description-text">
        Want honest feedback on how your outfits look? Upload photos of yourself wearing different outfits and get personalized fashion critique from our advanced AI. Our system analyzes not just whether an outfit looks good, but how it specifically suits you based on your complexion, body type, and personal style. Get recommendations on colors that complement your skin tone, styling tips, and honest assessments of how each piece works together.
    </p>
    <p class="product-description-disclaimer">
        <em>Important: The fashion advice and critiques provided by this tool are for entertainment and informational purposes only and are generated by artificial intelligence. Fashion is subjective, and personal style choices are yours to make. The AI's recommendations are based on general fashion principles and may not account for personal preferences, cultural considerations, or individual circumstances. We make no guarantees regarding the accuracy or suitability of the advice. Use of this tool and its outputs is at your own discretion.</em>
    </p>
    <p class="product-description-final">
        Let's analyze your style!
    </p>
</div>

<div class="row1" data-step-label="Personal Style">
    <div class="grid-container" id="fashion-personal-style">
        <div class="grid-item" data-value="Casual">Casual & Comfortable</div>
        <div class="grid-item" data-value="Business">Business & Professional</div>
        <div class="grid-item" data-value="Formal">Formal & Elegant</div>
        <div class="grid-item" data-value="Trendy">Trendy & Fashion-Forward</div>
        <div class="grid-item" data-value="Classic">Classic & Timeless</div>
        <div class="grid-item" data-value="Bohemian">Bohemian & Artistic</div>
        <div class="grid-item" data-value="Minimalist">Minimalist & Clean</div>
        <div class="grid-item" data-value="Eclectic">Eclectic & Unique</div>
    </div>
</div>





<div class="row1" data-step-label="Personal Information">
    <input id="fashion-age" type="text" placeholder="Age">
    <input id="fashion-height" type="text" placeholder="5'6">
    <select id="fashion-gender">
        <option value="" disabled selected>Select Gender</option>
        <option value="woman">Woman</option>
        <option value="man">Man</option>
    </select>
</div>

<div class="row1" data-step-label="Climate/Weather Context">
    <div class="grid-container" id="fashion-climate">
        <div class="grid-item" data-value="Cold Climate">Cold Climate (snow, freezing temperatures)</div>
        <div class="grid-item" data-value="Temperate Climate">Temperate Climate (four seasons, moderate weather)</div>
        <div class="grid-item" data-value="Warm Climate">Warm Climate (mild winters, no snow)</div>
        <div class="grid-item" data-value="Hot & Dry Climate">Hot & Dry Climate (desert-like, sun protection)</div>
        <div class="grid-item" data-value="Hot & Humid Climate">Hot & Humid Climate (tropical, breathable fabrics)</div>
        <div class="grid-item" data-value="Indoor/Climate Controlled">Indoor/Climate Controlled (no weather concerns)</div>
    </div>
</div>

<div class="row1" data-step-label="Event/Occasion">
    <div class="grid-container" id="fashion-occasion">
        <div class="grid-item" data-value="Work">Work/Office</div>
        <div class="grid-item" data-value="Casual Day">Casual Day Out</div>
        <div class="grid-item" data-value="Date Night">Date Night</div>
        <div class="grid-item" data-value="Party">Party/Event</div>
        <div class="grid-item" data-value="Travel">Travel/Vacation</div>
        <div class="grid-item" data-value="Exercise">Gym/Exercise</div>
        <div class="grid-item" data-value="Formal Event">Formal Event</div>
        <div class="grid-item" data-value="Everyday">Everyday Wear</div>
        <div class="grid-item" data-value="Special Occasion">Special Occasion</div>
        <div class="grid-item" data-value="Interview">Job Interview</div>
        <div class="grid-item" data-value="Wedding">Wedding Guest</div>
        <div class="grid-item" data-value="Brunch">Brunch/Social</div>
    </div>
</div>

<div class="row1" data-step-label="Upload Outfit Photos">
    <div class="image-upload-container">
        <div class="upload-area" id="fashion-upload-area">
            <i class="fas fa-camera upload-icon"></i>
            <p>Click here to upload photos or drag and drop</p>
            <p class="upload-hint">Upload 1-5 photos of yourself in different outfits</p>
            <input type="file" id="fashion-image-input" multiple accept="image/*" style="display: none;">
        </div>
        <div class="uploaded-images" id="fashion-uploaded-images"></div>
    </div>
    <textarea id="fashion-additional-context" placeholder="Any additional context about the outfits, specific concerns, or what you'd like feedback on? (Optional)"></textarea>
    <button class="generate-btn" id="generate-fashion-btn" disabled>Analyze My Style!</button>
</div>
   
</div> 

<script>
/*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
*/

(function() {
  console.log("Fashion IQ script: Starting"); // New log

  let uploadedImages = [];

  // Initialize upload functionality
  function initializeImageUpload() {
    console.log("Fashion IQ: Initializing image upload."); // Changed log
    const uploadArea = document.getElementById('fashion-upload-area');
    const fileInput = document.getElementById('fashion-image-input');
    const uploadedImagesContainer = document.getElementById('fashion-uploaded-images');
    const generateBtn = document.getElementById('generate-fashion-btn');

    // console.log("Fashion IQ: uploadArea element:", uploadArea); // Kept for now
    // console.log("Fashion IQ: fileInput element:", fileInput);   // Kept for now

    if (!uploadArea) {
        console.error("Fashion IQ: Critical element 'fashion-upload-area' not found.");
        return;
    }
    if (!fileInput) {
        console.error("Fashion IQ: Critical element 'fashion-image-input' not found.");
        return;
    }
    console.log("Fashion IQ: uploadArea and fileInput elements seem to be found by the IDs.");


    // Click to upload
    uploadArea.addEventListener('click', () => {
      console.log('Fashion IQ: Upload area clicked.');
      const freshFileInput = document.getElementById('fashion-image-input');
      if (freshFileInput) {
        console.log('Fashion IQ: Found freshFileInput. ID:', freshFileInput.id, 'Parent Node:', freshFileInput.parentNode); // Detailed log
        try {
          freshFileInput.click();
          console.log('Fashion IQ: freshFileInput.click() was called.'); // Confirmation log
        } catch (e) {
          console.error('Fashion IQ: Error occurred when calling freshFileInput.click():', e); // Error catching
        }
      } else {
        console.error('Fashion IQ: freshFileInput (id: fashion-image-input) not found at time of click!');
      }
    });

    // Drag and drop functionality
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('drag-over');
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('drag-over');
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('drag-over');
      handleFiles(e.dataTransfer.files);
    });

    // File input change
    fileInput.addEventListener('change', (e) => {
      handleFiles(e.target.files);
    });

    function handleFiles(files) {
      const maxFiles = 5;
      const currentCount = uploadedImages.length;
      const remainingSlots = maxFiles - currentCount;

      if (remainingSlots <= 0) {
        alert('Maximum 5 images allowed. Please remove some images first.');
        return;
      }

      const filesToProcess = Math.min(files.length, remainingSlots);

      for (let i = 0; i < filesToProcess; i++) {
        const file = files[i];
        
        if (!file.type.startsWith('image/')) {
          continue;
        }

        // Convert to base64
        const reader = new FileReader();
        reader.onload = (e) => {
          const imageData = {
            id: Date.now() + i,
            data: e.target.result,
            name: file.name
          };
          
          uploadedImages.push(imageData);
          displayUploadedImage(imageData);
          updateGenerateButtonState();
        };
        reader.readAsDataURL(file);
      }
    }

    function displayUploadedImage(imageData) {
      const imageElement = document.createElement('div');
      imageElement.className = 'uploaded-image';
      imageElement.innerHTML = `
        <img src="${imageData.data}" alt="${imageData.name}">
        <button class="remove-image" data-id="${imageData.id}">Ã—</button>
      `;

      uploadedImagesContainer.appendChild(imageElement);

      // Add remove functionality
      imageElement.querySelector('.remove-image').addEventListener('click', () => {
        uploadedImages = uploadedImages.filter(img => img.id !== imageData.id);
        imageElement.remove();
        updateGenerateButtonState();
      });
    }

    function updateGenerateButtonState() {
      generateBtn.disabled = uploadedImages.length === 0;
    }
  }

  // Collect all form data using FormPersistence
  function collectFormData() {
    if (window.fashionFormPersistence) {
      const formData = window.fashionFormPersistence.collectFormData();
      // Add uploaded images to the form data
      formData.images = uploadedImages.map(img => img.data);
      return formData;
    } else {
      // Fallback to manual collection if FormPersistence not available
      return {
        personalStyle: document.querySelector('#fashion-personal-style .grid-item.selected')?.dataset.value || '',
        climate: document.querySelector('#fashion-climate .grid-item.selected')?.dataset.value || '',
        occasion: document.querySelector('#fashion-occasion .grid-item.selected')?.dataset.value || '',
        age: document.getElementById('fashion-age').value,
        height: document.getElementById('fashion-height').value,
        gender: document.getElementById('fashion-gender').value,
        additionalContext: document.getElementById('fashion-additional-context').value,
        images: uploadedImages.map(img => img.data)
      };
    }
  }

  // Generate button functionality
  function initializeGenerateButton() {
    const generateBtn = document.getElementById('generate-fashion-btn');
    
    generateBtn.addEventListener('click', async function() {
      console.log('Generate button clicked');
      
      if (uploadedImages.length === 0) {
        alert('Please upload at least one outfit photo before analyzing.');
        return;
      }

      const formData = collectFormData();
      console.log('Collected form data:', formData);

      // Show loading state
      const originalText = generateBtn.textContent;
      generateBtn.textContent = 'Analyzing...';
      generateBtn.disabled = true;

      try {
        // Store data for output page
        localStorage.setItem('fashionIqData', JSON.stringify(formData));
        
        // Make API call to worker
        const response = await fetch('https://fashion.4hm7q4q75z.workers.dev/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const result = await response.json();
        console.log('API response:', result);

        // Store response and redirect
        localStorage.setItem('fashionIqResponse', JSON.stringify(result));
        // Force absolute path to prevent context issues
        window.location.href = '/ai/fashion/fashionoutput.html?t=' + Date.now();

      } catch (error) {
        console.error('Error calling API:', error);
        alert('Sorry, there was an error analyzing your outfits. Please try again.');
        
        // Reset button
        generateBtn.textContent = originalText;
        generateBtn.disabled = uploadedImages.length === 0;
      }
    });
  }

  // Initialize everything when DOM is ready
  // Removing DOMContentLoaded and readyState check for now, assuming script runs when its DOM is ready.
  // The multiple "Fashion IQ script initializing" logs suggest this IIFE itself runs multiple times.
  // This needs to be addressed at a higher level.
  console.log("Fashion IQ: Attempting direct initialization of upload and generate button functions.");
  initializeImageUpload();
  initializeGenerateButton();
  console.log("Fashion IQ script: Initialization functions called.");


})();
</script>

<style>
/* Upload area styles */
.image-upload-container {
  width: 100%;
  margin-bottom: 20px;
}

.upload-area {
  border: 2px dashed #4a7c59;
  border-radius: 10px;
  padding: 40px 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  background-color: #f9f9f9;
  margin-bottom: 20px;
}

.upload-area:hover,
.upload-area.drag-over {
  border-color: #2d5d3d;
  background-color: #f0f8f0;
}

.upload-icon {
  font-size: 3em;
  color: #4a7c59;
  margin-bottom: 15px;
}

.upload-hint {
  font-size: 0.9em;
  color: #666;
  margin-top: 5px;
}

.uploaded-images {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 15px;
  margin-bottom: 20px;
}

.uploaded-image {
  position: relative;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.uploaded-image img {
  width: 100%;
  height: 120px;
  object-fit: cover;
  display: block;
}

.remove-image {
  position: absolute;
  top: 5px;
  right: 5px;
  background: rgba(255, 0, 0, 0.8);
  color: white;
  border: none;
  border-radius: 50%;
  width: 25px;
  height: 25px;
  cursor: pointer;
  font-size: 16px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
}

.remove-image:hover {
  background: rgba(255, 0, 0, 1);
}

#fashion-additional-context {
  width: 100%;
  min-height: 80px;
  padding: 15px;
  border: 1px solid #ddd;
  border-radius: 8px;
  font-family: inherit;
  font-size: 16px;
  resize: vertical;
  margin-bottom: 20px;
}

.generate-btn:disabled {
  background-color: #ccc;
  cursor: not-allowed;
}
</style>

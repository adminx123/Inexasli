<!-- /*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
 */ -->

<div class="device-container">

  <div class="row1 product-description-container">
    <h2 class="product-description-heading">Get AI-Powered Fashion Critique!</h2>
    <p class="product-description-text">
        Want honest feedback on how your outfits look? Upload photos of yourself wearing different outfits and get personalized fashion critique from our advanced AI. Our system analyzes not just whether an outfit looks good, but how it specifically suits you based on your complexion, body type, and personal style. Get recommendations on colors that complement your skin tone, styling tips, and honest assessments of how each piece works together.
    </p>
    <p class="product-description-disclaimer">
        <em>Important: The fashion advice and critiques provided by this tool are for entertainment and informational purposes only and are generated by artificial intelligence. Fashion is subjective, and personal style choices are yours to make. The AI's recommendations are based on general fashion principles and may not account for personal preferences, cultural considerations, or individual circumstances. We make no guarantees regarding the accuracy or suitability of the advice. Use of this tool and its outputs is at your own discretion.</em>
    </p>
    <p class="product-description-final">
        Let's analyze your style!
    </p>
</div>

<div class="row1" data-step-label="Personal Style">
    <div class="grid-container" id="fashion-personal-style">
        <div class="grid-item" data-value="Casual">Casual & Comfortable</div>
        <div class="grid-item" data-value="Business">Business & Professional</div>
        <div class="grid-item" data-value="Formal">Formal & Elegant</div>
        <div class="grid-item" data-value="Trendy">Trendy & Fashion-Forward</div>
        <div class="grid-item" data-value="Classic">Classic & Timeless</div>
        <div class="grid-item" data-value="Bohemian">Bohemian & Artistic</div>
        <div class="grid-item" data-value="Minimalist">Minimalist & Clean</div>
        <div class="grid-item" data-value="Eclectic">Eclectic & Unique</div>
    </div>
</div>





<div class="row1" data-step-label="Personal Information">
    <input id="fashion-age" type="text" placeholder="Age">
    <input id="fashion-height" type="text" placeholder="5'6">
    <select id="fashion-gender">
        <option value="" disabled selected>Select Gender</option>
        <option value="woman">Woman</option>
        <option value="man">Man</option>
    </select>
</div>

<div class="row1" data-step-label="Climate/Weather Context">
    <div class="grid-container" id="fashion-climate">
        <div class="grid-item" data-value="Cold Climate">Cold Climate (snow, freezing temperatures)</div>
        <div class="grid-item" data-value="Temperate Climate">Temperate Climate (four seasons, moderate weather)</div>
        <div class="grid-item" data-value="Warm Climate">Warm Climate (mild winters, no snow)</div>
        <div class="grid-item" data-value="Hot & Dry Climate">Hot & Dry Climate (desert-like, sun protection)</div>
        <div class="grid-item" data-value="Hot & Humid Climate">Hot & Humid Climate (tropical, breathable fabrics)</div>
        <div class="grid-item" data-value="Indoor/Climate Controlled">Indoor/Climate Controlled (no weather concerns)</div>
    </div>
</div>

<div class="row1" data-step-label="Event/Occasion">
    <div class="grid-container" id="fashion-occasion">
        <div class="grid-item" data-value="Work">Work/Office</div>
        <div class="grid-item" data-value="Casual Day">Casual Day Out</div>
        <div class="grid-item" data-value="Date Night">Date Night</div>
        <div class="grid-item" data-value="Party">Party/Event</div>
        <div class="grid-item" data-value="Travel">Travel/Vacation</div>
        <div class="grid-item" data-value="Exercise">Gym/Exercise</div>
        <div class="grid-item" data-value="Formal Event">Formal Event</div>
        <div class="grid-item" data-value="Everyday">Everyday Wear</div>
        <div class="grid-item" data-value="Special Occasion">Special Occasion</div>
        <div class="grid-item" data-value="Interview">Job Interview</div>
        <div class="grid-item" data-value="Wedding">Wedding Guest</div>
        <div class="grid-item" data-value="Brunch">Brunch/Social</div>
    </div>
</div>

<div class="row1" data-step-label="Upload Outfit Photos">
    <div id="fashion-upload-container"></div>
    <textarea id="fashion-additional-context" rows="3" placeholder="Any additional context about the outfits, specific concerns, or what you'd like feedback on? (Optional)"></textarea>
    <button class="generate-btn" id="generate-fashion-btn" disabled>Analyze My Style!</button>
</div>
   
</div> 

<!-- Load the centralized image upload system -->
<script src="../../utility/imageUpload.js"></script>



<script>
/*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
*/

(function() {
  console.log("[FashionIQ] Script starting");

  // Generate button handler
  async function handleGenerateFashionIq() {
    try {
      // Check if images are available through centralized system
      const hasImages = window.getImageUploadImages && window.getImageUploadImages().length > 0;
      if (!hasImages) {
        alert('Please upload at least one outfit photo before analyzing.');
        return;
      }

      const formData = window.fashionFormPersistence.getSavedFormData();
      if (!formData) {
        alert('Please complete the form before generating your fashion analysis.');
        return;
      }

      // Use enhanced loading with educational facts
      const result = await window.enhancedLoading(
        'generate-fashion-btn',
        'fashion',
        async () => {
          const apiUrl = 'https://fashion.4hm7q4q75z.workers.dev/';
          const response = await fetch(apiUrl, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(formData)
          });
          
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          
          const responseData = await response.json();
          if (responseData.message !== 'Success') {
            throw new Error(`An error occurred: ${responseData.message || responseData.error || ''}`);
          }
          
          return responseData;
        }
      );

      // Store the response using centralized system
      window.fashionFormPersistence.saveResponseData(result);
      
      // Dispatch an event to notify dataout.js that a response was received
      const event = new CustomEvent('api-response-received', {
        detail: {
          module: 'fashioniq',
          type: 'worker-response',
          timestamp: Date.now()
        }
      });
      document.dispatchEvent(event);
      
    } catch (error) {
      console.error('[FashionIQ] Error generating fashion analysis:', error);
      alert('An error occurred while analyzing your fashion. Please try again later.');
    }
  }

  // Button state management for image requirements
  function updateButtonState() {
    const generateBtn = document.getElementById('generate-fashion-btn');
    if (!generateBtn) return;
    
    const hasImages = window.getImageUploadImages && window.getImageUploadImages().length > 0;
    
    if (hasImages) {
      generateBtn.disabled = false;
    } else {
      generateBtn.disabled = true;
    }
  }

  // Simple initialization - set up event listeners
  function initialize() {
    console.log("[FashionIQ] Initializing...");
    
    // Set up generate button event listener
    const generateBtn = document.getElementById('generate-fashion-btn');
    if (generateBtn) {
      generateBtn.removeEventListener('click', handleGenerateFashionIq);
      generateBtn.addEventListener('click', handleGenerateFashionIq);
      console.log("[FashionIQ] Generate button event listener set up");
    } else {
      console.error("[FashionIQ] Generate button not found!");
    }

    // Initial button state check
    updateButtonState();

    // Listen for image upload changes
    document.addEventListener('imageUploadChanged', updateButtonState);
  }

  // Initialize immediately if DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initialize);
  } else {
    initialize();
  }

  // Handle loading through datain.js
  document.addEventListener('data-in-loaded', function(e) {
    console.log("[FashionIQ] Detected load through datain.js, reinitializing");
    initialize();
  });

  // Export functions for external access
  window.fashionIq = { 
    getFormData: () => window.fashionFormPersistence ? window.fashionFormPersistence.getSavedFormData() : null,
    saveFormData: () => window.fashionFormPersistence ? window.fashionFormPersistence.saveFormData() : null,
    updateButtonState: updateButtonState
  };

})();
</script>

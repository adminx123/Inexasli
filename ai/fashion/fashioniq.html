<!-- /*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
 */ -->

<div class="device-container">

  <div class="row1 product-description-container">
    <h2 class="product-description-heading">Get AI-Powered Fashion Critique!</h2>
    <p class="product-description-text">
        Want honest feedback on how your outfits look? Upload photos of yourself wearing different outfits and get personalized fashion critique from our advanced AI. Our system analyzes not just whether an outfit looks good, but how it specifically suits you based on your complexion, body type, and personal style. Get recommendations on colors that complement your skin tone, styling tips, and honest assessments of how each piece works together.
    </p>
    <p class="product-description-disclaimer">
        <em>Important: The fashion advice and critiques provided by this tool are for entertainment and informational purposes only and are generated by artificial intelligence. Fashion is subjective, and personal style choices are yours to make. The AI's recommendations are based on general fashion principles and may not account for personal preferences, cultural considerations, or individual circumstances. We make no guarantees regarding the accuracy or suitability of the advice. Use of this tool and its outputs is at your own discretion.</em>
    </p>
    <p class="product-description-final">
        Let's analyze your style!
    </p>
</div>

<div class="row1" data-step-label="Personal Style">
    <div class="grid-container" id="fashion-personal-style">
        <div class="grid-item" data-value="Casual">Casual & Comfortable</div>
        <div class="grid-item" data-value="Business">Business & Professional</div>
        <div class="grid-item" data-value="Formal">Formal & Elegant</div>
        <div class="grid-item" data-value="Trendy">Trendy & Fashion-Forward</div>
        <div class="grid-item" data-value="Classic">Classic & Timeless</div>
        <div class="grid-item" data-value="Bohemian">Bohemian & Artistic</div>
        <div class="grid-item" data-value="Minimalist">Minimalist & Clean</div>
        <div class="grid-item" data-value="Eclectic">Eclectic & Unique</div>
    </div>
</div>





<div class="row1" data-step-label="Personal Information">
    <input id="fashion-age" type="text" placeholder="Age">
    <input id="fashion-height" type="text" placeholder="5'6">
    <select id="fashion-gender">
        <option value="" disabled selected>Select Gender</option>
        <option value="woman">Woman</option>
        <option value="man">Man</option>
    </select>
</div>

<div class="row1" data-step-label="Climate/Weather Context">
    <div class="grid-container" id="fashion-climate">
        <div class="grid-item" data-value="Cold Climate">Cold Climate (snow, freezing temperatures)</div>
        <div class="grid-item" data-value="Temperate Climate">Temperate Climate (four seasons, moderate weather)</div>
        <div class="grid-item" data-value="Warm Climate">Warm Climate (mild winters, no snow)</div>
        <div class="grid-item" data-value="Hot & Dry Climate">Hot & Dry Climate (desert-like, sun protection)</div>
        <div class="grid-item" data-value="Hot & Humid Climate">Hot & Humid Climate (tropical, breathable fabrics)</div>
        <div class="grid-item" data-value="Indoor/Climate Controlled">Indoor/Climate Controlled (no weather concerns)</div>
    </div>
</div>

<div class="row1" data-step-label="Event/Occasion">
    <div class="grid-container" id="fashion-occasion">
        <div class="grid-item" data-value="Work">Work/Office</div>
        <div class="grid-item" data-value="Casual Day">Casual Day Out</div>
        <div class="grid-item" data-value="Date Night">Date Night</div>
        <div class="grid-item" data-value="Party">Party/Event</div>
        <div class="grid-item" data-value="Travel">Travel/Vacation</div>
        <div class="grid-item" data-value="Exercise">Gym/Exercise</div>
        <div class="grid-item" data-value="Formal Event">Formal Event</div>
        <div class="grid-item" data-value="Everyday">Everyday Wear</div>
        <div class="grid-item" data-value="Special Occasion">Special Occasion</div>
        <div class="grid-item" data-value="Interview">Job Interview</div>
        <div class="grid-item" data-value="Wedding">Wedding Guest</div>
        <div class="grid-item" data-value="Brunch">Brunch/Social</div>
    </div>
</div>

<div class="row1" data-step-label="Upload Outfit Photos">
    <div id="fashion-upload-container"></div>
    <textarea id="fashion-additional-context" rows="3" placeholder="Any additional context about the outfits, specific concerns, or what you'd like feedback on? (Optional)"></textarea>
    <button class="generate-btn" id="generate-fashion-btn" disabled>Analyze My Style!</button>
</div>
   
</div> 

<!-- Load the centralized image upload system -->
<script src="../../utility/imageUpload.js"></script>

<script>
/*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
*/

(function() {
  console.log("Fashion IQ script: Starting");

  // Collect all form data using FormPersistence
  function collectFormData() {
    if (window.fashionFormPersistence) {
      // FormPersistence automatically includes images from centralized ImageUpload utility
      return window.fashionFormPersistence.collectFormData();
    } else {
      // Fallback to manual collection if FormPersistence not available
      return {
        personalStyle: document.querySelector('#fashion-personal-style .grid-item.selected')?.dataset.value || '',
        climate: document.querySelector('#fashion-climate .grid-item.selected')?.dataset.value || '',
        occasion: document.querySelector('#fashion-occasion .grid-item.selected')?.dataset.value || '',
        age: document.getElementById('fashion-age').value,
        height: document.getElementById('fashion-height').value,
        gender: document.getElementById('fashion-gender').value,
        additionalContext: document.getElementById('fashion-additional-context').value,
        images: window.getImageUploadImages ? window.getImageUploadImages() : []
      };
    }
  }

  // Generate button functionality
  function initializeGenerateButton() {
    const generateBtn = document.getElementById('generate-fashion-btn');
    if (!generateBtn) {
      console.error('Fashion IQ: Generate button not found');
      return false;
    }
    
    generateBtn.addEventListener('click', async function() {
      console.log('Generate button clicked');
      
      // Check if images are available through centralized system
      const hasImages = window.getImageUploadImages && window.getImageUploadImages().length > 0;
      if (!hasImages) {
        alert('Please upload at least one outfit photo before analyzing.');
        return;
      }

      const formData = collectFormData();
      console.log('Collected form data:', formData);

      // Show loading state
      const originalText = generateBtn.textContent;
      generateBtn.textContent = 'Analyzing...';
      generateBtn.disabled = true;

      try {
        // Store data for output page
        localStorage.setItem('fashionIqInput', JSON.stringify(formData));
        
        // Make API call to worker
        const response = await fetch('https://fashion.4hm7q4q75z.workers.dev/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const result = await response.json();
        console.log('API response:', result);

        // Store response
        localStorage.setItem('fashionIqResponse', JSON.stringify(result));

        // Dispatch an event to notify dataout.js that a response was received
        const event = new CustomEvent('api-response-received', {
          detail: {
            module: 'fashioniq',
            type: 'worker-response',
            timestamp: Date.now()
          }
        });
        document.dispatchEvent(event);
        console.log('[FashionIQ] Dispatched api-response-received event');

      } catch (error) {
        console.error('Error calling API:', error);
        alert('Sorry, there was an error analyzing your outfits. Please try again.');
        
        // Reset button
        generateBtn.textContent = originalText;
        // Note: Button state is now managed automatically by imageUpload.js
      }
    });
    
    return true;
  }

  // Main initialization function
  function initialize() {
    console.log("Fashion IQ: Initializing (image upload handled automatically by imageUpload.js)");
    
    // Initialize generate button
    if (!initializeGenerateButton()) {
      console.error('Fashion IQ: Failed to initialize generate button');
    }

    // Manually initialize image upload for fashion container
    if (typeof window.initializeImageUpload === 'function') {
      console.log('[FashionIQ] Manually triggering image upload initialization');
      window.initializeImageUpload();
    } else {
      console.log('[FashionIQ] initializeImageUpload not available yet, will retry...');
      setTimeout(() => {
        if (typeof window.initializeImageUpload === 'function') {
          console.log('[FashionIQ] Retrying image upload initialization');
          window.initializeImageUpload();
        }
      }, 500);
    }

    // Auto-enable guided forms for files listed in input.txt
    if (typeof window.initGuidedForms === 'function') {
      console.log('[FashionIQ] Auto-initializing guided forms');
      window.initGuidedForms({
        autoAdvance: true,
        showProgressIndicator: true,
        smoothTransitions: true,
        enableSkipping: true,
        autoStart: true
      });
    }

    console.log("Fashion IQ script: Initialization complete");
  }

  // Initialize immediately if DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initialize);
  } else {
    initialize();
  }

  // Handle loading through datain.js
  document.addEventListener('data-in-loaded', function(e) {
    console.log("[FashionIQ] Detected load through datain.js, reinitializing");
    setTimeout(initialize, 50);
  });

})();
</script>

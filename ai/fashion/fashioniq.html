<!-- /*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
 */ -->

<div class="device-container">

  <div class="row1 product-description-container">
    <h2 class="product-description-heading">Get AI-Powered Fashion Critique!</h2>
    <p class="product-description-text">
        Want honest feedback on how your outfits look? Upload photos of yourself wearing different outfits and get personalized fashion critique from our advanced AI. Our system analyzes not just whether an outfit looks good, but how it specifically suits you based on your complexion, body type, and personal style. Get recommendations on colors that complement your skin tone, styling tips, and honest assessments of how each piece works together.
    </p>
    <p class="product-description-disclaimer">
        <em>Important: The fashion advice and critiques provided by this tool are for entertainment and informational purposes only and are generated by artificial intelligence. Fashion is subjective, and personal style choices are yours to make. The AI's recommendations are based on general fashion principles and may not account for personal preferences, cultural considerations, or individual circumstances. We make no guarantees regarding the accuracy or suitability of the advice. Use of this tool and its outputs is at your own discretion.</em>
    </p>
    <p class="product-description-final">
        Let's analyze your style!
    </p>
</div>

<div class="row1" data-step-label="Style Preference">
    <div class="grid-container" id="fashion-style">
        <div class="grid-item" data-value="Casual">Casual & Comfortable</div>
        <div class="grid-item" data-value="Business">Business & Professional</div>
        <div class="grid-item" data-value="Formal">Formal & Elegant</div>
        <div class="grid-item" data-value="Trendy">Trendy & Fashion-Forward</div>
        <div class="grid-item" data-value="Classic">Classic & Timeless</div>
        <div class="grid-item" data-value="Bohemian">Bohemian & Artistic</div>
        <div class="grid-item" data-value="Minimalist">Minimalist & Clean</div>
        <div class="grid-item" data-value="Eclectic">Eclectic & Unique</div>
    </div>
</div>

<div class="row1" data-step-label="Body Type">
    <div class="grid-container" id="fashion-body-type">
        <div class="grid-item" data-value="Apple">Apple (fuller midsection)</div>
        <div class="grid-item" data-value="Pear">Pear (wider hips)</div>
        <div class="grid-item" data-value="Hourglass">Hourglass (balanced curves)</div>
        <div class="grid-item" data-value="Rectangle">Rectangle (straight lines)</div>
        <div class="grid-item" data-value="Inverted Triangle">Inverted Triangle (broader shoulders)</div>
        <div class="grid-item" data-value="Athletic">Athletic (muscular build)</div>
        <div class="grid-item" data-value="Petite">Petite (smaller frame)</div>
        <div class="grid-item" data-value="Plus Size">Plus Size (curvy & fuller)</div>
    </div>
</div>

<div class="row1" data-step-label="Skin Tone">
    <div class="grid-container" id="fashion-skin-tone">
        <div class="grid-item" data-value="Fair Cool">Fair with Cool Undertones</div>
        <div class="grid-item" data-value="Fair Warm">Fair with Warm Undertones</div>
        <div class="grid-item" data-value="Light Cool">Light with Cool Undertones</div>
        <div class="grid-item" data-value="Light Warm">Light with Warm Undertones</div>
        <div class="grid-item" data-value="Medium Cool">Medium with Cool Undertones</div>
        <div class="grid-item" data-value="Medium Warm">Medium with Warm Undertones</div>
        <div class="grid-item" data-value="Deep Cool">Deep with Cool Undertones</div>
        <div class="grid-item" data-value="Deep Warm">Deep with Warm Undertones</div>
    </div>
</div>

<div class="row1" data-step-label="Hair Color">
    <div class="grid-container" id="fashion-hair-color">
        <div class="grid-item" data-value="Blonde">Blonde</div>
        <div class="grid-item" data-value="Brunette">Brunette</div>
        <div class="grid-item" data-value="Black">Black</div>
        <div class="grid-item" data-value="Red">Red/Auburn</div>
        <div class="grid-item" data-value="Gray">Gray/Silver</div>
        <div class="grid-item" data-value="Colored">Fashion Colors (pink, blue, etc.)</div>
    </div>
</div>

<div class="row1" data-step-label="Personal Information">
    <input id="fashion-age" type="text" placeholder="Age">
    <input id="fashion-height" type="text" placeholder="5'6">
    <select id="fashion-gender">
        <option value="" disabled selected>Select Gender</option>
        <option value="woman">Woman</option>
        <option value="man">Man</option>
        <option value="non-binary">Non-binary</option>
    </select>
</div>

<div class="row1" data-step-label="Outfit Context">
    <div class="grid-container" id="fashion-occasion">
        <div class="grid-item" data-value="Work">Work/Office</div>
        <div class="grid-item" data-value="Casual Day">Casual Day Out</div>
        <div class="grid-item" data-value="Date Night">Date Night</div>
        <div class="grid-item" data-value="Party">Party/Event</div>
        <div class="grid-item" data-value="Travel">Travel/Vacation</div>
        <div class="grid-item" data-value="Exercise">Gym/Exercise</div>
        <div class="grid-item" data-value="Formal Event">Formal Event</div>
        <div class="grid-item" data-value="Everyday">Everyday Wear</div>
    </div>
</div>

<div class="row1" data-step-label="Upload Outfit Photos">
    <div class="image-upload-container">
        <div class="upload-area" id="fashion-upload-area">
            <i class="fas fa-camera upload-icon"></i>
            <p>Drop your outfit photos here or click to upload</p>
            <p class="upload-hint">Upload 1-5 photos of yourself in different outfits</p>
            <input type="file" id="fashion-image-input" multiple accept="image/*" style="display: none;">
        </div>
        <div class="uploaded-images" id="fashion-uploaded-images"></div>
    </div>
    <textarea id="fashion-additional-context" placeholder="Any additional context about the outfits, specific concerns, or what you'd like feedback on? (Optional)"></textarea>
    <button class="generate-btn" id="generate-fashion-btn" disabled>Analyze My Style!</button>
</div>
   
</div> 

<script>
/*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
*/

(function() {
  console.log("Fashion IQ script initializing");

  let uploadedImages = [];
  let selections = {};

  // Initialize upload functionality
  function initializeImageUpload() {
    const uploadArea = document.getElementById('fashion-upload-area');
    const fileInput = document.getElementById('fashion-image-input');
    const uploadedImagesContainer = document.getElementById('fashion-uploaded-images');
    const generateBtn = document.getElementById('generate-fashion-btn');

    // Click to upload
    uploadArea.addEventListener('click', () => {
      fileInput.click();
    });

    // Drag and drop functionality
    uploadArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      uploadArea.classList.add('drag-over');
    });

    uploadArea.addEventListener('dragleave', () => {
      uploadArea.classList.remove('drag-over');
    });

    uploadArea.addEventListener('drop', (e) => {
      e.preventDefault();
      uploadArea.classList.remove('drag-over');
      handleFiles(e.dataTransfer.files);
    });

    // File input change
    fileInput.addEventListener('change', (e) => {
      handleFiles(e.target.files);
    });

    function handleFiles(files) {
      const maxFiles = 5;
      const currentCount = uploadedImages.length;
      const remainingSlots = maxFiles - currentCount;

      if (remainingSlots <= 0) {
        alert('Maximum 5 images allowed. Please remove some images first.');
        return;
      }

      const filesToProcess = Math.min(files.length, remainingSlots);

      for (let i = 0; i < filesToProcess; i++) {
        const file = files[i];
        
        if (!file.type.startsWith('image/')) {
          continue;
        }

        // Convert to base64
        const reader = new FileReader();
        reader.onload = (e) => {
          const imageData = {
            id: Date.now() + i,
            data: e.target.result,
            name: file.name
          };
          
          uploadedImages.push(imageData);
          displayUploadedImage(imageData);
          updateGenerateButtonState();
        };
        reader.readAsDataURL(file);
      }
    }

    function displayUploadedImage(imageData) {
      const imageElement = document.createElement('div');
      imageElement.className = 'uploaded-image';
      imageElement.innerHTML = `
        <img src="${imageData.data}" alt="${imageData.name}">
        <button class="remove-image" data-id="${imageData.id}">Ã—</button>
      `;

      uploadedImagesContainer.appendChild(imageElement);

      // Add remove functionality
      imageElement.querySelector('.remove-image').addEventListener('click', () => {
        uploadedImages = uploadedImages.filter(img => img.id !== imageData.id);
        imageElement.remove();
        updateGenerateButtonState();
      });
    }

    function updateGenerateButtonState() {
      generateBtn.disabled = uploadedImages.length === 0;
    }
  }

  // Grid selection functionality (reused from calorie module)
  function initializeGridSelections() {
    const gridContainers = document.querySelectorAll('.grid-container');
    
    gridContainers.forEach(container => {
      const items = container.querySelectorAll('.grid-item');
      
      items.forEach(item => {
        item.addEventListener('click', function() {
          // Remove selection from siblings
          items.forEach(sibling => sibling.classList.remove('selected'));
          
          // Add selection to clicked item
          this.classList.add('selected');
          
          // Store selection
          const containerId = container.id;
          const value = this.dataset.value;
          selections[containerId] = value;
          
          console.log('Selection updated:', containerId, value);
        });
      });
    });
  }

  // Collect all form data
  function collectFormData() {
    return {
      stylePreference: selections['fashion-style'] || '',
      bodyType: selections['fashion-body-type'] || '',
      skinTone: selections['fashion-skin-tone'] || '',
      hairColor: selections['fashion-hair-color'] || '',
      occasion: selections['fashion-occasion'] || '',
      age: document.getElementById('fashion-age').value,
      height: document.getElementById('fashion-height').value,
      gender: document.getElementById('fashion-gender').value,
      additionalContext: document.getElementById('fashion-additional-context').value,
      images: uploadedImages.map(img => img.data)
    };
  }

  // Generate button functionality
  function initializeGenerateButton() {
    const generateBtn = document.getElementById('generate-fashion-btn');
    
    generateBtn.addEventListener('click', async function() {
      console.log('Generate button clicked');
      
      if (uploadedImages.length === 0) {
        alert('Please upload at least one outfit photo before analyzing.');
        return;
      }

      const formData = collectFormData();
      console.log('Collected form data:', formData);

      // Show loading state
      const originalText = generateBtn.textContent;
      generateBtn.textContent = 'Analyzing...';
      generateBtn.disabled = true;

      try {
        // Store data for output page
        localStorage.setItem('fashionIqData', JSON.stringify(formData));
        
        // Make API call to worker
        const response = await fetch('https://fashion.inexasli.workers.dev', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const result = await response.json();
        console.log('API response:', result);

        // Store response and redirect
        localStorage.setItem('fashionIqResponse', JSON.stringify(result));
        window.location.href = 'fashionoutput.html';

      } catch (error) {
        console.error('Error calling API:', error);
        alert('Sorry, there was an error analyzing your outfits. Please try again.');
        
        // Reset button
        generateBtn.textContent = originalText;
        generateBtn.disabled = uploadedImages.length === 0;
      }
    });
  }

  // Initialize everything when DOM is ready
  document.addEventListener('DOMContentLoaded', function() {
    initializeImageUpload();
    initializeGridSelections();
    initializeGenerateButton();
  });

  // Also run immediately in case DOMContentLoaded already fired
  if (document.readyState === 'loading') {
    // DOM hasn't finished loading yet
  } else {
    // DOM is ready
    initializeImageUpload();
    initializeGridSelections();
    initializeGenerateButton();
  }

})();
</script>

<style>
/* Upload area styles */
.image-upload-container {
  width: 100%;
  margin-bottom: 20px;
}

.upload-area {
  border: 2px dashed #4a7c59;
  border-radius: 10px;
  padding: 40px 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  background-color: #f9f9f9;
  margin-bottom: 20px;
}

.upload-area:hover,
.upload-area.drag-over {
  border-color: #2d5d3d;
  background-color: #f0f8f0;
}

.upload-icon {
  font-size: 3em;
  color: #4a7c59;
  margin-bottom: 15px;
}

.upload-hint {
  font-size: 0.9em;
  color: #666;
  margin-top: 5px;
}

.uploaded-images {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
  gap: 15px;
  margin-bottom: 20px;
}

.uploaded-image {
  position: relative;
  border-radius: 8px;
  overflow: hidden;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}

.uploaded-image img {
  width: 100%;
  height: 120px;
  object-fit: cover;
  display: block;
}

.remove-image {
  position: absolute;
  top: 5px;
  right: 5px;
  background: rgba(255, 0, 0, 0.8);
  color: white;
  border: none;
  border-radius: 50%;
  width: 25px;
  height: 25px;
  cursor: pointer;
  font-size: 16px;
  font-weight: bold;
  display: flex;
  align-items: center;
  justify-content: center;
}

.remove-image:hover {
  background: rgba(255, 0, 0, 1);
}

#fashion-additional-context {
  width: 100%;
  min-height: 80px;
  padding: 15px;
  border: 1px solid #ddd;
  border-radius: 8px;
  font-family: inherit;
  font-size: 16px;
  resize: vertical;
  margin-bottom: 20px;
}

.generate-btn:disabled {
  background-color: #ccc;
  cursor: not-allowed;
}
</style>

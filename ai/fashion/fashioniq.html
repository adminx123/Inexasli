<!-- /*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
 */ -->

<div class="device-container">

  <div class="row1 product-description-container">
    <h2 class="product-description-heading">Get AI-Powered Fashion Critique!</h2>
    <p class="product-description-text">
        Want honest feedback on how your outfits look? Upload photos of yourself wearing different outfits and get personalized fashion critique from our advanced AI. Our system analyzes not just whether an outfit looks good, but how it specifically suits you based on your complexion, body type, and personal style. Get recommendations on colors that complement your skin tone, styling tips, and honest assessments of how each piece works together.
    </p>
    <p class="product-description-disclaimer">
        <em>Important: The fashion advice and critiques provided by this tool are for entertainment and informational purposes only and are generated by artificial intelligence. Fashion is subjective, and personal style choices are yours to make. The AI's recommendations are based on general fashion principles and may not account for personal preferences, cultural considerations, or individual circumstances. We make no guarantees regarding the accuracy or suitability of the advice. Use of this tool and its outputs is at your own discretion.</em>
    </p>
    <p class="product-description-final">
        Let's analyze your style!
    </p>
</div>

<div class="row1" data-step-label="Personal Style">
    <div class="grid-container" id="fashion-personal-style">
        <div class="grid-item" data-value="Casual">Casual & Comfortable</div>
        <div class="grid-item" data-value="Business">Business & Professional</div>
        <div class="grid-item" data-value="Formal">Formal & Elegant</div>
        <div class="grid-item" data-value="Trendy">Trendy & Fashion-Forward</div>
        <div class="grid-item" data-value="Classic">Classic & Timeless</div>
        <div class="grid-item" data-value="Bohemian">Bohemian & Artistic</div>
        <div class="grid-item" data-value="Minimalist">Minimalist & Clean</div>
        <div class="grid-item" data-value="Eclectic">Eclectic & Unique</div>
    </div>
</div>





<div class="row1" data-step-label="Personal Information">
    <input id="fashion-age" type="text" placeholder="Age">
    <input id="fashion-height" type="text" placeholder="5'6">
    <select id="fashion-gender">
        <option value="" disabled selected>Select Gender</option>
        <option value="woman">Woman</option>
        <option value="man">Man</option>
    </select>
</div>

<div class="row1" data-step-label="Climate/Weather Context">
    <div class="grid-container" id="fashion-climate">
        <div class="grid-item" data-value="Cold Climate">Cold Climate (snow, freezing temperatures)</div>
        <div class="grid-item" data-value="Temperate Climate">Temperate Climate (four seasons, moderate weather)</div>
        <div class="grid-item" data-value="Warm Climate">Warm Climate (mild winters, no snow)</div>
        <div class="grid-item" data-value="Hot & Dry Climate">Hot & Dry Climate (desert-like, sun protection)</div>
        <div class="grid-item" data-value="Hot & Humid Climate">Hot & Humid Climate (tropical, breathable fabrics)</div>
        <div class="grid-item" data-value="Indoor/Climate Controlled">Indoor/Climate Controlled (no weather concerns)</div>
    </div>
</div>

<div class="row1" data-step-label="Event/Occasion">
    <div class="grid-container" id="fashion-occasion">
        <div class="grid-item" data-value="Work">Work/Office</div>
        <div class="grid-item" data-value="Casual Day">Casual Day Out</div>
        <div class="grid-item" data-value="Date Night">Date Night</div>
        <div class="grid-item" data-value="Party">Party/Event</div>
        <div class="grid-item" data-value="Travel">Travel/Vacation</div>
        <div class="grid-item" data-value="Exercise">Gym/Exercise</div>
        <div class="grid-item" data-value="Formal Event">Formal Event</div>
        <div class="grid-item" data-value="Everyday">Everyday Wear</div>
        <div class="grid-item" data-value="Special Occasion">Special Occasion</div>
        <div class="grid-item" data-value="Interview">Job Interview</div>
        <div class="grid-item" data-value="Wedding">Wedding Guest</div>
        <div class="grid-item" data-value="Brunch">Brunch/Social</div>
    </div>
</div>

<div class="row1" data-step-label="Upload Outfit Photos">
    <div id="fashion-upload-container"></div>
    <textarea id="fashion-additional-context" placeholder="Any additional context about the outfits, specific concerns, or what you'd like feedback on? (Optional)"></textarea>
    <button class="generate-btn" id="generate-fashion-btn" disabled>Analyze My Style!</button>
</div>
   
</div> 

<script src="../../utility/imageUpload.js"></script>
<script>
/*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
*/

(function() {
  console.log("Fashion IQ script: Starting");

  let imageUploader = null;
  let uploadedImages = [];

  // Initialize image upload functionality
  function initializeImageUpload() {
    console.log("Fashion IQ: Initializing image upload with utility");
    
    // Create ImageUpload instance
    imageUploader = new ImageUpload({
      maxFiles: 5,
      acceptedTypes: 'image/*',
      onFilesSelected: (images) => {
        uploadedImages = images;
        updateGenerateButtonState();
        console.log('Fashion IQ: Files selected, count:', images.length);
      },
      onError: (message) => {
        console.error('Fashion IQ: Upload error:', message);
        alert(message);
      }
    });

    // Initialize the upload interface
    const success = imageUploader.initialize('fashion-upload-container', {
      cameraText: 'Take Photo',
      galleryText: 'Choose from Gallery',
      dragText: 'Or drag and drop photos here',
      hintText: 'Upload 1-5 photos of yourself in different outfits'
    });

    if (!success) {
      console.error('Fashion IQ: Failed to initialize image upload');
    } else {
      console.log('Fashion IQ: Image upload initialized successfully');
    }
  }

  // Update generate button state
  function updateGenerateButtonState() {
    const generateBtn = document.getElementById('generate-fashion-btn');
    if (generateBtn) {
      generateBtn.disabled = uploadedImages.length === 0;
    }
  }

  // Collect all form data using FormPersistence
  function collectFormData() {
    if (window.fashionFormPersistence) {
      const formData = window.fashionFormPersistence.collectFormData();
      // Add uploaded images to the form data
      formData.images = imageUploader ? imageUploader.getImages() : [];
      return formData;
    } else {
      // Fallback to manual collection if FormPersistence not available
      return {
        personalStyle: document.querySelector('#fashion-personal-style .grid-item.selected')?.dataset.value || '',
        climate: document.querySelector('#fashion-climate .grid-item.selected')?.dataset.value || '',
        occasion: document.querySelector('#fashion-occasion .grid-item.selected')?.dataset.value || '',
        age: document.getElementById('fashion-age').value,
        height: document.getElementById('fashion-height').value,
        gender: document.getElementById('fashion-gender').value,
        additionalContext: document.getElementById('fashion-additional-context').value,
        images: imageUploader ? imageUploader.getImages() : []
      };
    }
  }

  // Generate button functionality
  function initializeGenerateButton() {
    const generateBtn = document.getElementById('generate-fashion-btn');
    
    generateBtn.addEventListener('click', async function() {
      console.log('Generate button clicked');
      
      if (!imageUploader || imageUploader.getImages().length === 0) {
        alert('Please upload at least one outfit photo before analyzing.');
        return;
      }

      const formData = collectFormData();
      console.log('Collected form data:', formData);

      // Show loading state
      const originalText = generateBtn.textContent;
      generateBtn.textContent = 'Analyzing...';
      generateBtn.disabled = true;

      try {
        // Store data for output page
        localStorage.setItem('fashionIqInput', JSON.stringify(formData));
        
        // Make API call to worker
        const response = await fetch('https://fashion.4hm7q4q75z.workers.dev/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(formData)
        });

        if (!response.ok) {
          throw new Error(`HTTP error! status: ${response.status}`);
        }

        const result = await response.json();
        console.log('API response:', result);

        // Store response
        localStorage.setItem('fashionIqResponse', JSON.stringify(result));

        // Dispatch an event to notify dataout.js that a response was received
        const event = new CustomEvent('api-response-received', {
          detail: {
            module: 'fashioniq',
            type: 'worker-response',
            timestamp: Date.now()
          }
        });
        document.dispatchEvent(event);
        console.log('[FashionIQ] Dispatched api-response-received event');

      } catch (error) {
        console.error('Error calling API:', error);
        alert('Sorry, there was an error analyzing your outfits. Please try again.');
        
        // Reset button
        generateBtn.textContent = originalText;
        generateBtn.disabled = uploadedImages.length === 0;
      }
    });
  }

  // Initialize everything when DOM is ready
  console.log("Fashion IQ: Attempting direct initialization");
  
  // Wait for ImageUpload utility to be available
  function waitForImageUpload() {
    if (window.ImageUpload) {
      initializeImageUpload();
      initializeGenerateButton();
      console.log("Fashion IQ script: Initialization complete");
    } else {
      console.log("Fashion IQ: Waiting for ImageUpload utility...");
      setTimeout(waitForImageUpload, 100);
    }
  }
  
  waitForImageUpload();

})();
</script>

<style>
#fashion-additional-context {
  width: 100%;
  min-height: 80px;
  padding: 15px;
  border: 1px solid #ddd;
  border-radius: 8px;
  font-family: inherit;
  font-size: 16px;
  resize: vertical;
  margin-bottom: 20px;
}

.generate-btn:disabled {
  background-color: #ccc;
  cursor: not-allowed;
}
</style>

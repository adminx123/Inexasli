<!-- /*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
 */ -->

 <!DOCTYPE html>
 <html lang="en">
 <head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <meta name="description" content="Educational financial tool to estimate, learn, and simulate—not financial advice.">
   <title> IncomeIQ™ Summary</title>
   <link rel="icon" type="image/x-icon" href="/images/newLogo.jpg">
   <link href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css" rel="stylesheet">
   <link rel="stylesheet" href="/style/styles.css">
   <script src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.js"></script>
   <link rel="icon" type="image/png" href="/images/favicon-96x96.png" sizes="96x96" />
   <link rel="icon" type="image/svg+xml" href="/images/favicon.svg" />
   <link rel="shortcut icon" href="/images/favicon.ico" />
   <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png" />
   <!-- frequencyChange.js is now loaded in budget.html -->
 </head>
  
 <body style="display: none;"> 
  
 



   
   <!-- Main Content -->

    <h3 style="text-align: center; font-size: 20px; color: rgb(0, 0, 0); margin-bottom: 10px; font-weight: bold;">Summary</h4>


     <!-- Disclaimer Banner -->
     <div style="text-align: center; font-size: 0.9em; color: #fff; background: #333; padding: 10px; margin-bottom: 15px;">
       Not financial advice. All calculations are educational estimates based on your inputs. Consult a professional before making financial decisions.
     </div>

     
 
     <!-- Frequency Selector (Free) - Will be injected by frequencyChange.js -->
     <div data-summary-frequency-id="summary_frequency" style="text-align:center; margin-bottom: 15px;"></div>

     <!-- Styles now provided by frequencyChange.js -->
 
     

     
    
 
     <div class="summary-container">

      <!-- Premium: Taxes & Obligations -->
      <details style="margin-top:10px;">
        <summary>
          <span class="tooltip1" data-tooltip="Detailed tax and obligation breakdowns based on your inputs.">
            <h2>TAXES & OBLIGATIONS<span class="tooltip1-content"></span></h2>
          </span>
        </summary>

  


          
              <summary>
                <p style="margin-left:21px;">
                  <span class="tooltip1" data-tooltip="Total taxes owed, calculated from taxable income (gross minus deductions like SD in USA or BPA in Canada) using regional rates (e.g., USA federal/state, Canada federal/provincial). Includes income tax and full (USA) or 50% (Canada) capital gains tax; excludes obligations like CPP/Social Security. Use: Estimate tax burden.">
                    <u>Total Tax Payable:</u><span class="tooltip1-content"></span><span id="TOTALTAXANNUAL"></span>
                  </span>
                </p>
              </summary>
          
           
              
              
          
            
            
             
            
          
             
                <summary>

              <p style="margin-left:21px;">
                <span class="tooltip1" data-tooltip="input collective amout of all othe robligations payable">
                  <u>Other Obligations Payable:</u><span class="tooltip1-content"></span>
                  <span id="OBLIGATIONANNUAL"></span>
                </span>
              </p>
            </summary>
          

<!--

         <div class="can-hide">

            <details style="margin-top:10px;">
<summary>
            <p style="margin-left:34px;">
              <span class="tooltip1" data-tooltip="Total CPP based on your income and status.">
                <u>Total CPP Payable:</u><span class="tooltip1-content"></span><span id="cpp_sum" ></span>
              </span>
            </p>
</summary>

            <p style="margin-left:34px;">
              <span class="tooltip1" data-tooltip="CPP for self-employed, based on your income.">
                <u>Self Employed CPP Payable:</u><span class="tooltip1-content"></span><span id="annual_cpp_seresult"></span>
              </span>
            </p>

            <p style="margin-left:34px;">
              <span class="tooltip1" data-tooltip="CPP for employed, from your data.">
                <u>Employed CPP Payable:</u><span class="tooltip1-content"></span><span id="annual_cpp_eresult" ></span>
              </span>
            </p>
</details>
           

            <p style="margin-left:34px;">
              <span class="tooltip1" data-tooltip="Employment Insurance (EI) contribution, calculated from your income inputs (e.g., 1.63% up to ~$63,200 in 2025, per CRA) if employed. Self-employed individuals aren’t required to pay EI but can opt in for benefits like parental leave. Excludes non-wage income. Use: Estimate job-related costs.">         
                       <u>Total Employment Insurance Payable:</u><span class="tooltip1-content"></span><span id="ANNUALEI" ></span>
              </span>
            </p>

          </div>



          <div class="usa-hide">

            <details style="margin-top:10px;">
<summary>
            <p style="margin-left:34px;">
              <span class="tooltip1" data-tooltip="Social Security total from your U.S. income data.">
                <u>Social Security Total US:</u><span class="tooltip1-content"></span><span id="TOTALSOCIALSECURITY" ></span>
              </span>
            </p>
</summary>


            <p style="margin-left:34px;">
              <span class="tooltip1" data-tooltip="Social Security for employed, based on your inputs.">
                <u>Social Security Employed US:</u><span class="tooltip1-content"></span><span id="TOTALSOCIALSECURITYE" ></span>
              </span>
            </p>
            <p style="margin-left:34px;">
              <span class="tooltip1" data-tooltip="Social Security for self-employed, from your data.">
                <u>Social Security Self Employed US:</u><span class="tooltip1-content"></span><span id="TOTALSOCIALSECURITYSE" ></span>
              </span>
            </p>
            </details>


            <p style="margin-left:34px;">
              <span class="tooltip1" data-tooltip="Medicare tax calculated from your income.">
                <u>Medicare:</u><span class="tooltip1-content"></span><span id="TOTALMEDICARE" ></span>
              </span>
            </p>
          </div>
        -->

        </details>

      </details>

    </div>

<div class="summary-container1">



    
     <!-- Free: Income & Expenses -->
     <details style="margin-top:10px;">
       <summary>
         <span class="tooltip1" data-tooltip="Your total earnings and spending based on your inputs.">
           <h2>INCOME & EXPENSES<span class="tooltip1-content"></span></h2>
         </span>
       </summary>

<!-- Premium: Disposable Income -->

<p style="margin-left:21px;" class="premium-section">
   <span class="tooltip1" data-tooltip="Income left after subtracting expenses, taxes, and obligations from gross income. Calculated as: gross income - (taxes like income/capital gains + obligations like CPP/Social Security + all expenses). Includes only your spendable remainder; excludes locked savings. Use: Gauge financial flexibility.">
               </style>DISPOSABLE INCOME:<span class="premium-notice">Premium</span><span class="tooltip1-content"></span><span id="DISPOSABLEINCOME" class="premium-blur">[Locked]</span>
    </span>
  </p>
 
 

       <p style="margin-left:21px;">
        <span class="tooltip1" data-tooltip="Total gross earnings you’ve entered (e.g., wages, freelance, interest). Calculated by summing all income sources before taxes or deductions. Includes taxable amounts (e.g., 100% capital gains in USA, 50% in Canada); excludes tax-free gains (e.g., Canada’s TFSA). Use: Base for tax and budget planning.">          
           <u>Income:</u><span class="tooltip1-content"></span><span id="annual_income_sum"></span>
         </span>
       </p>
       <details style="margin-top:10px;">
         <summary>
           <p style="margin-left:21px;">
            <span class="tooltip1" data-tooltip="Total spending you’ve entered, calculated by summing all expense categories (essential, discretionary, etc.). Includes costs like housing and debt payments; excludes taxes or obligations unless specified. Use: Track cash outflow and budget.">            
                 <u>Expense:</u><span class="tooltip1-content"></span><span id="ANNUALEXPENSESUM"></span>
             </span>
           </p>
         </summary>
         <p style="margin-left:34px;">
           <span class="tooltip1" data-tooltip="Essential spending categories you’ve entered.">
             <u>Essential Expense:</u><span class="tooltip1-content"></span><span id="ESSENTIAL"></span>
           </span>
         </p>
         <p style="margin-left:34px;">
           <span class="tooltip1" data-tooltip="Non-essential spending you’ve tracked.">
             <u>Discretionary Expense:</u><span class="tooltip1-content"></span><span id="DISCRETIONARY"></span>
           </span>
         </p>
         <p style="margin-left:34px;">
           <span class="tooltip1" data-tooltip="Housing costs from your data.">
             <u>Housing Expense:</u><span class="tooltip1-content"></span><span id="HOUSING"></span>
           </span>
         </p>
         <p style="margin-left:34px;">
           <span class="tooltip1" data-tooltip="Transportation costs you’ve logged.">
             <u>Transportation Expense:</u><span class="tooltip1-content"></span><span id="TRANSPORTATION"></span>
           </span>
         </p>
         <p style="margin-left:34px;">
           <span class="tooltip1" data-tooltip="Dependant-related spending from your inputs.">
             <u>Dependant Expense:</u><span class="tooltip1-content"></span><span id="DEPENDANT"></span>
           </span>
         </p>
         <p style="margin-left:34px;">
           <span class="tooltip1" data-tooltip="Debt payments you’ve entered.">
             <u>Debt Expense:</u><span class="tooltip1-content"></span><span id="DEBT"></span>
           </span>
         </p>
       </details>

  

     </details>


 
  <details style="margin-top:10px;" >
    <summary>
      <span class="tooltip1" data-tooltip="Wealth tracking">
        <h2>WEALTH<span class="tooltip1-content"></span></h2>
      </span>
    </summary>

    <p style="margin-left:21px;">
      <span class="tooltip1" data-tooltip="Total value of resources you’ve entered.">
        <u>Assets:</u><span class="tooltip1-content"></span><span id="ASSETS"></span>
      </span>
    </p>
    <p style="margin-left:21px;">
      <span class="tooltip1" data-tooltip="Total debts or obligations you’ve logged.">
        <u>Liabilities:</u><span class="tooltip1-content"></span><span id="LIABILITIES"></span>
      </span>
    </p>

    <p style="margin-left:45px;">
      <span class="tooltip1" data-tooltip="Assets minus liabilities. A snapshot of wealth based on your inputs.">
        <u>Net Worth:</u><span class="tooltip1-content"></span><span id="NETWORTH"></span>
      </span>
    </p>
  </details>

    
 
    
 
          <!-- Premium: Premium Ratios -->
        <!-- Premium: Premium Ratios -->
<details style="margin-top:10px;">
  <summary>
    <span class="tooltip1" data-tooltip="Advanced ratios to explore financial relationships.">
      <h2 style="justify-content: center;">RATIOS<span class="tooltip1-content"></span></h2>
    </span>
  </summary>



  <details style="margin-top:10px;">
    <summary>
      <p style="margin-left:21px;" class="premium-section">
        <span class="tooltip1" data-tooltip="Debt divided by income. A common metric from your inputs.">
          <u>Debt to Income:<span class="premium-notice">Premium</span></u><span class="tooltip1-content"></span><span id="DEBTTOINCOME" class="premium-blur">[Locked]</span>
        </span>
      </p>
    </summary>
    <ul style="margin-left:34px;">
      <li><strong>Above 0.36:</strong> Common threshold for concern, per Investopedia</li>
      <li><strong>0.20 to 0.36:</strong> Typical range, per Investopedia</li>
      <li><strong>Below 0.20:</strong> Often considered healthy, per Investopedia</li>
    </ul>
  </details>

  <details style="margin-top:10px;">
    <summary>
      <p style="margin-left:21px;" class="premium-section">
        <span class="tooltip1" data-tooltip="Passive income vs. expenses. A FIRE concept calculated from your data.">
          <u>FIRE:<span class="premium-notice">Premium</span></u><span class="tooltip1-content"></span><span id="FIRERATIO" class="premium-blur">[Locked]</span>
        </span>
      </p>
    </summary>
    <ul style="margin-left:34px;">
      <li><strong>Below 0.25:</strong> Early stage of financial independence, per Financial Planning Association</li>
      <li><strong>0.25 to 0.99:</strong> Progress toward independence, per Financial Planning Association</li>
      <li><strong>1.0 or higher:</strong> Common benchmark for financial independence, per Financial Planning Association</li>
    </ul>
  </details>

  <details style="margin-top:10px;">
    <summary>
      <p style="margin-left:21px;" class="premium-section">
        <span class="tooltip1" data-tooltip="Housing costs divided by income, calculated from your data.">
          <u>Housing to Income:<span class="premium-notice">Premium</span></u><span class="tooltip1-content"></span><span id="HOUSINGTOINCOME" class="premium-blur">[Locked]</span>
        </span>
      </p>
    </summary>
    <ul style="margin-left:34px;">
      <li><strong>Above 0.35:</strong> Common threshold for concern, per Investopedia</li>
      <li><strong>0.28 to 0.35:</strong> Typical range, per Investopedia</li>
      <li><strong>Below 0.28:</strong> Often considered affordable, per Investopedia</li>
    </ul>
  </details>

  <details style="margin-top:10px;">
    <summary>
      <p style="margin-left:21px;" class="premium-section">
        <span class="tooltip1" data-tooltip="Savings divided by debt, based on your inputs.">
          <u>Savings to Debt:<span class="premium-notice">Premium</span></u><span class="tooltip1-content"></span><span id="SAVINGSTODEBT" class="premium-blur">[Locked]</span>
        </span>
      </p>
    </summary>
    <ul style="margin-left:34px;">
      <li><strong>Below 1.0:</strong> Common threshold for concern, per Consumer Financial Protection Bureau</li>
      <li><strong>1.0 to 2.0:</strong> Typical range, per Consumer Financial Protection Bureau</li>
      <li><strong>2.0 or higher:</strong> Often considered a sign of stability, per Consumer Financial Protection Bureau</li>
    </ul>
  </details>
</details>

          <details style="margin-top:10px;" >
            <summary>
              <span class="tooltip1" data-tooltip="Hypothetical calculations based on your current data, for learning purposes only.">
                <h2>FINANCIAL PROJECTIONS<span class="tooltip1-content"></span></h2>
              </span>
             
            </summary>
            <p style="margin-left:21px;" class="premium-section">
              <span class="tooltip1" data-tooltip="Hypothetical time to pay revolving debt using your disposable income, no interest assumed.">
                  <u>Revolving Debt - Time to Pay:<span class="premium-notice">Premium</span></u><span class="tooltip1-content"></span><span id="TIMETOPAYDEBT" class="premium-blur">[Locked]</span>
              </span>
          </p>
            <p style="margin-left:21px;" class="premium-section">
              <span class="tooltip1" data-tooltip="Enter a savings goal to see a hypothetical timeline based on your disposable income.">
                <u>Savings Goal:<span class="premium-notice">Premium</span></u><input id="goalAmount" type="number" disabled style="margin-left: 15px;"><span class="tooltip1-content"></span><span id="goalResult"></span>
              </span>
            </p>
          </details>

          <details style="margin-top:10px;">
            <summary>
              <span class="tooltip1" data-tooltip="Relevant Data.">
                <h2>CONTRIBUTING FACTORS<span class="tooltip1-content"></span></h2>
              </span>
            </summary>
            
            <p style="margin-left:34px;">
              <span class="tooltip1" data-tooltip="Taxable income is what's taxed after adjusting gross income (wages, interest, etc.). In Canada, only 50% of capital gains (profit from sold assets) is included; in the USA, 100% of capital gains is included, with rates varying by holding period (short-term at income rates, long-term at 0%-20%). It's calculated by subtracting deductions—like Standard Deduction (USA) or Basic Personal Amount (Canada)—and exemptions from gross income. Excludes tax-free items (e.g., Canada's TFSA gains). Use: Calculate tax owed and plan filings.">
              <u>Tax Calculation Factors</u><span class="tooltip1-content"></span>
              </span>
            </p>
            
            
            
          </details>
        
          <button id="calculateTaxesBtn" style="margin: 10px 0; padding: 10px; background-color: #0066cc; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%;" onclick="calculateTaxesAndContributions()">
            Calculate Taxes & Contributions
          </button>
          
     
          
            
          
    
 
     <!-- Expense charts removed as requested -->
     <!-- Will add back pie charts later -->
 


</div>

      
        

 
<script type="module">
import { getLocal } from '/utility/getlocal.js';
import { setCookie } from '/utility/setcookie.js';
import { setLocal } from '/utility/setlocal.js';

// Function to populate all span elements from local storage
function populateValuesFromLocalStorage() {
    console.log('Populating values from local storage');
    
    // Standard financial values - using $ format
    const financialElements = {
        'ASSETS': parseFloat(getLocal('ASSETS')) || 0,
        'LIABILITIES': parseFloat(getLocal('LIABILITIES')) || 0,
        'NETWORTH': (parseFloat(getLocal('ASSETS')) || 0) - (parseFloat(getLocal('LIABILITIES')) || 0),
        'annual_income_sum': parseFloat(getLocal('ANNUALINCOME')) || 0,
        'ANNUALEXPENSESUM': parseFloat(getLocal('ANNUALEXPENSESUM')) || 0,
        'ESSENTIAL': parseFloat(getLocal('ESSENTIAL')) || 0,
        'DISCRETIONARY': parseFloat(getLocal('DISCRETIONARY')) || 0,
        'HOUSING': parseFloat(getLocal('HOUSING')) || 0,
        'TRANSPORTATION': parseFloat(getLocal('TRANSPORTATION')) || 0,
        'DEPENDANT': parseFloat(getLocal('DEPENDANT')) || 0,
        'DEBT': parseFloat(getLocal('DEBT')) || 0,
        'TOTALTAXANNUAL': parseFloat(getLocal('TOTALTAXANNUAL')) || 0,
        'OBLIGATIONANNUAL': parseFloat(getLocal('OBLIGATIONANNUAL')) || 0,
        'DISPOSABLEINCOME': parseFloat(getLocal('DISPOSABLEINCOME')) || 0
    };
    
    // Ratio values - without $ format
    const ratioElements = {
        'FIRERATIO': parseFloat(getLocal('FIRERATIO')) || 0,
        'SAVINGSTODEBT': parseFloat(getLocal('SAVINGSTODEBT')) || 0,
        'HOUSINGTOINCOME': parseFloat(getLocal('HOUSINGTOINCOME')) || 0,
        'DEBTTOINCOME': parseFloat(getLocal('DEBTTOINCOME')) || 0,
        'TIMETOPAYDEBT': parseFloat(getLocal('TIMETOPAYDEBT')) || 0
    };
    
    // Update financial elements with $ format
    for (const [elementId, value] of Object.entries(financialElements)) {
        const element = document.getElementById(elementId);
        if (element) {
            element.textContent = '$' + value.toFixed(2);
        }
    }
    
    // Update ratio elements without $ format
    for (const [elementId, value] of Object.entries(ratioElements)) {
        const element = document.getElementById(elementId);
        if (element) {
            element.textContent = value.toFixed(2);
        }
    }
    
    // Apply color formatting to ratio elements
    colorChangeFIRE();
    colorChangeSavingsToDebt(parseFloat(getLocal('SAVINGSTODEBT')) || 0);
    colorChangeHTI();
    colorChangeDTI();
}

function colorChangeFIRE() {
    const fire = parseFloat(document.getElementById("FIRERATIO").textContent);
    if (isNaN(fire)) return;
    document.getElementById("FIRERATIO").style.color = 
        fire >= 1.0 ? "green" : fire >= 0.25 ? "orange" : "red";
}

function colorChangeSavingsToDebt(savingsToDebt) {
    if (isNaN(savingsToDebt)) return;
    document.getElementById("SAVINGSTODEBT").style.color = 
        savingsToDebt >= 2 ? "green" : savingsToDebt >= 1 ? "orange" : "red";
}

function colorChangeHTI() {
    const hti = parseFloat(document.getElementById("HOUSINGTOINCOME").textContent);
    if (isNaN(hti)) return;
    document.getElementById("HOUSINGTOINCOME").style.color = 
        hti < 0.28 ? "green" : hti <= 0.35 ? "orange" : "red";
}

function colorChangeDTI() {
    const dti = parseFloat(document.getElementById("DEBTTOINCOME").textContent);
    if (isNaN(dti)) return;
    document.getElementById("DEBTTOINCOME").style.color = 
        dti < 0.20 ? "green" : dti <= 0.36 ? "orange" : "red";
}

// Make function available globally
window.populateValuesFromLocalStorage = populateValuesFromLocalStorage;

// Run the population function immediately and when DOM is loaded
populateValuesFromLocalStorage();

document.addEventListener('DOMContentLoaded', function() {
    populateValuesFromLocalStorage();
    
    // Also remove display:none from the body
    document.body.style.display = 'block';
});

function calculateTaxesAndContributions() {
    // Use the getLocalJSON utility to retrieve JSON data without URL decoding
    import('/utility/getLocalJSON.js')
        .then(module => {
            const getLocalJSON = module.default;
            
            // Get data from localStorage using the JSON utility
            const introData = getLocalJSON('introDataJSON');
            const normalizedIncome = getLocalJSON('incomeValuesJSON');
            
            // Check if data exists
            if (!introData || !normalizedIncome) {
                console.error('Required data missing for tax calculation');
                return;
            }
            
            // Send data to worker
            fetch('https://incomeiqworker.4hm7q4q75z.workers.dev/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    type: 'calculateTaxesAndContributions',
                    introData: introData,
                    normalizedIncome: normalizedIncome
                })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Worker response:', data);
                // Handle the response data here and update UI
                if (data && data.results) {
                    // Update UI with calculation results
                    updateCalculationResults(data.results);
                }
            })
            .catch(error => {
                console.error('Error sending data to worker:', error);
            });
        })
        .catch(err => {
            console.error('Error importing getLocalJSON module:', err);
        });
}

// Helper function to update UI with calculation results
function updateCalculationResults(results) {
    // Update relevant UI elements with the calculation results
    // For example:
    if (results.incomeTax !== undefined) {
        document.getElementById('TOTALTAXANNUAL').textContent = '$' + parseFloat(results.incomeTax).toFixed(2);
    }
    
    if (results.obligations !== undefined) {
        document.getElementById('OBLIGATIONANNUAL').textContent = '$' + parseFloat(results.obligations).toFixed(2);
    }
    
    // Add other UI updates as needed
    
    // Refresh color formatting if needed
    populateValuesFromLocalStorage();
}
</script>

</body>
</html>
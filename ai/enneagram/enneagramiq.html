<!--
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
-->

<div class="device-container">

        <div class="row1">
            <label class="category-label">Self Description</label>
            <textarea id="enneagram-self" rows="4" placeholder="I'm creative and value efficiency in all my work
I get impatient when things move slowly
I'm detail-oriented but struggle with delegation
I prefer working alone on complex problems"></textarea>
        </div>
        <div class="row1">
            <label class="category-label">Core Traits</label>
            <div class="grid-container" id="enneagram-traits">
                <div class="grid-item" data-value="1-Perfection">I must be perfect and avoid mistakes</div>
                <div class="grid-item" data-value="2-Help">I feel fulfilled by helping others</div>
                <div class="grid-item" data-value="3-Success">I'm driven to succeed and be recognized</div>
                <div class="grid-item" data-value="4-Unique">I need to be unique and authentic</div>
                <div class="grid-item" data-value="5-Knowledge">I seek knowledge and conserve energy</div>
                <div class="grid-item" data-value="6-Security">I crave security and question everything</div>
                <div class="grid-item" data-value="7-Fun">I chase excitement and avoid pain</div>
                <div class="grid-item" data-value="8-Control">I take charge and protect what's mine</div>
                <div class="grid-item" data-value="9-Peace">I seek peace and avoid conflict</div>
            </div>
        </div>
        <div class="row1">
            <label class="category-label">Behavioral Responses</label>
            <div class="grid-container" id="enneagram-behaviors">
                <div class="grid-item" data-value="Conflict-1">In conflict, I focus on right/wrong</div>
                <div class="grid-item" data-value="Conflict-2">In conflict, I mediate or please</div>
                <div class="grid-item" data-value="Conflict-3">In conflict, I defend my image</div>
                <div class="grid-item" data-value="Conflict-4">In conflict, I feel misunderstood</div>
                <div class="grid-item" data-value="Conflict-5">In conflict, I withdraw to think</div>
                <div class="grid-item" data-value="Conflict-6">In conflict, I get anxious and defensive</div>
                <div class="grid-item" data-value="Conflict-7">In conflict, I deflect with humor</div>
                <div class="grid-item" data-value="Conflict-8">In conflict, I assert dominance</div>
                <div class="grid-item" data-value="Conflict-9">In conflict, I shut down or agree</div>
                <div class="grid-item" data-value="Stress-1">Under stress, I get rigid and critical</div>
                <div class="grid-item" data-value="Stress-2">Under stress, I cling to others</div>
                <div class="grid-item" data-value="Stress-3">Under stress, I push harder</div>
                <div class="grid-item" data-value="Stress-4">Under stress, I feel isolated</div>
                <div class="grid-item" data-value="Stress-5">Under stress, I retreat completely</div>
                <div class="grid-item" data-value="Stress-6">Under stress, I panic or overthink</div>
                <div class="grid-item" data-value="Stress-7">Under stress, I distract myself</div>
                <div class="grid-item" data-value="Stress-8">Under stress, I lash out</div>
                <div class="grid-item" data-value="Stress-9">Under stress, I numb out</div>
                <div class="grid-item" data-value="Growth-1">At my best, I'm calm and accepting</div>
                <div class="grid-item" data-value="Growth-2">At my best, I'm independent</div>
                <div class="grid-item" data-value="Growth-3">At my best, I'm genuine</div>
                <div class="grid-item" data-value="Growth-4">At my best, I inspire others</div>
                <div class="grid-item" data-value="Growth-5">At my best, I'm focused and insightful</div>
                <div class="grid-item" data-value="Growth-6">At my best, I'm brave and reliable</div>
                <div class="grid-item" data-value="Growth-7">At my best, I'm steady and productive</div>
                <div class="grid-item" data-value="Growth-8">At my best, I'm generous and open</div>
                <div class="grid-item" data-value="Growth-9">At my best, I'm engaged and assertive</div>
            </div>
        </div>
        <div class="row1">
            <label class="category-label">Core Motivations</label>
            <textarea id="enneagram-motivations" rows="3" placeholder="Being recognized as highly competent
Creating meaningful impact through my work
Maintaining independence and autonomy"></textarea>
        </div>
        <div class="row1">
            <label class="category-label">Core Fears</label>
            <textarea id="enneagram-fears" rows="3" placeholder="Being seen as incompetent or inadequate
Losing control over important decisions
Being vulnerable and dependent on others"></textarea>
        </div>
        <div class="row1">
            <label class="category-label">Stress Behavior</label>
            <textarea id="enneagram-stress" rows="3" placeholder="I become critical of everyone around me
I withdraw and isolate myself from others
I obsess over details and lose perspective"></textarea>
        </div>
        <div class="row1">
            <label class="category-label">Best Behavior</label>
            <textarea id="enneagram-growth" rows="3" placeholder="I'm calm and can help others see solutions
I inspire people with creative ideas
I balance practicality with compassion"></textarea>
        </div>
        <div class="row1">
            <label class="category-label">Childhood Memory</label>
            <textarea id="enneagram-childhood" rows="3" placeholder="I was praised for academic achievements
My parents expected perfection in everything
I often took charge of group projects at school"></textarea>
        </div>
        <div class="row1">
            <button class="generate-btn" id="generate-enneagram-btn">Generate EnneagramIQâ„¢ Analysis</button>
            <button class="clear-btn" id="clear-enneagram-btn">Clear All</button>
        </div>
  

<script>
(function(){
    // Listen for grid-item-toggled event from datain.js
    function handleGridItemToggled(event) {
        console.log('[EnneagramIQ] Grid item toggled event received');
        // UI behavior only - persistence handled centrally
    }

    async function generateEnneagram(){
        console.log('[EnneagramIQ] Generate button clicked.');
        
        const result = await window.enhancedLoading(
            'generate-enneagram-btn',
            'enneagram',
            async () => {
                const formData = window.FormPersistence.getSavedFormData();
                if (!formData) {
                    throw new Error('Please complete the form before generating.');
                }
                
                const apiUrl = 'https://enneagram.4hm7q4q75z.workers.dev/';
                const res = await fetch(apiUrl, { 
                    method: 'POST', 
                    headers: {'Content-Type':'application/json'}, 
                    body: JSON.stringify(formData) 
                });
                
                if (!res.ok) {
                    throw new Error(`HTTP error! Status: ${res.status}`);
                }
                
                const data = await res.json();
                
                // Validate response format like other modules
                if (data.message && data.message !== 'Success') {
                    throw new Error(`An error occurred: ${data.message || data.error || ''}`);
                }
                
                window.FormPersistence.saveResponseData(data);
                
                document.dispatchEvent(new CustomEvent('api-response-received', { 
                    detail: { module: 'enneagramiq', type: 'worker-response', timestamp: Date.now() } 
                }));
                
                return data;
            }
        );
        
        // Enhanced loading either returns result or throws error - no need to check result.success
        console.log('[EnneagramIQ] Analysis generated successfully');
    }

    // Initialization
    document.addEventListener('grid-item-toggled', handleGridItemToggled);
    document.getElementById('generate-enneagram-btn').addEventListener('click',generateEnneagram);
    document.getElementById('clear-enneagram-btn').addEventListener('click', () => window.FormPersistence.clearLocalStorage());
})();
</script>
</div> <!-- Close mobile-container -->
</body>
</html>

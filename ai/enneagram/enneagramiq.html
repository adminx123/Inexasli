<!--
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
-->


<div class="device-container">

<div class="row1 product-description-container">
    <h2 class="product-description-heading">Discover Your Enneagram Insights!</h2>
    <p class="product-description-text">
        Curious about your Enneagram type and what it reveals about your personality, motivations, and growth paths? EnneagramIQ™ guides you through a series of reflective questions. Your responses help our AI provide personalized insights based on Enneagram wisdom, offering a deeper understanding of yourself and your interactions with others.
    </p>
    <p class="product-description-final">
        Let's begin your journey of self-discovery!
    </p>
    <p class="product-description-disclaimer">
        <em>AI can make mistakes, consult a professional.</em>
    </p>
</div>

<div class="premium-blur">

        <div class="row1">
            <h3 class="tooltip1" data-tooltip="Describe yourself in your own words to help identify your Enneagram personality type.">
                Self Description<span class="tooltip1-content"></span>
            </h3>
            <textarea id="enneagram-self" rows="4" placeholder="I'm creative and value efficiency in all my work
I get impatient when things move slowly
I'm detail-oriented but struggle with delegation
I prefer working alone on complex problems"></textarea>
        </div>
        <div class="row1">
            <h3 class="tooltip1" data-tooltip="Select the core motivations and drives that resonate most with your personality across the nine Enneagram types.">
                Core Traits<span class="tooltip1-content"></span>
            </h3>
            <div class="grid-container" id="enneagram-traits">
                <div class="grid-item" data-value="1-Perfection">I must be perfect and avoid mistakes</div>
                <div class="grid-item" data-value="2-Help">I feel fulfilled by helping others</div>
                <div class="grid-item" data-value="3-Success">I'm driven to succeed and be recognized</div>
                <div class="grid-item" data-value="4-Unique">I need to be unique and authentic</div>
                <div class="grid-item" data-value="5-Knowledge">I seek knowledge and conserve energy</div>
                <div class="grid-item" data-value="6-Security">I crave security and question everything</div>
                <div class="grid-item" data-value="7-Fun">I chase excitement and avoid pain</div>
                <div class="grid-item" data-value="8-Control">I take charge and protect what's mine</div>
                <div class="grid-item" data-value="9-Peace">I seek peace and avoid conflict</div>
            </div>
        </div>
        <div class="row1">
            <h3 class="tooltip1" data-tooltip="Select behaviors that describe how you typically respond in conflict, stress, and growth situations.">
                Behavioral Responses<span class="tooltip1-content"></span>
            </h3>
            <div class="grid-container" id="enneagram-behaviors">
                <div class="grid-item" data-value="Conflict-1">In conflict, I focus on right/wrong</div>
                <div class="grid-item" data-value="Conflict-2">In conflict, I mediate or please</div>
                <div class="grid-item" data-value="Conflict-3">In conflict, I defend my image</div>
                <div class="grid-item" data-value="Conflict-4">In conflict, I feel misunderstood</div>
                <div class="grid-item" data-value="Conflict-5">In conflict, I withdraw to think</div>
                <div class="grid-item" data-value="Conflict-6">In conflict, I get anxious and defensive</div>
                <div class="grid-item" data-value="Conflict-7">In conflict, I deflect with humor</div>
                <div class="grid-item" data-value="Conflict-8">In conflict, I assert dominance</div>
                <div class="grid-item" data-value="Conflict-9">In conflict, I shut down or agree</div>
                <div class="grid-item" data-value="Stress-1">Under stress, I get rigid and critical</div>
                <div class="grid-item" data-value="Stress-2">Under stress, I cling to others</div>
                <div class="grid-item" data-value="Stress-3">Under stress, I push harder</div>
                <div class="grid-item" data-value="Stress-4">Under stress, I feel isolated</div>
                <div class="grid-item" data-value="Stress-5">Under stress, I retreat completely</div>
                <div class="grid-item" data-value="Stress-6">Under stress, I panic or overthink</div>
                <div class="grid-item" data-value="Stress-7">Under stress, I distract myself</div>
                <div class="grid-item" data-value="Stress-8">Under stress, I lash out</div>
                <div class="grid-item" data-value="Stress-9">Under stress, I numb out</div>
                <div class="grid-item" data-value="Growth-1">At my best, I'm calm and accepting</div>
                <div class="grid-item" data-value="Growth-2">At my best, I'm independent</div>
                <div class="grid-item" data-value="Growth-3">At my best, I'm genuine</div>
                <div class="grid-item" data-value="Growth-4">At my best, I inspire others</div>
                <div class="grid-item" data-value="Growth-5">At my best, I'm focused and insightful</div>
                <div class="grid-item" data-value="Growth-6">At my best, I'm brave and reliable</div>
                <div class="grid-item" data-value="Growth-7">At my best, I'm steady and productive</div>
                <div class="grid-item" data-value="Growth-8">At my best, I'm generous and open</div>
                <div class="grid-item" data-value="Growth-9">At my best, I'm engaged and assertive</div>
            </div>

                        <button class="generate-btn" id="generate-enneagram-btn">Generate EnneagramIQ™ Analysis</button>

        </div>
        
  


<script type="module">
/*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
*/

// Rate limiting utilities are now available globally via window.rateLimiter

(function() {
  // Generate button handler - IMPLEMENTING COMPLETE CALORIEIQ ARCHITECTURE
  async function handleGenerateEnneagramIq() {
    try {
      const formData = window.enneagramFormPersistence.getSavedFormData();
      if (!formData) { 
        alert('Please complete the form before generating an enneagram analysis.'); 
        return;
      }
      // Check rate limiting before proceeding
      if (window.rateLimiter.isRateLimited('enneagram', 5, 60 * 60 * 1000)) { // 5 requests per hour (as per rate-limiter config)
        alert('You have exceeded the request limit for enneagram analysis. Please try again later.');
        return;
      }
      // Create worker payload with email for paid users (DRY function)
      const workerPayload = window.rateLimiter.createWorkerPayload('enneagram', formData);
      const dataContainer = document.querySelector('.device-container');
      let backendResponse = null;
      try {
        backendResponse = await window.enhancedLoading(
          'generate-enneagram-btn',
          'enneagram',
          async () => {
            const apiUrl = 'https://inexasli.com/api/generate';
            const response = await fetch(apiUrl, { 
              method: 'POST', 
              headers: {'Content-Type':'application/json'}, 
              body: JSON.stringify(workerPayload)
            });
            let responseData;
            try {
              responseData = await response.json();
            } catch (e) {
              responseData = { error: 'Invalid JSON', message: 'Invalid response from server.' };
            }
            // Always call handleRateLimitResponse with backend response
            window.rateLimiter.handleRateLimitResponse(dataContainer, responseData, !response.ok, 'EnneagramIQ');
            if (!response.ok) {
              throw new Error(responseData.message || `HTTP error! Status: ${response.status}`);
            }
            if (responseData.message !== 'Success') {
              throw new Error(`An error occurred: ${responseData.message || responseData.error || ''}`);
            }
            return responseData;
          }
        );
        window.rateLimiter.incrementRequestCount('enneagram');
        window.enneagramFormPersistence.saveResponseData(backendResponse);
        const event = new CustomEvent('api-response-received', {
          detail: {
            module: 'enneagramiq',
            type: 'worker-response',
            timestamp: Date.now()
          }
        });
        document.dispatchEvent(event);
      } catch (error) {
        if (backendResponse && dataContainer) {
          window.rateLimiter.handleRateLimitResponse(dataContainer, backendResponse, true, 'EnneagramIQ');
        }
        console.error('[EnneagramIQ] Error generating enneagram analysis:', error);
      }
    } catch (error) {
      console.error('[EnneagramIQ] Error generating enneagram analysis:', error);
      alert('An error occurred while generating your enneagram analysis. Please try again later.');
    }
  }

  // Initialization - simplified to match calorie module pattern
  const generateEnneagramBtn = document.getElementById('generate-enneagram-btn');
  if (generateEnneagramBtn) {
    generateEnneagramBtn.addEventListener('click', handleGenerateEnneagramIq);
    // Set flag to prevent duplicate handler attachment
    generateEnneagramBtn.dataset.handlerAttached = 'true';
  }

})();
</script>
    </div>

<!--
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
-->

<script src="../../payment/paymentform.js"></script>

<div class="device-container">

<div class="row1 product-description-container">
    <h2 class="product-description-heading">Discover Your Enneagram Insights!</h2>
    <p class="product-description-text">
        Curious about your Enneagram type and what it reveals about your personality, motivations, and growth paths? EnneagramIQ™ guides you through a series of reflective questions. Your responses help our AI provide personalized insights based on Enneagram wisdom, offering a deeper understanding of yourself and your interactions with others.
    </p>
    <p class="product-description-final">
        Let's begin your journey of self-discovery!
    </p>
    <p class="product-description-disclaimer">
        <em>AI can make mistakes, consult a professional.</em>
    </p>
</div>

<div class="premium-blur">

        <div class="row1">
            <label class="category-label">Self Description</label>
            <textarea id="enneagram-self" rows="4" placeholder="I'm creative and value efficiency in all my work
I get impatient when things move slowly
I'm detail-oriented but struggle with delegation
I prefer working alone on complex problems"></textarea>
        </div>
        <div class="row1">
            <label class="category-label">Core Traits</label>
            <div class="grid-container" id="enneagram-traits">
                <div class="grid-item" data-value="1-Perfection">I must be perfect and avoid mistakes</div>
                <div class="grid-item" data-value="2-Help">I feel fulfilled by helping others</div>
                <div class="grid-item" data-value="3-Success">I'm driven to succeed and be recognized</div>
                <div class="grid-item" data-value="4-Unique">I need to be unique and authentic</div>
                <div class="grid-item" data-value="5-Knowledge">I seek knowledge and conserve energy</div>
                <div class="grid-item" data-value="6-Security">I crave security and question everything</div>
                <div class="grid-item" data-value="7-Fun">I chase excitement and avoid pain</div>
                <div class="grid-item" data-value="8-Control">I take charge and protect what's mine</div>
                <div class="grid-item" data-value="9-Peace">I seek peace and avoid conflict</div>
            </div>
        </div>
        <div class="row1">
            <label class="category-label">Behavioral Responses</label>
            <div class="grid-container" id="enneagram-behaviors">
                <div class="grid-item" data-value="Conflict-1">In conflict, I focus on right/wrong</div>
                <div class="grid-item" data-value="Conflict-2">In conflict, I mediate or please</div>
                <div class="grid-item" data-value="Conflict-3">In conflict, I defend my image</div>
                <div class="grid-item" data-value="Conflict-4">In conflict, I feel misunderstood</div>
                <div class="grid-item" data-value="Conflict-5">In conflict, I withdraw to think</div>
                <div class="grid-item" data-value="Conflict-6">In conflict, I get anxious and defensive</div>
                <div class="grid-item" data-value="Conflict-7">In conflict, I deflect with humor</div>
                <div class="grid-item" data-value="Conflict-8">In conflict, I assert dominance</div>
                <div class="grid-item" data-value="Conflict-9">In conflict, I shut down or agree</div>
                <div class="grid-item" data-value="Stress-1">Under stress, I get rigid and critical</div>
                <div class="grid-item" data-value="Stress-2">Under stress, I cling to others</div>
                <div class="grid-item" data-value="Stress-3">Under stress, I push harder</div>
                <div class="grid-item" data-value="Stress-4">Under stress, I feel isolated</div>
                <div class="grid-item" data-value="Stress-5">Under stress, I retreat completely</div>
                <div class="grid-item" data-value="Stress-6">Under stress, I panic or overthink</div>
                <div class="grid-item" data-value="Stress-7">Under stress, I distract myself</div>
                <div class="grid-item" data-value="Stress-8">Under stress, I lash out</div>
                <div class="grid-item" data-value="Stress-9">Under stress, I numb out</div>
                <div class="grid-item" data-value="Growth-1">At my best, I'm calm and accepting</div>
                <div class="grid-item" data-value="Growth-2">At my best, I'm independent</div>
                <div class="grid-item" data-value="Growth-3">At my best, I'm genuine</div>
                <div class="grid-item" data-value="Growth-4">At my best, I inspire others</div>
                <div class="grid-item" data-value="Growth-5">At my best, I'm focused and insightful</div>
                <div class="grid-item" data-value="Growth-6">At my best, I'm brave and reliable</div>
                <div class="grid-item" data-value="Growth-7">At my best, I'm steady and productive</div>
                <div class="grid-item" data-value="Growth-8">At my best, I'm generous and open</div>
                <div class="grid-item" data-value="Growth-9">At my best, I'm engaged and assertive</div>
            </div>
        </div>
        <div class="row1">
            <label class="category-label">Core Motivations</label>
            <textarea id="enneagram-motivations" rows="3" placeholder="Being recognized as highly competent
Creating meaningful impact through my work
Maintaining independence and autonomy"></textarea>
        </div>
        <div class="row1">
            <label class="category-label">Core Fears</label>
            <textarea id="enneagram-fears" rows="3" placeholder="Being seen as incompetent or inadequate
Losing control over important decisions
Being vulnerable and dependent on others"></textarea>
        </div>
        <div class="row1">
            <label class="category-label">Stress Behavior</label>
            <textarea id="enneagram-stress" rows="3" placeholder="I become critical of everyone around me
I withdraw and isolate myself from others
I obsess over details and lose perspective"></textarea>
        </div>
        <div class="row1">
            <label class="category-label">Best Behavior</label>
            <textarea id="enneagram-growth" rows="3" placeholder="I'm calm and can help others see solutions
I inspire people with creative ideas
I balance practicality with compassion"></textarea>
        </div>
        <div class="row1">
            <label class="category-label">Childhood Memory</label>
            <textarea id="enneagram-childhood" rows="3" placeholder="I was praised for academic achievements
My parents expected perfection in everything
I often took charge of group projects at school"></textarea>       
            <button class="generate-btn" id="generate-enneagram-btn">Generate EnneagramIQ™ Analysis</button>
        </div>
  


<script>
/*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
*/

(function() {
  console.log("Enneagram IQ script initializing");

  // Generate button handler - IMPLEMENTING COMPLETE CALORIEIQ ARCHITECTURE
  async function handleGenerateEnneagramIq() {
    try {
      const formData = window.enneagramFormPersistence.getSavedFormData();
      if (!formData) { 
        alert('Please complete the form before generating an enneagram analysis.'); 
        return;
      }

      // Use enhanced loading with educational facts
      const result = await window.enhancedLoading(
        'generate-enneagram-btn',
        'enneagram',
        async () => {
          const apiUrl = 'https://enneagram.4hm7q4q75z.workers.dev/';
          const response = await fetch(apiUrl, { 
            method: 'POST', 
            headers: {'Content-Type':'application/json'}, 
            body: JSON.stringify(formData) 
          });
          
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          
          const responseData = await response.json();
          if (responseData.message !== 'Success') {
            throw new Error(`An error occurred: ${responseData.message || responseData.error || ''}`);
          }
          
          return responseData;
        }
      );

      // Store the response using centralized system
      window.enneagramFormPersistence.saveResponseData(result);
      
      // Dispatch an event to notify dataout.js that a response was received
      const event = new CustomEvent('api-response-received', {
        detail: {
          module: 'enneagramiq',
          type: 'worker-response',
          timestamp: Date.now()
        }
      });
      document.dispatchEvent(event);
      console.log('[EnneagramIQ] Dispatched api-response-received event');
      
    } catch (error) {
      console.error('[EnneagramIQ] Error generating enneagram analysis:', error);
      alert('An error occurred while generating your enneagram analysis. Please try again later.');
    }
  }

  // Simple initialization - set up event listeners
  function initialize() {
    console.log("[EnneagramIQ] Initializing...");
    
    // Set up generate button event listener - CRITICAL FUNCTIONALITY FROM CALORIEIQ TEMPLATE
    const generateBtn = document.getElementById('generate-enneagram-btn');
    if (generateBtn) {
      generateBtn.removeEventListener('click', handleGenerateEnneagramIq);
      generateBtn.addEventListener('click', handleGenerateEnneagramIq);
      console.log("[EnneagramIQ] Generate button event listener set up");
    } else {
      console.error("[EnneagramIQ] Generate button not found!");
    }
    
    // Set up guided forms toggle button
    const guidedToggleBtn = document.getElementById('guided-forms-toggle');
    if (guidedToggleBtn) {
      guidedToggleBtn.removeEventListener('click', toggleGuidedForms);
      guidedToggleBtn.addEventListener('click', toggleGuidedForms);
    }
  }

  // Toggle guided forms functionality
  let guidedFormsInstance = null;
  
  function toggleGuidedForms() {
    console.log('[EnneagramIQ] Toggling guided forms');
    const toggleBtn = document.getElementById('guided-forms-toggle');
    
    if (guidedFormsInstance) {
      // Disable guided forms
      guidedFormsInstance.destroy();
      guidedFormsInstance = null;
      toggleBtn.textContent = '🚀 Enable Guided Form';
      toggleBtn.style.background = 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)';
      console.log('[EnneagramIQ] Guided forms disabled');
    } else {
      // Enable guided forms
      if (window.GuidedFormSystem) {
        guidedFormsInstance = new window.GuidedFormSystem({
          autoAdvance: true,
          showProgressIndicator: true,
          smoothTransitions: true,
          transitionDuration: 300,
          autoAdvanceDelay: 800,
          enableSkipping: true
        });
        
        guidedFormsInstance.init('device-container');
        
        toggleBtn.textContent = '⏹️ Disable Guided Form';
        toggleBtn.style.background = 'linear-gradient(135deg, #ea667e 0%, #a24b76 100%)';
        console.log('[EnneagramIQ] Guided forms enabled');
      } else {
        console.error('[EnneagramIQ] GuidedFormSystem not available');
        alert('Guided forms system is not loaded. Please refresh the page.');
      }
    }
  }

  // Initialize with multiple triggers to ensure reliability
  function runInitialization() {
    // Use a small delay to ensure DOM is ready
    setTimeout(initialize, 50);
  }

  // Initialize form persistence when DOM is ready
  function initializeEnneagramIQ() {
    console.log("Enneagram IQ DOM ready, initializing form persistence");
    
    // Import and initialize form persistence
    import('../../utility/formPersistence.js').then(module => {
      const FormPersistence = module.FormPersistence;
      const persistence = FormPersistence.getInstance('enneagram', {
        singleSelection: [], // No single selection containers in enneagram
        multiSelection: ['enneagram-traits', 'enneagram-behaviors'] // Multi selection containers
      });
      
      persistence.init({
        moduleName: 'enneagram',
        singleSelection: [],
        multiSelection: ['enneagram-traits', 'enneagram-behaviors']
      });
      
      console.log("Enneagram IQ form persistence initialized");
      
      // Initialize the rest of the functionality after form persistence is set up
      runInitialization();
    }).catch(error => {
      console.error("Failed to initialize Enneagram IQ form persistence:", error);
    });
  }

  // Initialize immediately if DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initializeEnneagramIQ);
  } else {
    initializeEnneagramIQ();
  }

  // Handle loading through datain.js - only initialize if enneagram module is loaded
  document.addEventListener('data-in-loaded', function(e) {
    const moduleType = e.detail?.moduleType;
    if (moduleType === 'enneagram') {
      console.log("[EnneagramIQ] Enneagram module loaded through datain.js, reinitializing");
      runInitialization();
    }
  });

  // Additional safety net - try again after a short delay
  setTimeout(() => {
    const generateBtn = document.getElementById('generate-enneagram-btn');
    if (generateBtn && !generateBtn.onclick) {
      console.log("[EnneagramIQ] Generate button found but no handler, trying initialization again");
      initialize();
    }
  }, 200);
  
  // Export functions for external access
  window.enneagramIq = { 
    getFormData: () => window.enneagramFormPersistence.getSavedFormData(),
    saveFormData: () => window.enneagramFormPersistence.saveFormData()
  };

})();
</script>
    </div>

<!--
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
-->

<div class="device-container">
        <div class="row1">
            <label class="category-label">Event Type</label>
            <div class="grid-container" id="event-types">
                <div class="grid-item" data-value="Birthday">Planning a Birthday</div>
                <div class="grid-item" data-value="Wedding">Planning a Wedding</div>
                <div class="grid-item" data-value="House Party">Planning a House Party</div>
                <div class="grid-item" data-value="Corporate Event">Planning a Corporate Event</div>
                <div class="grid-item" data-value="Family Reunion">Planning a Family Reunion</div>
                <div class="grid-item" data-value="Concert">Planning a Concert</div>
                <div class="grid-item" data-value="Graduation">Planning a Graduation</div>
                <div class="grid-item" data-value="Festival">Planning a Festival</div>
                <div class="grid-item" data-value="Charity Event">Planning a Charity Event</div>
                <div class="grid-item" data-value="Community Gathering">Planning a Community Gathering</div>
            </div>
        </div>
        <div class="row1">
            <label class="category-label">Venue Status</label>
            <select id="event-venue">
                <option value="" disabled selected>Select Venue Status</option>
                <option value="Venue Secured">Venue Secured</option>
                <option value="Venue Needed">Venue Needed</option>
            </select>
        </div>
        <div class="row1">
            <label class="category-label">Location Type</label>
            <select id="event-location">
                <option value="" disabled selected>Select Location Type</option>
                <option value="indoors">Indoors</option>
                <option value="outdoors">Outdoors</option>
            </select>
        </div>
        <div class="row1" id="event-indoors">
            <label class="category-label">Indoor Requirements</label>
            <div class="grid-container" id="event-indoor-setup">
                <div class="grid-item" data-value="Seating">Seating Needed</div>
                <div class="grid-item" data-value="Lighting">Lighting Needed</div>
                <div class="grid-item" data-value="Decor">Decor Needed</div>
                <div class="grid-item" data-value="Catering">Catering Needed</div>
                <div class="grid-item" data-value="Microphone">Microphone Needed</div>
                <div class="grid-item" data-value="Wi-Fi">Wi-Fi Needed</div>
                <div class="grid-item" data-value="Sound Equipment">Sound Equipment Needed</div>
                <div class="grid-item" data-value="Restrooms">Restrooms Needed</div>
                <div class="grid-item" data-value="Registration">Registration Desk Needed</div>
                <div class="grid-item" data-value="Security">Security Needed</div>
            </div>
        </div>
        <div class="row1 hidden" id="event-outdoors">
            <label class="category-label">Outdoor Requirements</label>
            <div class="grid-container" id="event-outdoor">
                <div class="grid-item" data-value="Tent">Tent Needed</div>
                <div class="grid-item" data-value="BackupPlan">Backup Plan Needed</div>
                <div class="grid-item" data-value="Heaters">Heaters Needed</div>
                <div class="grid-item" data-value="Sound Equipment">Sound Equipment Needed</div>
                <div class="grid-item" data-value="Lighting">Lighting Needed</div>
                <div class="grid-item" data-value="Seating">Seating Needed</div>
                <div class="grid-item" data-value="Catering">Catering Needed</div>
                <div class="grid-item" data-value="Security">Security Needed</div>
                <div class="grid-item" data-value="Registration">Registration Desk Needed</div>
                <div class="grid-item" data-value="Wi-Fi">Wi-Fi Needed</div>
                <div class="grid-item" data-value="Decor">Decor Needed</div>
            </div>
        </div>
        <div class="row1">
            <label class="category-label">Event Elements</label>
            <div class="grid-container" id="event-elements">
                <div class="grid-item" data-value="Food">Food Needed</div>
                <div class="grid-item" data-value="Drinks">Drinks Needed</div>
                <div class="grid-item" data-value="Alcoholic Drinks">Alcoholic Drinks Needed</div>
                <div class="grid-item" data-value="Photography">Photography Needed</div>
                <div class="grid-item" data-value="Games">Games Needed</div>
                <div class="grid-item" data-value="Live Entertainment">Live Entertainment Needed</div>
                <div class="grid-item" data-value="Decorations">Decorations Needed</div>
                <div class="grid-item" data-value="Music">Music Needed</div>
                <div class="grid-item" data-value="Invitations">Invitations Needed</div>
                <div class="grid-item" data-value="Gift Bags">Gift Bags Needed</div>
            </div>
        </div>
        <div class="row1">
            <label class="category-label">Attendance & Budget</label>
            <input type="number" id="event-guests" placeholder="50" min="1">
            <input type="number" id="event-budget" placeholder="5000">
        </div>
        <div class="row1">
            <label class="category-label">Event Time</label>
            <label for="event-start">Start:</label>
            <input type="time" id="event-start" name="event-start">
            <label for="event-end">End:</label>
            <input type="time" id="event-end" name="event-end">
        </div>
        <div class="row1">
            <label class="category-label">Event Location</label>
            <textarea id="event-specific-location" rows="1" placeholder="123 Main St, New York"></textarea>
        </div>
        <div class="row1">
            <label class="category-label">Additional Context</label>
            <textarea id="event-specific-context" rows="3" placeholder="Majority of attendees have an Italian background
Most individuals between 5-10 yrs old
Need accommodations for 3 wheelchair users"></textarea>
       
            <button class="generate-btn" id="generate-event-btn">Generate EventIQâ„¢ Plan</button>
            <button class="clear-btn" id="clear-event-btn">Clear All</button>
        </div>
  

<script>
/*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
*/

(function() {
    console.log("EventIQ script initializing");

    // Listen for grid-item-toggled event from datain.js
    function handleGridItemToggled(event) {
        console.log('[EventIQ] Grid item toggled event received');
        // UI behavior only - persistence handled centrally
    }

    // Toggle visibility of indoor/outdoor setup based on event-location
    function toggleEventDetails() {
        const locationSelect = document.getElementById('event-location');
        const indoorSection = document.getElementById('event-indoors');
        const outdoorSection = document.getElementById('event-outdoors');
        
        if (locationSelect && indoorSection && outdoorSection) {
            if (locationSelect.value === 'indoors') {
                indoorSection.classList.remove('hidden');
                outdoorSection.classList.add('hidden');
            } else if (locationSelect.value === 'outdoors') {
                indoorSection.classList.add('hidden');
                outdoorSection.classList.remove('hidden');
            } else {
                // For default or any other option, show indoor by default
                indoorSection.classList.remove('hidden');
                outdoorSection.classList.add('hidden');
            }
        }
    }

    // Handle the generate button click
    async function handleGenerateEventIq() {
        console.log('[EventIQ] Generate button clicked.');
        
        const result = await window.enhancedLoading(
            'generate-event-btn',
            'event',
            async () => {
                const formData = window.FormPersistence.getSavedFormData();
                if (!formData) {
                    console.error('[EventIQ] No input data found in localStorage.');
                    throw new Error('Please complete the form before generating an event plan.');
                }
                
                // Send data to worker
                const apiUrl = 'https://event.4hm7q4q75z.workers.dev/';
                
                console.log('[EventIQ] Sending eventIqInput to worker');
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                
                const responseData = await response.json();
                console.log('[EventIQ] Worker response:', responseData);
                
                if (responseData.message !== 'Success') {
                    throw new Error(`An error occurred: ${responseData.message || responseData.error || ''}`);
                }
                
                // Store the response
                window.FormPersistence.saveResponseData(responseData);
                
                // Dispatch an event to notify dataout.js that a response was received
                const event = new CustomEvent('api-response-received', {
                    detail: {
                        module: 'eventiq',
                        type: 'worker-response',
                        timestamp: Date.now()
                    }
                });
                document.dispatchEvent(event);
                console.log('[EventIQ] Dispatched api-response-received event');
                
                return responseData;
            }
        );
        
        // Enhanced loading either returns result or throws error - no need to check result.success
        console.log('[EventIQ] Event plan generated successfully');
    }

    // Setup location select change handler for indoor/outdoor toggle
    function setupLocationHandler() {
        const locationSelect = document.getElementById('event-location');
        if (locationSelect) {
            locationSelect.addEventListener('change', toggleEventDetails);
        }
    }

    // Initialization
    document.addEventListener('grid-item-toggled', handleGridItemToggled);
    setupLocationHandler();
    toggleEventDetails(); // Initialize visibility
    document.getElementById('generate-event-btn').addEventListener('click', handleGenerateEventIq);
    document.getElementById('clear-event-btn').addEventListener('click', () => window.FormPersistence.clearLocalStorage());
})();
</script>
    </div>

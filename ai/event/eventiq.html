<!--
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
-->


<div class="device-container" id="eventiq-device-container">

<div class="row1 product-description-container">
    <h2 class="product-description-heading">Plan Your Perfect Event, Effortlessly!</h2>
    <p class="product-description-text">
        Organizing an event, big or small? EventIQâ„¢ helps you streamline the planning process. By answering some key questions about your event's goals, budget, and preferences, you'll enable our AI to provide tailored suggestions, checklists, and ideas. This helps you stay organized, consider all angles, and create a memorable occasion.
    </p>
    <p class="product-description-final">
        Let's start planning your successful event!
    </p>
    <p class="product-description-disclaimer">
        <em>AI can make mistakes, consult a professional.</em>
    </p>
</div>

        <div class="row1">
            <h3 class="tooltip1" data-tooltip="Select the type of event you're planning to receive tailored suggestions and planning advice.">
                Event Type<span class="tooltip1-content"></span>
            </h3>
            <div class="grid-container" id="types">
                <div class="grid-item" data-value="Birthday">Birthday</div>
                <div class="grid-item" data-value="Wedding">Wedding</div>
                <div class="grid-item" data-value="House Party">House Party</div>
                <div class="grid-item" data-value="Corporate Event">Corporate Event</div>
                <div class="grid-item" data-value="Family Reunion">Family Reunion</div>
                <div class="grid-item" data-value="Concert">Concert</div>
                <div class="grid-item" data-value="Graduation">Graduation</div>
                <div class="grid-item" data-value="Festival">Festival</div>
                <div class="grid-item" data-value="Charity Event">Charity Event</div>
                <div class="grid-item" data-value="Community Gathering">Community Gathering</div>
            </div>

            <h3 class="tooltip1" data-tooltip="Select the elements that will be part of your event (e.g., food, drinks, entertainment, etc.) for tailored planning.">
                Event Elements<span class="tooltip1-content"></span>
            </h3>
            <div class="grid-container" id="elements">
                <div class="grid-item" data-value="Food">Food</div>
                <div class="grid-item" data-value="Drinks">Drinks</div>
                <div class="grid-item" data-value="Alcoholic Drinks">Alcoholic Drinks</div>
                <div class="grid-item" data-value="Photography">Photography</div>
                <div class="grid-item" data-value="Games">Games</div>
                <div class="grid-item" data-value="Live Entertainment">Live Entertainment</div>
                <div class="grid-item" data-value="Decorations">Decorations</div>
                <div class="grid-item" data-value="Music">Music</div>
                <div class="grid-item" data-value="Invitations">Invitations</div>
                <div class="grid-item" data-value="Gift Bags">Gift Bags</div>
            </div>
        </div>
      

        <div class="row1">

   <h3 class="tooltip1" data-tooltip="Indicate whether you already have a venue secured or need help finding one.">
                Venue Status<span class="tooltip1-content"></span>
            </h3>
            <select id="venue">
                <option value="" disabled selected>Select Venue Status</option>
                <option value="Venue Secured">Venue Secured</option>
                <option value="Venue Needed">Venue Needed</option>
            </select>

            
            <h3 class="tooltip1" data-tooltip="Choose whether your event will be held indoors or outdoors to get appropriate planning recommendations.">
                Location Type<span class="tooltip1-content"></span>
            </h3>
            <select id="location">
                <option value="" disabled selected>Select Location Type</option>
                <option value="indoors">Indoors</option>
                <option value="outdoors">Outdoors</option>
            </select>

            <h3 class="tooltip1" data-tooltip="Specify the location or address for your event.">
                Event Location<span class="tooltip1-content"></span>
            </h3>
            <textarea id="specific-location" rows="1" placeholder="123 Main St, New York"></textarea>
        </div>


        <div class="row1" id="event-requirements">
            <h3 class="tooltip1" data-tooltip="Select all the equipment, services, and setup requirements needed for your event.">
                Requirements<span class="tooltip1-content"></span>
            </h3>
            <div class="grid-container" id="setup">
                <div class="grid-item" data-value="Seating">Seating</div>
                <div class="grid-item" data-value="Lighting">Lighting</div>
                <div class="grid-item" data-value="Decor">Decor</div>
                <div class="grid-item" data-value="Catering">Catering</div>
                <div class="grid-item" data-value="Microphone">Microphone</div>
                <div class="grid-item" data-value="Wi-Fi">Wi-Fi</div>
                <div class="grid-item" data-value="Sound Equipment">Sound Equipment</div>
                <div class="grid-item" data-value="Restrooms">Restrooms</div>
                <div class="grid-item" data-value="Registration">Registration Desk</div>
                <div class="grid-item" data-value="Security">Security</div>
                <div class="grid-item" data-value="Tent">Tent</div>
                <div class="grid-item" data-value="BackupPlan">Backup Plan</div>
                <div class="grid-item" data-value="Heaters">Heaters</div>
            </div>
        </div>
      
    
    
        <div class="row1">

  <h3 class="tooltip1" data-tooltip="Set the start and end time for your event.">
      Event Time<span class="tooltip1-content"></span>
  </h3>
            <label for="start">Start:</label>
            <input type="datetime-local" id="start" name="start">
            <label for="end">End:</label>
            <input type="datetime-local" id="end" name="end">


<h3 class="tooltip1" data-tooltip="Enter the expected number of guests and your budget.">
    Attendance & Budget<span class="tooltip1-content"></span>
</h3>
            <input type="number" id="guests" placeholder="50" min="1">
            <input type="number" id="budget" placeholder="5000">

            <h3 class="tooltip1" data-tooltip="Add any extra details or context that will help us plan your event.">
                Additional Context<span class="tooltip1-content"></span>
            </h3>
            <textarea id="specific-context" rows="3" placeholder="Majority of attendees have an Italian background. 
Most individuals between 5-10 yrs old. 
Need accommodations for 3 wheelchair users."></textarea>
       
            <button class="generate-btn" id="generate-event-btn">Generate Analysis</button>
        </div>
  

<script type="module">
/*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
*/

// Rate limiting utilities are now available globally via window.rateLimiter

(function() {
    // Initialize FormPersistence for eventiq module
    const fields = [
        { id: 'types', type: 'grid' },
        { id: 'venue', type: 'dropdown' },
        { id: 'location', type: 'dropdown' },
        { id: 'setup', type: 'grid' },
        { id: 'elements', type: 'grid' },
        { id: 'guests', type: 'input' },
        { id: 'budget', type: 'input' },
        { id: 'start', type: 'input' },
        { id: 'end', type: 'input' },
        { id: 'specific-location', type: 'textarea' },
        { id: 'specific-context', type: 'textarea' }
    ];

    // FormPersistence will be initialized by datain.js as window.eventFormPersistence
    // No need to create a new instance here

    // Listen for grid-item-toggled event from datain.js
    function handleGridItemToggled(event) {
        // UI behavior only - persistence handled centrally
    }

    // Handle the generate button click
    async function handleGenerateEventIq() {
        const formData = window.eventFormPersistence.getSavedFormData();
        if (!formData) {
            console.error('[EventIQ] No input data found in localStorage.');
            alert('Please complete the form before generating an event plan.');
            return;
        }

        // Check rate limiting before proceeding
        if (window.rateLimiter.isRateLimited('event', 8, 60 * 60 * 1000)) { // 8 requests per hour (as per rate-limiter config)
            alert('You have exceeded the request limit for event planning. Please try again later.');
            return;
        }

        // Create worker payload with email for paid users (DRY function)
        const workerPayload = window.rateLimiter.createWorkerPayload('event', formData);
        
        const dataContainer = document.querySelector('.device-container') || document.body;
        let backendResponse = null;
        
        try {
            const result = await window.enhancedLoading(
                'generate-event-btn',
                'event',
                async () => {
                    // Send data to worker
                    const apiUrl = 'https://inexasli.com/api/generate';
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(workerPayload)
                    });
                    
                    let responseData;
                    try {
                        responseData = await response.json();
                    } catch (e) {
                        responseData = { error: 'Invalid JSON', message: 'Invalid response from server.' };
                    }
                    
                    // Store backend response for error handling
                    backendResponse = responseData;
                    
                    // Always call handleRateLimitResponse with backend response
                    window.rateLimiter.handleRateLimitResponse(dataContainer, responseData, !response.ok, 'EventIQ');
                    
                    if (!response.ok) {
                        throw new Error(responseData.message || `HTTP error! Status: ${response.status}`);
                    }
                    
                    if (responseData.message !== 'Success') {
                        throw new Error(`An error occurred: ${responseData.message || responseData.error || ''}`);
                    }
                    
                    // Store the response
                    window.eventFormPersistence.saveResponseData(responseData);
                    
                    // Dispatch an event to notify dataout.js that a response was received
                    const event = new CustomEvent('api-response-received', {
                        detail: {
                            module: 'eventiq',
                            type: 'worker-response',
                            timestamp: Date.now()
                        }
                    });
                    document.dispatchEvent(event);
                    
                    return responseData;
                }
            );
            
            // Increment request count after successful response
            window.rateLimiter.incrementRequestCount('event');
            
            // Enhanced loading either returns result or throws error - no need to check result.success
        } catch (error) {
            // If backendResponse is available, update rate limit display and show error
            if (backendResponse && dataContainer) {
                window.rateLimiter.handleRateLimitResponse(dataContainer, backendResponse, true, 'EventIQ');
            }
            // Optionally, show a toast/modal here for generic errors
            console.error('[EventIQ] Error:', error);
        }
    }

    // Initialization - simplified to match calorie module pattern
    const generateEventBtn = document.getElementById('generate-event-btn');
    if (generateEventBtn) {
        generateEventBtn.addEventListener('click', handleGenerateEventIq);
        // Set flag to prevent duplicate handler attachment
        generateEventBtn.dataset.handlerAttached = 'true';
    }
})();
</script>
</div>
</div>

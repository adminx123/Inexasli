<!--
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be prosecuted to the fullest extent of the law in British Columbia, Canada, and applicable jurisdictions worldwide.
-->
<div class="calorie-output-container">
  <div class="calorie-output" id="calorie-output">Loading...</div>
  <button class="copy-btn" onclick="copyCalorieOutput()">Copy</button>
</div>

<script>
// IMMEDIATELY print to page to see if script runs
document.getElementById('calorie-output').innerText = "Script is running...";

// Ultra simple display function - just shows whatever is in localStorage
function displayCalorieOutput() {
  // UPDATE PAGE IMMEDIATELY to show function was called
  document.getElementById('calorie-output').innerText = "Function displayCalorieOutput was called...";
  
  try {
    // Get data from localStorage
    const storedData = localStorage.getItem('calorieIqResponse');
    
    // Update page to show if data was found
    if (storedData) {
      document.getElementById('calorie-output').innerText = "Raw data found: " + storedData;
      
      try {
        // Parse the JSON
        const parsedData = JSON.parse(storedData);
        
        // Check if text property exists and parse it if it's JSON
        if (parsedData.text) {
          try {
            const textData = JSON.parse(parsedData.text);
            
            // Check if parsed text has summary or Response property
            if (textData.summary) {
              document.getElementById('calorie-output').innerText = textData.summary;
            } else if (textData.Response) {
              document.getElementById('calorie-output').innerText = textData.Response;
            } else {
              // Just show the entire JSON object prettified
              document.getElementById('calorie-output').innerText = JSON.stringify(textData, null, 2);
            }
          } catch (e) {
            // If parsing JSON fails, just show the text directly
            document.getElementById('calorie-output').innerText = parsedData.text;
          }
        } else if (parsedData.data) {
          document.getElementById('calorie-output').innerText = parsedData.data;
        } else {
          document.getElementById('calorie-output').innerText = "No text or data field found: " + JSON.stringify(parsedData, null, 2);
        }
      } catch (error) {
        document.getElementById('calorie-output').innerText = "Error parsing JSON: " + error.message;
      }
    } else {
      document.getElementById('calorie-output').innerText = "No calorieIqResponse found in localStorage";
    }
  } catch (error) {
    document.getElementById('calorie-output').innerText = "Error: " + error.message;
  }
}

// Copy output to clipboard
function copyCalorieOutput() {
  const output = document.getElementById('calorie-output').innerText;
  navigator.clipboard.writeText(output)
    .then(() => {
      alert('Copied to clipboard!');
    })
    .catch(err => {
      alert('Failed to copy: ' + err);
    });
}

// Try to call the function immediately to prevent any timing issues
displayCalorieOutput();

// Also set up normal load event listener
document.addEventListener('DOMContentLoaded', function() {
  // Update page to show event fired
  document.getElementById('calorie-output').innerText += "\nDOMContentLoaded event fired";
  displayCalorieOutput();
});

// Add a visible button to manually trigger the function
document.write('<button onclick="displayCalorieOutput()" style="margin-top:10px;background-color:#e74c3c;color:white;padding:8px 15px;border:none;border-radius:4px;cursor:pointer;">Force Display Data</button>');
</script>

<style>
.calorie-output-container {
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  padding: 15px;
  max-width: 100%;
  word-wrap: break-word;
}

.calorie-output {
  white-space: pre-wrap;
  line-height: 1.5;
  margin-bottom: 15px;
  font-family: monospace;
}

.copy-btn {
  background-color: #3498db;
  color: white;
  border: none;
  padding: 8px 15px;
  border-radius: 4px;
  cursor: pointer;
  font-weight: bold;
  margin-top: 10px;
}

.copy-btn:hover {
  background-color: #2980b9;
}
</style>
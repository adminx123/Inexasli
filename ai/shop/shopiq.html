<!--
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
-->

<script src="../../payment/paymentform.js"></script>

<div class="device-container">

<div class="row1 product-description-container">
    <h2 class="product-description-heading">Make Smarter Shopping Decisions!</h2>
    <p class="product-description-text">
        Tired of buying products that don't live up to their promises or discovering safety concerns after purchase? ShopIQâ„¢ helps you make informed buying decisions before you spend your money. Our AI analyzes products for safety concerns, quality issues, misleading claims, and value proposition to help you shop with confidence.
    </p>
    <p class="product-description-final">
        Let's analyze your product!
    </p>
    <p class="product-description-disclaimer">
        <em>AI can make mistakes, consult a professional.</em>
    </p>
</div>

<div class="premium-blur">

        <div class="row1">
            <h3 class="tooltip1" data-tooltip="Scan barcodes for physical products or QR codes for businesses, apps, and digital services. You can scan up to 3 items for comparison.">
                Scan Items<span class="tooltip1-content"></span>
            </h3>
            
            <div id="mixed-scanner-container"></div>
            
            <div class="manual-input-section" style="margin-top: 20px;">
                <h4 style="font-size: 14px; color: #666; margin-bottom: 8px;">Or enter product name manually:</h4>
                <textarea id="product-name" rows="2" placeholder="Apple iPhone 15 Pro Max 256GB
Tide Liquid Laundry Detergent, Original Scent"></textarea>
            </div>
        </div>

        <div class="row1">
            <h3 class="tooltip1" data-tooltip="Enter the price you see for this product to compare with average market prices.">
                Price You See<span class="tooltip1-content"></span>
            </h3>
            <input id="user-price" type="text" placeholder="$29.99">

            <button class="generate-btn" id="generate-shop-btn">Analyze Items Now!</button>


        </div>




</div>

</div>

<script type="module">


// Form persistence
setupFormPersistence('shop', [
  'product-name', 'user-price'
]);

// Initialize the mixed scanner
let mixedScanner;
document.addEventListener('DOMContentLoaded', function() {
  mixedScanner = initializeMixedScanner('mixed-scanner-container', {
    maxItems: 3,
    scanTypes: 'both',
    simulationDelay: 3000
  });
});

// Generate button handler
async function handleGenerateShopIq() {
  const productName = document.getElementById('product-name').value.trim();
  const userPrice = document.getElementById('user-price').value.trim();
  const scannedItems = mixedScanner ? mixedScanner.getScannedItems() : [];

  // Validate that we have either product name or scanned items
  if (!productName && scannedItems.length === 0) {
    alert('Please either scan items or enter a product name.');
    return;
  }

  // Prepare form data
  const formData = {
    'product-name': productName,
    'scanned-items': scannedItems,
    'user-price': userPrice
  };

  // Use the payment form handler
  if (window.handlePayment) {
    try {
      await window.handlePayment(
        'shop',
        'generate-shop-btn',
        'ai/shop/shopoutput.html',
        formData,
        {
          apiUrl: 'https://inexasli.com/api/generate',
          module: 'shop'
        }
      );
    } catch (error) {
      console.error('Shop analysis error:', error);
      alert('An error occurred while analyzing the items. Please try again.');
    }
  } else {
    console.error('Payment handler not available');
    alert('Payment system not loaded. Please refresh the page and try again.');
  }
}

// Set up event listener
document.addEventListener('DOMContentLoaded', function() {
  const generateShopBtn = document.getElementById('generate-shop-btn');
  if (generateShopBtn && !generateShopBtn.dataset.handlerAttached) {
    generateShopBtn.addEventListener('click', handleGenerateShopIq);
    generateShopBtn.dataset.handlerAttached = 'true';
  }
});
</script>

<style>
.input-method-toggle {
  margin-bottom: 15px;
}

.toggle-buttons {
  display: flex;
  gap: 10px;
  margin-bottom: 15px;
}

.toggle-btn {
  flex: 1;
  padding: 12px 20px;
  border: 2px solid #e0e0e0;
  background: #f8f8f8;
  border-radius: 8px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-size: 14px;
  font-weight: 500;
}

.toggle-btn:hover {
  border-color: #007bff;
  background: #f0f8ff;
}

.toggle-btn.active {
  border-color: #007bff;
  background: #007bff;
  color: white;
}

.input-section {
  display: none;
}

.input-section.active {
  display: block;
}

.barcode-scanner {
  text-align: center;
}

.camera-btn {
  padding: 15px 30px;
  background: #28a745;
  color: white;
  border: none;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  margin-bottom: 15px;
  transition: background 0.3s ease;
}

.camera-btn:hover {
  background: #218838;
}

#scan-result {
  margin-top: 15px;
  padding: 10px;
  background: #d4edda;
  border: 1px solid #c3e6cb;
  border-radius: 4px;
  color: #155724;
}
</style>

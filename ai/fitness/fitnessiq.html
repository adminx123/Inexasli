<!--
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
-->

<div class="device-container">
   

        <div class="row1">
            <label class="category-label">Fitness Goal</label>
            <div class="grid-container" id="fitness-goal">
                <div class="grid-item" data-value="Build Strength">Build Strength</div>
                <div class="grid-item" data-value="Cardio">Cardio</div>
                <div class="grid-item" data-value="Endurance">Endurance</div>
            </div>
        </div>
        <div class="row1">
            <label class="category-label">Workout Schedule</label>
            <input type="number" id="fitness-frequency" placeholder="4" >
            <input type="number" id="fitness-duration" placeholder="45" >
        </div>
        <div class="row1">
            <label class="category-label">Personal Details</label>
            <input type="number" id="fitness-age" placeholder="Age" min="0">
                <input id="fitness-height" type="text" placeholder="5'10">
    <input id="fitness-weight" type="text" placeholder="180lb">

       
        </div>
        <div class="row1">
            <label class="category-label">Experience Level</label>
            <div class="grid-container" id="fitness-level">
                <div class="grid-item" data-value="Beginner">Beginner</div>
                <div class="grid-item" data-value="Intermediate">Intermediate</div>
                <div class="grid-item" data-value="Advanced">Advanced</div>
            </div>
        </div>
        <div class="row1">
            <label class="category-label">Workout Location</label>
            <div class="grid-container" id="fitness-home-exercises">
                <div class="grid-item" data-value="Gym">I want to workout in the gym</div>
                <div class="grid-item" data-value="Home">I want to workout at home</div>
            </div>
        </div>
        <div class="row1">
            <label class="category-label">Health Considerations</label>
            <textarea id="fitness-injuries" rows="3" placeholder="Knee pain
Asthma
Lower back strain"></textarea>
      
        <button class="generate-btn" id="generate-fitness-btn">Generate Fitness Plan Now!</button>

<script>
/*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distribution, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
*/

(function() {
    console.log("FitnessIQ script initializing");

    // Initialize FormPersistence for fitnessiq module
    const fields = [
        { id: 'fitness-goal', type: 'grid' },
        { id: 'fitness-frequency', type: 'input' },
        { id: 'fitness-duration', type: 'input' },
        { id: 'fitness-age', type: 'input' },
        { id: 'fitness-height', type: 'input' },
        { id: 'fitness-weight', type: 'input' },
        { id: 'fitness-level', type: 'grid' },
        { id: 'fitness-home-exercises', type: 'grid' },
        { id: 'fitness-injuries', type: 'textarea' }
    ];

    // FormPersistence will be initialized by datain.js as window.fitnessFormPersistence
    // No need to create a new instance here

    // Listen for grid-item-toggled event from datain.js
    function handleGridItemToggled(event) {
        console.log('[FitnessIQ] Grid item toggled event received');
        // UI behavior only - persistence handled centrally
    }

    // Handle the generate button click
    async function handleGenerateFitnessIq() {
        console.log('[FitnessIQ] Generate button clicked.');
        
        const result = await window.enhancedLoading(
            'generate-fitness-btn',
            'fitness',
            async () => {
                const formData = window.fitnessFormPersistence.getSavedFormData();
                if (!formData) {
                    console.error('[FitnessIQ] No input data found in localStorage.');
                    throw new Error('Please complete the form before generating a fitness plan.');
                }
                
                // Send data to worker
                const apiUrl = 'https://fitness.4hm7q4q75z.workers.dev/';
                
                console.log('[FitnessIQ] Sending fitnessIqInput to worker');
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                
                const responseData = await response.json();
                console.log('[FitnessIQ] Worker response:', responseData);
                
                if (responseData.message !== 'Success') {
                    throw new Error(`An error occurred: ${responseData.message || responseData.error || ''}`);
                }
                
                // Store the response
                window.fitnessFormPersistence.saveResponseData(responseData);
                
                // Dispatch an event to notify dataout.js that a response was received
                const event = new CustomEvent('api-response-received', {
                    detail: {
                        module: 'fitnessiq',
                        type: 'worker-response',
                        timestamp: Date.now()
                    }
                });
                document.dispatchEvent(event);
                console.log('[FitnessIQ] Dispatched api-response-received event');
                
                return responseData;
            }
        );
        
        // Enhanced loading either returns result or throws error - no need to check result.success
        console.log('[FitnessIQ] Fitness plan generated successfully');
    }

    // Initialization
    document.addEventListener('grid-item-toggled', handleGridItemToggled);
    document.getElementById('generate-fitness-btn').addEventListener('click', handleGenerateFitnessIq);

    // Guided forms integration
    if (typeof GuidedForms !== 'undefined' && GuidedForms.fitnessiq) {
        new GuidedForms.fitnessiq();
    }
})();
</script>
</div> <!-- Close mobile-container -->

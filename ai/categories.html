<!-- /*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distr        <div class="grid-item" data-category="lifestyle" data-value="/ai/period/periodiq.html">PeriodIQ™ <span class="premium-tag">$</span></div>
        <div class="grid-item" data-category="lifestyle" data-value="/ai/fashion/fashioniq.html">FashionIQ™ <span class="premium-tag">$</span></div>tion, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
 */ -->

<style>
/* Make premium-tag match datain.js payment button styling */
.premium-tag {
    font-size: 14px !important;
    font-weight: bold !important;
    float: right !important;
    margin-left: auto !important;
}



/* Category selection items (2 columns) */
/* .category-selector now inherits .grid-item styles for unified look */

/* Product icon styling */
.product-icon {
    font-size: 24px;
    color: #4a90e2;
    margin-right: 12px;
    margin-left: 8px;
}

/* Product description left alignment */
.product-description {
    text-align: left;
    flex: 1;
}


/* Removed legacy responsive CSS for old grid classes. Use grid-items1/grid-items2 for layout and responsiveness. */

.favorite-icon {
    position: absolute;
    top: 8px;
    right: 8px;
    font-size: 20px;
    cursor: pointer;
    color: #ccc;
}

.favorite-icon.favorited {
    color: gold;
}

/* Add space for the favorite icon on product items */


/* Mobile-specific adjustments for favorite star and premium tag spacing */
@media (max-width: 480px) {

    
    .favorite-icon {
        top: 4px;
        right: 6px;
        font-size: 18px;
        /* Expand touch area on mobile */
        padding: 8px;
        margin: -8px;
        min-width: 34px;
        min-height: 34px;
        display: flex;
        align-items: center;
        justify-content: center;
    }
    
    .premium-tag {
        margin-right: 25px;
    }
}

@media (max-width: 375px) {

    
    .premium-tag {
        margin-right: 28px;
    }
    
    .favorite-icon {
        top: 3px;
        right: 6px;
        /* Ensure expanded touch area on smaller screens */
        padding: 10px;
        margin: -10px;
        min-width: 38px;
        min-height: 38px;
    }
}


#favorites-container h3 {
    text-align: center;
    margin-bottom: 10px;
    font-size: 1.2em;
    color: #333;
}

/* Favorites grid custom layout */
#favorites-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
    justify-content: flex-start;
    align-items: center;
    padding: 8px;
    margin-bottom: 16px;
}
</style>

<div class="device-container">
    

<div class="row1" data-step-label="Select Category">



    <div id="favorites-grid"></div>


<div class="grid-items2" id="category-selection">
    <div class="grid-item category-selector" data-value="all" style="font-weight: bold;">ALL PRODUCTS</div>
    <div class="grid-item category-selector" data-value="health">HEALTH</div>
    <div class="grid-item category-selector" data-value="business">BUSINESS</div>
    <div class="grid-item category-selector" data-value="finance">FINANCE</div>
    <div class="grid-item category-selector" data-value="lifestyle">LIFESTYLE</div>
    <div class="grid-item category-selector" data-value="learning">LEARNING</div>
    <div class="grid-item category-selector" data-value="productivity">PRODUCTIVITY</div>
</div>
</div>


<div class="row1" data-step-label="Products">
    <div class="grid-items1">
        <!-- Health Products -->
        <div class="grid-item" data-category="health" data-value="/ai/calorie/calorieiq.html">
            <i class="bx bx-calculator product-icon"></i>
            <span class="product-description">Personal nutrition educational tool</span>
        </div>

        <div class="grid-item" data-category="health" data-value="/ai/period/periodiq.html">
            <i class="bx bx-calendar-heart product-icon"></i>
            <span class="product-description">Menstrual health educational tool</span>
        </div>
        
        <!-- Business Products -->
        <div class="grid-item" data-category="business,productivity" data-value="/ai/decision/decisioniq.html">
            <i class="bx bx-brain product-icon"></i>
            <span class="product-description">Decision-making informational tool</span>
        </div>

        <div class="grid-item" data-category="business,lifestyle" data-value="/ai/shop/shopiq.html">
            <i class="bx bx-search-alt product-icon"></i>
            <span class="product-description">Product research informational tool</span>
        </div>
        
        <!-- Finance Products -->
        <div class="grid-item" data-category="finance" data-value="/ai/income/incomeiq.html">
            <i class="bx bx-dollar-circle product-icon"></i>
            <span class="product-description">Personal finance informational tool</span>
        </div>
        
        <!-- Lifestyle Products -->
        <div class="grid-item" data-category="lifestyle" data-value="/ai/event/eventiq.html">
            <i class="bx bx-calendar-event product-icon"></i>
            <span class="product-description">Event planning informational tool</span>
        </div>
        <div class="grid-item" data-category="lifestyle" data-value="/ai/fashion/fashioniq.html">
            <i class="bx bx-closet product-icon"></i>
            <span class="product-description">Style informational tool</span>
        </div>
        <div class="grid-item" data-category="lifestyle,learning" data-value="/ai/philosophy/philosophyiq.html">
            <i class="bx bx-book-open product-icon"></i>
            <span class="product-description">Philosophy exploration tool</span>
        </div>
        <div class="grid-item" data-category="lifestyle" data-value="/ai/enneagram/enneagramiq.html">
            <i class="bx bx-user-circle product-icon"></i>
            <span class="product-description">Personality educational tool</span>
        </div>
        
        <!-- Learning Products -->
        <div class="grid-item" data-category="learning" data-value="/ai/quiz/quiziq.html">
            <i class="bx bx-question-mark product-icon"></i>
            <span class="product-description">Learning quiz tool</span>
        </div>
    </div>
</div>
</div>


<script type="module">
// Execute immediately instead of waiting for DOMContentLoaded since this is dynamically loaded
// Utility functions are now available via window from datain.js
// No direct imports needed

console.log('[Categories] Script executing immediately');

const favoritesGrid = document.getElementById('favorites-grid');
const productsGrid = document.querySelector('.row1[data-step-label="Products"] .grid-items1');
const deviceContainer = document.querySelector('.device-container');

function getFavorites() {
    // Use the imported function directly
    return window.getJSON('favoriteProducts', []);
}

function saveFavorites(favorites) {
    // Use the imported function directly
    window.setJSON('favoriteProducts', favorites);
}

function renderFavorites() {
    const favorites = getFavorites();
    favoritesGrid.innerHTML = '';
    if (favorites.length === 0) {
        return;
    }

    const allProducts = Array.from(productsGrid.children);
    favorites.forEach(url => {
        const product = allProducts.find(p => p.dataset.value === url);
        if (product) {
            // Get the icon from the original product
            const originalIcon = product.querySelector('.product-icon');
            if (originalIcon) {
                // Create a new icon element (not wrapped in grid-item)
                const iconClone = originalIcon.cloneNode(true);
                iconClone.style.cursor = 'pointer';
                iconClone.style.margin = '4px';
                iconClone.style.fontSize = '24px';
                iconClone.dataset.value = url; // Store the URL for clicking
                iconClone.classList.add('favorite-clickable-icon');
                favoritesGrid.appendChild(iconClone);
            }
        }
    });
}

function toggleFavorite(url) {
    let favorites = getFavorites();
    const index = favorites.indexOf(url);
    if (index > -1) {
        favorites.splice(index, 1);
    } else {
        favorites.push(url);
    }
    saveFavorites(favorites);
    renderFavorites();
    updateFavoriteIcons();
}

function updateFavoriteIcons() {
    const favorites = getFavorites();
    // This will update icons in both the main grid and the favorites grid
    document.querySelectorAll('.grid-item[data-value]').forEach(item => {
        const icon = item.querySelector('.favorite-icon');
        if (icon) {
            if (favorites.includes(item.dataset.value)) {
                icon.classList.add('favorited');
            } else {
                icon.classList.remove('favorited');
            }
        }
    });
}

function addFavoriteIcons() {
    document.querySelectorAll('.grid-item[data-category]').forEach(product => {
        if (product.querySelector('.favorite-icon')) return; // Don't add twice
        const icon = document.createElement('span');
        icon.className = 'favorite-icon';
        icon.innerHTML = '★';
        // Listener is handled by event delegation on the container
        product.appendChild(icon);
    });
}

// Function to filter products using DIRECT INLINE STYLES (bypasses all CSS)
function filterProducts(selectedCategory) {
    const products = document.querySelectorAll('.grid-item[data-category]');
    console.log('[Categories] filterProducts called with:', selectedCategory, 'Found products:', products.length);
    
    products.forEach(product => {
        const categories = product.getAttribute('data-category').split(',');
        
        if (selectedCategory === 'all' || categories.includes(selectedCategory)) {
            product.style.display = 'flex';
        } else {
            product.style.display = 'none';
        }
    });
    
    localStorage.setItem('categoriesPageSelection', selectedCategory);
    console.log('[Categories] Category filtered:', selectedCategory);
}

// Wait a bit for DOM to be ready, then initialize
setTimeout(function() {
    addFavoriteIcons();
    renderFavorites();
    updateFavoriteIcons();
    
    const categoryContainer = document.getElementById('category-selection');
    if (categoryContainer) {
        categoryContainer.addEventListener('click', function(e) {
            if (e.target.classList.contains('category-selector')) {
                const selectedCategory = e.target.getAttribute('data-value');
                e.stopPropagation();
                
                document.querySelectorAll('#category-selection .category-selector').forEach(item => {
                    item.classList.remove('active');
                });
                e.target.classList.add('active');
                
                filterProducts(selectedCategory);
                
                if (window.guidedForms && typeof window.guidedForms.showStep === 'function') {
                    window.guidedForms.showStep(1);
                }
            }
        });
        
        console.log('[Categories] Initializing - hiding all products first');
        document.querySelectorAll('.grid-item[data-category]').forEach(product => {
            product.style.display = 'none';
        });
    
        setTimeout(() => {
            filterProducts('all');
            const allCategoriesItem = document.querySelector('#category-selection .category-selector[data-value="all"]');
            if (allCategoriesItem) {
                allCategoriesItem.classList.add('active');
            }
        }, 100);
    }
}, 100);

// Consolidated event listener for both product selection and favorite toggling
if (deviceContainer) {
    deviceContainer.addEventListener('click', function(e) {
        // Handle favorite clickable icons (not in grid items)
        if (e.target.classList.contains('favorite-clickable-icon')) {
            e.stopPropagation();
            const url = e.target.dataset.value;
            if (url) {
                // Set lastGridItemUrl so datain.js can remember the selection
                localStorage.setItem('lastGridItemUrl', url);

                // Check if we are inside the datain.js container
                const datainContainer = e.target.closest('#data-in-container');
                const eventDetail = { detail: { url: url } };
                if (datainContainer) {
                    console.log('[Categories] Dispatching event for datain.js from favorite icon');
                    const gridItemEvent = new CustomEvent('promptGridItemSelected', eventDetail);
                    datainContainer.dispatchEvent(gridItemEvent);
                } else {
                    console.log('[Categories] Dispatching event globally from favorite icon');
                    const gridItemEvent = new CustomEvent('promptGridItemSelected', eventDetail);
                    document.dispatchEvent(gridItemEvent);
                }
            }
            return;
        }

        const gridItem = e.target.closest('.grid-item');
        if (!gridItem || !gridItem.dataset.value) return;

        // Handle favorite icon clicks
        if (e.target.classList.contains('favorite-icon')) {
            e.stopPropagation(); // Prevent product selection from firing
            toggleFavorite(gridItem.dataset.value);
            return;
        }

        // Handle product selection clicks (if it's a product URL)
        if (gridItem.dataset.value.startsWith('/ai/')) {
            e.stopPropagation(); // Stop the event from bubbling up to datain.js modal handlers
            // Set lastGridItemUrl so datain.js can remember the selection
            localStorage.setItem('lastGridItemUrl', gridItem.dataset.value);

            // NEW: Check if we are inside the datain.js container
            const datainContainer = gridItem.closest('#data-in-container');
            const eventDetail = { detail: { url: gridItem.dataset.value } };
            if (datainContainer) {
                // If inside datain, dispatch the event directly on the container
                // so only datain.js handles it.
                console.log('[Categories] Dispatching event for datain.js and stopping propagation.');
                const gridItemEvent = new CustomEvent('promptGridItemSelected', eventDetail);
                datainContainer.dispatchEvent(gridItemEvent);
            } else {
                // Otherwise, dispatch globally as before (for when categories is the main page)
                console.log('[Categories] Dispatching event globally');
                const gridItemEvent = new CustomEvent('promptGridItemSelected', eventDetail);
                document.dispatchEvent(gridItemEvent);
            }
        }
    });
}
</script>

<script>
// Only enable autoAdvance for categories.html
  // Wait for guidedForms to be loaded by datain.js
  function initGuidedFormsForCategories() {
    if (window.GuidedFormSystem) {
      const guidedForms = new GuidedFormSystem({
        autoAdvance: true,
        showProgressIndicator: true,
        smoothTransitions: true
      });
      guidedForms.init('device-container');
    } else {
      // Retry after a short delay if not loaded yet
      setTimeout(initGuidedFormsForCategories, 100);
    }
  }
  
  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initGuidedFormsForCategories);
  } else {
    initGuidedFormsForCategories();
  }
</script>
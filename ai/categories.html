<!-- /*
 * Copyright (c) 2025 INEXASLI. All rights reserved.
 * This code is protected under Canadian and international copyright laws.
 * Unauthorized use, reproduction, distr        <div class="grid-item" data-category="lifestyle" data-value="/ai/period/periodiq.html">PeriodIQ™ <span class="premium-tag">$</span></div>
        <div class="grid-item" data-category="lifestyle" data-value="/ai/fashion/fashioniq.html">FashionIQ™ <span class="premium-tag">$</span></div>tion, or modification of this code 
 * without explicit written permission via email from info@inexasli.com 
 * is strictly prohibited. Violators will be pursued and prosecuted to the 
 * fullest extent of the law in British Columbia, Canada, and applicable 
 * jurisdictions worldwide.
 */ -->

<style>
/* Make premium-tag match datain.js payment button styling */
.premium-tag {
    font-size: 14px !important;
    font-weight: bold !important;
    float: right !important;
    margin-left: auto !important;
}

/* Removed orphaned .category-item styles; .grid-item is now used for all product/favourite cards */

/* Category selection items (2 columns) */
/* .category-selector now inherits .grid-item styles for unified look */

/* Grid containers */
.category-grid {
    display: grid;
    gap: 8px;
    width: 100%;
    max-width: 460px;
    margin: 0 auto;
}

/* Category selection grid - 2 columns */
.category-selection-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 10px;
    width: 100%;
    max-width: 460px;
    margin: 0 auto;
}

/* Products grid - 1 column */
.products-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 8px;
    width: 100%;
    max-width: 460px;
    margin: 0 auto;
}

/* Favorites grid - 1 column */
.favorites-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 8px;
    width: 100%;
    max-width: 460px;
    margin: 0 auto;
}

/* Mobile responsive */
@media (max-width: 480px) {
    .category-grid, .products-grid, .favorites-grid {
        gap: 6px;
        max-width: 360px;
    }
    
    .category-selection-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
        max-width: 360px;
    }
    
    .category-item, .category-selector {
        min-height: 40px;
        padding: 8px 12px;
        font-size: 14px;
    }
}

@media (max-width: 375px) {
    .category-grid, .products-grid, .favorites-grid {
        gap: 5px;
        max-width: 340px;
    }
    
    .category-selection-grid {
        gap: 6px;
        max-width: 340px;
    }
}

@media (max-width: 320px) {
    .category-grid, .products-grid, .favorites-grid {
        max-width: 280px;
    }
    
    .category-selection-grid {
        gap: 5px;
        max-width: 280px;
    }
}

.favorite-icon {
    position: absolute;
    top: 8px;
    right: 8px;
    font-size: 20px;
    cursor: pointer;
    color: #ccc;
}

.favorite-icon.favorited {
    color: gold;
}

/* Add space for the favorite icon on product items */
.category-item[data-category] {
    padding-right: 35px;
}

/* Mobile-specific adjustments for favorite star and premium tag spacing */
@media (max-width: 480px) {
    .category-item[data-category] {
        padding-right: 40px;
    }
    
    .favorites-grid .category-item[data-category] {
        padding-right: 40px;
    }
    
    .favorite-icon {
        top: 4px;
        right: 6px;
        font-size: 18px;
    }
    
    .premium-tag {
        margin-right: 25px;
    }
}

@media (max-width: 375px) {
    .category-item[data-category] {
        padding-right: 42px;
    }
    
    .favorites-grid .category-item[data-category] {
        padding-right: 42px;
    }
    
    .premium-tag {
        margin-right: 28px;
    }
    
    .favorite-icon {
        top: 3px;
        right: 6px;
    }
}


#favorites-container h3 {
    text-align: center;
    margin-bottom: 10px;
    font-size: 1.2em;
    color: #333;
}
</style>

<div class="device-container">
    

<div class="row1" data-step-label="Select Category">


<div id="favorites-container">
    <div class="grid-items2" id="favorites-grid"></div>
</div>

<div class="category-selection-grid" id="category-selection">
    <div class="grid-item category-selector" data-value="all" style="font-weight: bold;">ALL PRODUCTS</div>
    <div class="grid-item category-selector" data-value="health">HEALTH</div>
    <div class="grid-item category-selector" data-value="business">BUSINESS</div>
    <div class="grid-item category-selector" data-value="finance">FINANCE</div>
    <div class="grid-item category-selector" data-value="lifestyle">LIFESTYLE</div>
    <div class="grid-item category-selector" data-value="learning">LEARNING</div>
    <div class="grid-item category-selector" data-value="productivity">PRODUCTIVITY</div>
</div>
</div>


<div class="row1" data-step-label="Products">
    <div class="grid-items1">
        <!-- Health Products -->
        <div class="grid-item" data-category="health" data-value="/ai/calorie/calorieiq.html">
            <span class="product-name">CalorieIQ™</span>
            <span class="product-description">Track calories & nutrition</span>
        </div>

        <div class="grid-item" data-category="health" data-value="/ai/period/periodiq.html">
            <span class="product-name">PeriodIQ™</span>
            <span class="product-description">Period tracking & insights</span>
        </div>
        
        <!-- Business Products -->
        <div class="grid-item" data-category="business,productivity" data-value="/ai/decision/decisioniq.html">
            <span class="product-name">DecisionIQ™</span>
            <span class="product-description">Smart decision making</span>
        </div>

        <div class="grid-item" data-category="business,lifestyle" data-value="/ai/shop/shopiq.html">
            <span class="product-name">ShopIQ™</span>
            <span class="product-description">Smart shopping decisions</span>
        </div>
        
        <!-- Finance Products -->
        <div class="grid-item" data-category="finance" data-value="/ai/income/incomeiq.html">
            <span class="product-name">IncomeIQ™</span>
            <span class="product-description">Income optimization</span>
        </div>
        
        <!-- Lifestyle Products -->
        <div class="grid-item" data-category="lifestyle" data-value="/ai/event/eventiq.html">
            <span class="product-name">EventIQ™</span>
            <span class="product-description">Event planning assistant</span>
        </div>
        <div class="grid-item" data-category="lifestyle" data-value="/ai/fashion/fashioniq.html">
            <span class="product-name">FashionIQ™</span>
            <span class="product-description">Style & outfit advisor</span>
        </div>
        <div class="grid-item" data-category="lifestyle,learning" data-value="/ai/philosophy/philosophyiq.html">
            <span class="product-name">PhilosophyIQ™</span>
            <span class="product-description">Explore philosophical ideas</span>
        </div>
        <div class="grid-item" data-category="lifestyle" data-value="/ai/enneagram/enneagramiq.html">
            <span class="product-name">EnneagramIQ™</span>
            <span class="product-description">Personality insights</span>
        </div>
        
        <!-- Learning Products -->
        <div class="grid-item" data-category="learning" data-value="/ai/quiz/quiziq.html">
            <span class="product-name">QuizIQ™</span>
            <span class="product-description">Interactive learning quizzes</span>
        </div>
    </div>
</div>
</div>


<script type="module">
// Execute immediately instead of waiting for DOMContentLoaded since this is dynamically loaded
// Utility functions are now available via window from datain.js
// No direct imports needed

console.log('[Categories] Script executing immediately');

const favoritesGrid = document.getElementById('favorites-grid');
const productsGrid = document.querySelector('.row1[data-step-label="Products"] .grid-items1');
const deviceContainer = document.querySelector('.device-container');

function getFavorites() {
    // Use the imported function directly
    return window.getJSON('favoriteProducts', []);
}

function saveFavorites(favorites) {
    // Use the imported function directly
    window.setJSON('favoriteProducts', favorites);
}

function renderFavorites() {
    const favorites = getFavorites();
    favoritesGrid.innerHTML = '';
    if (favorites.length === 0) {
        return;
    }

    const allProducts = Array.from(productsGrid.children);
    favorites.forEach(url => {
        const product = allProducts.find(p => p.dataset.value === url);
        if (product) {
            const clone = product.cloneNode(true);
            // Remove description from favorites - only keep name and premium tag
            const description = clone.querySelector('.product-description');
            if (description) {
                description.remove();
            }
            // Ensure the favourite uses only grid-item for style
            clone.classList.remove('grid-item2');
            clone.classList.add('grid-item');
            favoritesGrid.appendChild(clone);
        }
    });
}

function toggleFavorite(url) {
    let favorites = getFavorites();
    const index = favorites.indexOf(url);
    if (index > -1) {
        favorites.splice(index, 1);
    } else {
        favorites.push(url);
    }
    saveFavorites(favorites);
    renderFavorites();
    updateFavoriteIcons();
}

function updateFavoriteIcons() {
    const favorites = getFavorites();
    // This will update icons in both the main grid and the favorites grid
    document.querySelectorAll('.grid-item[data-value]').forEach(item => {
        const icon = item.querySelector('.favorite-icon');
        if (icon) {
            if (favorites.includes(item.dataset.value)) {
                icon.classList.add('favorited');
            } else {
                icon.classList.remove('favorited');
            }
        }
    });
}

function addFavoriteIcons() {
    document.querySelectorAll('.grid-item[data-category]').forEach(product => {
        if (product.querySelector('.favorite-icon')) return; // Don't add twice
        const icon = document.createElement('span');
        icon.className = 'favorite-icon';
        icon.innerHTML = '★';
        // Listener is handled by event delegation on the container
        product.appendChild(icon);
    });
}

// Function to filter products using DIRECT INLINE STYLES (bypasses all CSS)
function filterProducts(selectedCategory) {
    const products = document.querySelectorAll('.grid-item[data-category]');
    console.log('[Categories] filterProducts called with:', selectedCategory, 'Found products:', products.length);
    
    products.forEach(product => {
        const categories = product.getAttribute('data-category').split(',');
        
        if (selectedCategory === 'all' || categories.includes(selectedCategory)) {
            product.style.display = 'flex';
        } else {
            product.style.display = 'none';
        }
    });
    
    localStorage.setItem('categoriesPageSelection', selectedCategory);
    console.log('[Categories] Category filtered:', selectedCategory);
}

// Wait a bit for DOM to be ready, then initialize
setTimeout(function() {
    addFavoriteIcons();
    renderFavorites();
    updateFavoriteIcons();
    
    const categoryContainer = document.getElementById('category-selection');
    if (categoryContainer) {
        categoryContainer.addEventListener('click', function(e) {
            if (e.target.classList.contains('category-selector')) {
                const selectedCategory = e.target.getAttribute('data-value');
                e.stopPropagation();
                
                document.querySelectorAll('#category-selection .category-selector').forEach(item => {
                    item.classList.remove('active');
                });
                e.target.classList.add('active');
                
                filterProducts(selectedCategory);
                
                if (window.guidedForms && typeof window.guidedForms.showStep === 'function') {
                    window.guidedForms.showStep(1);
                }
            }
        });
        
        console.log('[Categories] Initializing - hiding all products first');
        document.querySelectorAll('.grid-item[data-category]').forEach(product => {
            product.style.display = 'none';
        });
    
        setTimeout(() => {
            filterProducts('all');
            const allCategoriesItem = document.querySelector('#category-selection .category-selector[data-value="all"]');
            if (allCategoriesItem) {
                allCategoriesItem.classList.add('active');
            }
        }, 100);
    }
}, 100);

// Consolidated event listener for both product selection and favorite toggling
if (deviceContainer) {
    deviceContainer.addEventListener('click', function(e) {
        const gridItem = e.target.closest('.grid-item');
        if (!gridItem || !gridItem.dataset.value) return;

        // Handle favorite icon clicks
        if (e.target.classList.contains('favorite-icon')) {
            e.stopPropagation(); // Prevent product selection from firing
            toggleFavorite(gridItem.dataset.value);
            return;
        }

        // Handle product selection clicks (if it's a product URL)
        if (gridItem.dataset.value.startsWith('/ai/')) {
            e.stopPropagation(); // Stop the event from bubbling up to datain.js modal handlers
            // Set lastGridItemUrl so datain.js can remember the selection
            localStorage.setItem('lastGridItemUrl', gridItem.dataset.value);

            // NEW: Check if we are inside the datain.js container
            const datainContainer = gridItem.closest('#data-in-container');
            const eventDetail = { detail: { url: gridItem.dataset.value } };
            if (datainContainer) {
                // If inside datain, dispatch the event directly on the container
                // so only datain.js handles it.
                console.log('[Categories] Dispatching event for datain.js and stopping propagation.');
                const gridItemEvent = new CustomEvent('promptGridItemSelected', eventDetail);
                datainContainer.dispatchEvent(gridItemEvent);
            } else {
                // Otherwise, dispatch globally as before (for when categories is the main page)
                console.log('[Categories] Dispatching event globally');
                const gridItemEvent = new CustomEvent('promptGridItemSelected', eventDetail);
                document.dispatchEvent(gridItemEvent);
            }
        }
    });
}
</script>

<script>
// Only enable autoAdvance for categories.html
  // Wait for guidedForms to be loaded by datain.js
  function initGuidedFormsForCategories() {
    if (window.GuidedFormSystem) {
      const guidedForms = new GuidedFormSystem({
        autoAdvance: true,
        showProgressIndicator: true,
        smoothTransitions: true
      });
      guidedForms.init('device-container');
    } else {
      // Retry after a short delay if not loaded yet
      setTimeout(initGuidedFormsForCategories, 100);
    }
  }
  
  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initGuidedFormsForCategories);
  } else {
    initGuidedFormsForCategories();
  }
</script>
# NOTE: For multi-worker projects, deploy each worker individually using:
#   npx wrangler deploy --env <worker>
# Example for the 'event' worker:
#   npx wrangler deploy --env event
#
# This ensures the correct script, bindings, and environment are used for each worker.
# Always run these commands from the main project directory (where this wrangler.toml is located).
#
# To deploy the master worker, use:
#   npx wrangler deploy --env master
#
# To deploy all main module workers with FACT_STORE KV binding, run:
#   npx wrangler deploy --env event
#   npx wrangler deploy --env enneagram
#   npx wrangler deploy --env fashion
#   npx wrangler deploy --env income
#   npx wrangler deploy --env quiz
#   npx wrangler deploy --env philosophy
#
# (Repeat for any other worker as needed.)

account_id = "b70c309587ed8ba2bfa06320792ea457"
workers_dev = true
compatibility_date = "2025-05-11"

# Global build configuration that applies to all workers
[build]
command = ""
watch_dir = "build/worker"

# --- Worker Environments ---

# --- Rate Limiter Worker (CRITICAL - Deploy First) ---
[env.rate-limiter]
name = "rate-limiter"
main = "./ai/rate-limiter/rateLimit.js"

# KV namespace for rate limiting data storage
[[env.rate-limiter.kv_namespaces]]
binding = "RATE_LIMIT_KV"
id = "2da5e6f46847458a9aa83ffe54dea66e"
preview_id = "2da5e6f46847458a9aa83ffe54dea66e"

[env.master]
name = "master"
main = "./ai/master.js"

[[env.master.kv_namespaces]]
binding = "FACT_STORE"
id = "285495ae3e0f468a86f47bdd056ecfc3"
preview_id = "02f5fab88e5143a5aa52c315fde404d1"

[[env.master.services]]
binding = "secret_binding"
service = "secretworker"

[[env.master.services]]
binding = "rate_limiter_binding"
service = "rate-limiter"

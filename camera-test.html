<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Camera Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            max-width: 600px;
            margin: 0 auto;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
        }
        .test-button {
            display: inline-block;
            padding: 10px 20px;
            margin: 5px;
            background-color: #4a7c59;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            text-decoration: none;
        }
        .test-button:hover {
            background-color: #2d5d3d;
        }
        .file-input {
            margin: 10px 0;
        }
        .debug-info {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <h1>Camera Access Test</h1>
    
    <div class="debug-info" id="deviceInfo">
        Loading device information...
    </div>

    <div class="test-section">
        <h3>Test 1: Basic File Input with Camera Capture</h3>
        <input type="file" accept="image/*" capture="camera" class="file-input" id="test1">
        <div id="result1"></div>
    </div>

    <div class="test-section">
        <h3>Test 2: File Input with Environment Capture</h3>
        <input type="file" accept="image/*" capture="environment" class="file-input" id="test2">
        <div id="result2"></div>
    </div>

    <div class="test-section">
        <h3>Test 3: File Input with User (Front) Camera</h3>
        <input type="file" accept="image/*" capture="user" class="file-input" id="test3">
        <div id="result3"></div>
    </div>

    <div class="test-section">
        <h3>Test 4: Label-Wrapped File Input (Like ImageUpload)</h3>
        <label class="test-button">
            Take Photo
            <input type="file" accept="image/*" capture="camera" style="display: none;" id="test4">
        </label>
        <div id="result4"></div>
    </div>

    <div class="test-section">
        <h3>Test 5: Multiple File Input</h3>
        <input type="file" accept="image/*" multiple class="file-input" id="test5">
        <div id="result5"></div>
    </div>

    <div class="test-section">
        <h3>Test 6: Manual getUserMedia (Camera Stream)</h3>
        <button class="test-button" onclick="testGetUserMedia()">Request Camera Permission</button>
        <video id="video" width="200" height="150" style="display: none;"></video>
        <div id="result6"></div>
    </div>

    <script>
        // Display device information
        function displayDeviceInfo() {
            const info = document.getElementById('deviceInfo');
            const userAgent = navigator.userAgent;
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(userAgent);
            const isIOS = /iPad|iPhone|iPod/.test(userAgent);
            const isAndroid = /Android/i.test(userAgent);
            const isSafari = /Safari/i.test(userAgent) && !/Chrome/i.test(userAgent);
            const isChrome = /Chrome/i.test(userAgent);
            
            info.innerHTML = `
                <strong>Device Information:</strong><br>
                User Agent: ${userAgent}<br>
                Is Mobile: ${isMobile}<br>
                Is iOS: ${isIOS}<br>
                Is Android: ${isAndroid}<br>
                Is Safari: ${isSafari}<br>
                Is Chrome: ${isChrome}<br>
                Protocol: ${window.location.protocol}<br>
                Hostname: ${window.location.hostname}<br>
                Touch Points: ${navigator.maxTouchPoints || 'N/A'}<br>
                Has getUserMedia: ${!!(navigator.mediaDevices && navigator.mediaDevices.getUserMedia)}<br>
                Screen Size: ${window.screen.width}x${window.screen.height}
            `;
        }

        // Set up file input tests
        function setupFileInputTest(inputId, resultId) {
            const input = document.getElementById(inputId);
            const result = document.getElementById(resultId);
            
            input.addEventListener('change', function(e) {
                console.log(`${inputId} changed:`, e.target.files.length, 'files selected');
                
                if (e.target.files.length > 0) {
                    result.innerHTML = `‚úÖ Success! Selected ${e.target.files.length} file(s):<br>`;
                    for (let i = 0; i < e.target.files.length; i++) {
                        const file = e.target.files[i];
                        result.innerHTML += `- ${file.name} (${file.type}, ${file.size} bytes)<br>`;
                    }
                } else {
                    result.innerHTML = '‚ùå No files selected';
                }
            });

            input.addEventListener('click', function(e) {
                console.log(`${inputId} clicked`);
                result.innerHTML = '‚è≥ Input clicked, waiting for selection...';
            });
        }

        // Test getUserMedia
        async function testGetUserMedia() {
            const result = document.getElementById('result6');
            const video = document.getElementById('video');
            
            try {
                result.innerHTML = '‚è≥ Requesting camera permission...';
                
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { 
                        facingMode: 'environment' // Try back camera first
                    } 
                });
                
                video.srcObject = stream;
                video.style.display = 'block';
                video.play();
                
                result.innerHTML = '‚úÖ Camera access granted! Stream active.';
                
                // Stop stream after 5 seconds
                setTimeout(() => {
                    stream.getTracks().forEach(track => track.stop());
                    video.style.display = 'none';
                    result.innerHTML += '<br>üìπ Stream stopped after 5 seconds.';
                }, 5000);
                
            } catch (error) {
                console.error('getUserMedia error:', error);
                result.innerHTML = `‚ùå Camera access failed: ${error.name} - ${error.message}`;
            }
        }

        // Initialize tests
        document.addEventListener('DOMContentLoaded', function() {
            displayDeviceInfo();
            setupFileInputTest('test1', 'result1');
            setupFileInputTest('test2', 'result2');
            setupFileInputTest('test3', 'result3');
            setupFileInputTest('test4', 'result4');
            setupFileInputTest('test5', 'result5');
        });
    </script>
</body>
</html>

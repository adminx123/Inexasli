<!-- Reference: Standardized Module Integration with Master Worker (2025-06-21) -->
<!-- Use this as a checklist/template for updating other modules -->

1. **Frontend Input (e.g., moduleiq.html):**
   - Set the API endpoint to the master worker (e.g. https://master.4hm7q4q75z.workers.dev/)
   - POST payload: `{ module: "<module>", formData: ..., fingerprint: ... }`
   - On response, save the full response object to localStorage as `<module>IqResponse` (e.g., `decisionIqResponse`)

2. **Form Persistence (formPersistence.js):**
   - Ensure `saveResponseData` saves the response under `<module>IqResponse` only (no extra keys)

3. **Master Worker (master.js):**
   - Always return the main module data under a `data` property:
     ```json
     { "message": "Success", "data": { ... }, ... }
     ```
   - Do not use module-specific keys at the top level (e.g., no `decisionResponse`)

4. **Frontend Output (e.g., moduleoutput.html):**
   - Retrieve the response from localStorage using `<module>IqResponse`
   - If the response has a `.data` property, use it for display:
     ```js
     if (data && data.message === 'Success' && data.data) {
       data = data.data;
     }
     ```
   - The enhanced UI should expect the main data fields (e.g., `bmi`, `individualFoods`, etc.) at the root of the object
   - If supporting legacy formats, fallback to previous keys as needed

5. **Module File (e.g., ai/decision/decision.js):**
   - Only export config and prompt generator (no response processor)
   - Set `RESPONSE_KEY` to a unique value (e.g., `decisionResponse`)

---

<!-- Use this as a step-by-step guide for each module you migrate to the new master worker architecture. -->

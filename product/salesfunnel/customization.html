<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customize Automation</title>
    <link rel="stylesheet" href="salesflow.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="icon" href="../../images/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="splash-container" id="splashContainer" style="padding-top: 40px; position: absolute; top: 0; left: 0; width: 100%; z-index: 2;">
        <img src="../../images/favicon.svg" alt="INEXASLI Logo" class="splash-logo" style="margin-top: 20px;">
    </div>

    <div class="device-container" id="mainContent" style="opacity: 0; display: block; z-index: 1;">
        <div class="setup-header">
            <!-- Step Indicator -->
            <div class="step-indicator-placeholder"></div>
            <div class="progress-bar">
                <div class="progress-fill"></div>
            </div>
            <h1 class="page-title">Customize Automation</h1>
            <p class="page-subtitle">Tell us about your brand so we can create perfect content for your business</p>
        </div>

        <div class="package-cards">
        <!-- Main Configuration Section -->
        <div class="package-card collapsed" data-section="main">
            <div class="package-header">
                <h3 class="card-title">Main Configuration</h3>
                <div class="card-status">
                    <span class="status-text">To Do</span>
                </div>
            </div>
            <div class="card-content">
            
            <!-- Business Category Selection (shown for chat products) -->
            <div class="form-group" id="businessCategoryGroup" style="display: none;">
                <label class="form-label">Business Category</label>
                <div class="grid-selection" id="categoryGrid" data-type="single" data-name="businessCategory">
                    <div class="grid-item1" data-value="customer-facing">
                        <div class="grid-item-text">Customer-Facing Operations</div>
                    </div>
                    <div class="grid-item1" data-value="internal-productivity">
                        <div class="grid-item-text">Internal Productivity and Operations</div>
                    </div>
                    <div class="grid-item1" data-value="specialized-services">
                        <div class="grid-item-text">Specialized Services</div>
                    </div>
                    <div class="grid-item1" data-value="creative-entertainment">
                        <div class="grid-item-text">Creative and Entertainment</div>
                    </div>
                    <div class="grid-item1" data-value="industry-specific">
                        <div class="grid-item-text">Industry-Specific</div>
                    </div>
                </div>
                <input type="hidden" name="businessCategory" id="businessCategory" required>
            </div>

            <div class="form-group">
                <label class="form-label" for="timezone">Timezone for Business Purposes</label>
                <select class="form-select" id="timezone" name="timezone" required>
                    <option value="">Select your timezone</option>
                    <option value="America/New_York">Eastern Time (ET)</option>
                    <option value="America/Chicago">Central Time (CT)</option>
                    <option value="America/Denver">Mountain Time (MT)</option>
                    <option value="America/Los_Angeles">Pacific Time (PT)</option>
                    <option value="America/Anchorage">Alaska Time (AKT)</option>
                    <option value="Pacific/Honolulu">Hawaii Time (HT)</option>
                    <option value="Europe/London">London (GMT)</option>
                    <option value="Europe/Paris">Paris (CET)</option>
                    <option value="Europe/Berlin">Berlin (CET)</option>
                    <option value="Asia/Tokyo">Tokyo (JST)</option>
                    <option value="Asia/Shanghai">Shanghai (CST)</option>
                    <option value="Asia/Kolkata">India (IST)</option>
                    <option value="Australia/Sydney">Sydney (AEST)</option>
                    <option value="Pacific/Auckland">Auckland (NZST)</option>
                </select>
            </div>
        </div>
        </div>

        <!-- Social Media Configuration Section -->
        <div class="package-card collapsed" id="socialSection" data-section="social">
            <div class="package-header">
                <h3 class="card-title">Social Media Configuration</h3>
                <div class="card-status">
                    <span class="status-text">To Do</span>
                </div>
            </div>
            <div class="card-content">            <div class="form-group">
                <label class="form-label">Posting Schedule</label>
                <div class="posting-schedule-builder">
                    <div class="schedule-header">
                        <span class="schedule-label">Select preferred posting days:</span>
                    </div>
                    <div class="days-selector">
                        <div class="day-toggle" data-day="monday">
                            <div class="day-label">M</div>
                            <div class="day-full">Monday</div>
                        </div>
                        <div class="day-toggle" data-day="tuesday">
                            <div class="day-label">T</div>
                            <div class="day-full">Tuesday</div>
                        </div>
                        <div class="day-toggle" data-day="wednesday">
                            <div class="day-label">W</div>
                            <div class="day-full">Wednesday</div>
                        </div>
                        <div class="day-toggle" data-day="thursday">
                            <div class="day-label">T</div>
                            <div class="day-full">Thursday</div>
                        </div>
                        <div class="day-toggle" data-day="friday">
                            <div class="day-label">F</div>
                            <div class="day-full">Friday</div>
                        </div>
                        <div class="day-toggle" data-day="saturday">
                            <div class="day-label">S</div>
                            <div class="day-full">Saturday</div>
                        </div>
                        <div class="day-toggle" data-day="sunday">
                            <div class="day-label">S</div>
                            <div class="day-full">Sunday</div>
                        </div>
                    </div>
                </div>
                <input type="hidden" name="postingSchedule" id="postingSchedule" required>
            </div>

                        <div class="form-group">
                <label class="form-label" for="scheduleDetails">Schedule Details & Preferences</label>
                <textarea class="form-textarea" id="scheduleDetails" name="scheduleDetails"
                    placeholder="Describe your posting preferences (e.g., preferred times, posting frequency, any other scheduling requirements or preferences we should discuss)" required></textarea>
            </div>

            <div class="form-group">
                <label class="form-label" for="contentFocus">Content Focus</label>
                <textarea class="form-textarea" id="contentFocus" name="contentFocus"
                    placeholder="What topics or themes should the posts focus on? (e.g., industry insights, customer success stories, educational content)" required></textarea>
            </div>

            <div class="form-group">
                <label class="form-label" for="targetAudience">Target Audience</label>
                <textarea class="form-textarea" id="targetAudience" name="targetAudience"
                    placeholder="Describe your target audience (e.g., age range, interests, pain points, what they care about)" required></textarea>
            </div>
        </div>
        </div>

        <!-- Conversational AI Configuration Section (Chat & Reply) -->
            <div class="package-card collapsed" id="conversationalSection" data-section="conversational" style="display: none;">
                <div class="package-header">
                    <h3 class="card-title">Conversational AI Configuration</h3>
                    <div class="card-status">
                        <span class="status-text">To Do</span>
                    </div>
                </div>
                <div class="card-content">

                <div class="form-group">
                    <label class="form-label" for="industry">Business Industry</label>
                    <select class="form-select" id="industry" name="industry" required>
                        <option value="">Select your industry</option>
                        <option value="restaurant">Restaurant/Food Service</option>
                        <option value="fitness">Fitness/Health</option>
                        <option value="retail">Retail/E-commerce</option>
                        <option value="beauty">Beauty/Wellness</option>
                        <option value="tech">Technology/Software</option>
                        <option value="consulting">Consulting/Professional Services</option>
                        <option value="real-estate">Real Estate</option>
                        <option value="automotive">Automotive</option>
                        <option value="education">Education/Training</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label">AI Communication Tone</label>
                    <div class="grid-selection" id="toneGrid" data-type="single" data-name="tone">
                        <div class="grid-item1" data-value="professional">
                            <div class="grid-item-text">Professional</div>
                        </div>
                        <div class="grid-item1" data-value="approachable">
                            <div class="grid-item-text">Approachable</div>
                        </div>
                        <div class="grid-item1" data-value="engaging">
                            <div class="grid-item-text">Engaging</div>
                        </div>
                        <div class="grid-item1" data-value="helpful">
                            <div class="grid-item-text">Helpful</div>
                        </div>
                    </div>
                    <input type="hidden" name="tone" id="tone" required>
                </div>

                                <div class="form-group">
                    <label class="form-label" for="chatPurpose">Chat Purpose</label>
                    <textarea class="form-textarea" id="chatPurpose" name="chatPurpose"
                        placeholder="Describe how you'll use the chat (e.g., customer support, role-playing, task management)" required></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label" for="chatAudience">Target Users</label>
                    <textarea class="form-textarea" id="chatAudience" name="chatAudience">

                <div class="form-group">
                    <label class="form-label" for="contentRestrictions">Content Restrictions</label>
                    <textarea class="form-textarea" id="contentRestrictions" name="contentRestrictions"
                        placeholder="Any topics or responses the AI should avoid? (Applies to both chat and social replies)"></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label" for="chatWidgetName">Chat Widget Name</label>
                    <input type="text" class="form-input" id="chatWidgetName" name="chatWidgetName"
                        placeholder="e.g., INEXASLI Assistant, Support Bot">
                </div>

                <div class="form-group">
                    <label class="form-label">Chat Widget Colors</label>
                    <div class="grid-selection" id="colorGrid" data-type="single" data-name="chatColors">
                        <div class="grid-item1" data-value="professional-dark">
                            <div class="grid-item-text">Professional Dark</div>
                        </div>
                        <div class="grid-item1" data-value="modern-blue">
                            <div class="grid-item-text">Modern Blue</div>
                        </div>
                        <div class="grid-item1" data-value="warm-green">
                            <div class="grid-item-text">Warm Green</div>
                        </div>
                        <div class="grid-item1" data-value="vibrant-purple">
                            <div class="grid-item-text">Vibrant Purple</div>
                        </div>
                        <div class="grid-item1" data-value="custom">
                            <div class="grid-item-text">Custom Colors</div>
                        </div>
                    </div>
                    <input type="hidden" name="chatColors" id="chatColors">
                </div>

                <div class="form-group">
                    <label class="form-label" for="knowledgeBase">Knowledge Base Documents</label>
                    <input type="file" class="form-input" id="knowledgeBase" name="knowledgeBase" multiple
                        accept=".pdf,.doc,.docx,.txt,.md">
                    <small style="color: rgba(255,255,255,0.7); font-size: 12px;">Upload documents for AI training (PDF, DOC, TXT, MD)</small>
                </div>
            </div>
            </div>

            <!-- Reply Logic Configuration Section -->
            <div class="package-card collapsed" id="replySection" style="display: none;">
                <div class="package-header">
                    <h3 class="card-title">Social Media Reply Configuration</h3>
                    <div class="card-status">
                        <span class="status-text">To Do</span>
                    </div>
                </div>
                <div class="card-content">

                <div class="form-group">
                    <label class="form-label" for="replyGuidelines">Comment Reply Guidelines</label>
                    <textarea class="form-textarea" id="replyGuidelines" name="replyGuidelines"
                        placeholder="Specific guidelines for how the AI should respond to comments on social media posts (e.g., always be positive, focus on engagement, maintain brand voice)" required></textarea>
                </div>

                <div class="form-group">
                    <label class="form-label" for="platformConsiderations">Platform Considerations</label>
                    <textarea class="form-textarea" id="platformConsiderations" name="platformConsiderations"
                        placeholder="Platform-specific considerations for comment replies (e.g., Instagram comments should be under 900 characters, Twitter replies should be concise)" required></textarea>
                </div>
            </div>
            </div>

        </div><!-- Close package-cards -->

        <div class="consultation-box">
            <div class="consultation-text">
                <strong>Want personalized consultation?</strong><br>
                Schedule a 15-minute brand strategy call for enhanced customization
            </div>
            <a href="#" class="btn-consultation" onclick="scheduleConsultation()">
                📞 Schedule Call (Optional)
            </a>
        </div>
 
        <!-- Continue Button -->
        <button class="package-continue-btn" onclick="submitCustomizationForm()">Continue to Quote</button>
        

        <!-- Back Button -->
        <a href="packages.html" class="btn-back">← Back to Packages</a>

          
    
        <!-- Legal Footer -->
        <div style="text-align: center; margin: 10px 0 20px 0; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
            <p style="color: #ccc; font-size: 12px; margin: 0;">
                <a href="#" onclick="showSocialTerms(); return false;" style="color: #4CAF50; text-decoration: none;">Terms of Service</a>
                • 
                <a href="#" onclick="showSocialPrivacy(); return false;" style="color: #4CAF50; text-decoration: none;">Privacy Policy</a>
                • Contact: support@inexasli.com
            </p>
        </div>
    
    </div><!-- Close device-container -->         
            
         
       
    
    
    
    <script>
        // Splash screen transition
        document.addEventListener('DOMContentLoaded', function() {
            const splash = document.getElementById('splashContainer');
            const main = document.getElementById('mainContent');
            
            if (!splash || !main) {
                console.error('Splash or main content elements not found');
                return;
            }
            
            // Start main content fade-in immediately
            main.style.transition = 'opacity 1.2s ease-in';
            
            setTimeout(() => {
                // Start crossfade
                main.style.opacity = '1';
                splash.style.opacity = '0';
                splash.style.transition = 'opacity 1.2s ease-out';
                
                setTimeout(() => {
                    splash.style.display = 'none';
                    main.style.position = 'static';
                    main.style.left = 'auto';
                    main.style.transform = 'none';
                    main.style.top = 'auto';
                }, 1200);
            }, 1500); // Show splash for 1.5 seconds
        });
    </script>
    
    <script>
        // Global function for checking card completion
        function checkCardCompletion(card) {
            const grids = card.querySelectorAll('.grid-selection');
            let allGridsCompleted = true;
            grids.forEach(grid => {
                const items = grid.querySelectorAll('.grid-item1');
                const hasSelection = Array.from(items).some(i => i.classList.contains('selected'));
                if (!hasSelection) allGridsCompleted = false;
            });
            
            // Also check required form elements (selects and inputs)
            const requiredSelects = card.querySelectorAll('select[required]');
            let allSelectsCompleted = true;
            requiredSelects.forEach(select => {
                if (!select.value) allSelectsCompleted = false;
            });
            
            const requiredInputs = card.querySelectorAll('input[required]');
            let allInputsCompleted = true;
            requiredInputs.forEach(input => {
                if (!input.value) allInputsCompleted = false;
            });
            
            const requiredTextareas = card.querySelectorAll('textarea[required]');
            let allTextareasCompleted = true;
            requiredTextareas.forEach(textarea => {
                if (!textarea.value.trim()) allTextareasCompleted = false;
            });
            
            // Check for day toggles (at least one must be active)
            const dayToggles = card.querySelectorAll('.day-toggle');
            let hasActiveDayToggle = true; // Default to true if no day toggles exist
            if (dayToggles.length > 0) {
                hasActiveDayToggle = Array.from(dayToggles).some(toggle => toggle.classList.contains('active'));
            }
            
            const isComplete = allGridsCompleted && allSelectsCompleted && allInputsCompleted && allTextareasCompleted && hasActiveDayToggle;
            
            if (isComplete) {
                card.classList.add('completed');
                const statusText = card.querySelector('.status-text');
                if (statusText) statusText.textContent = '✓';
            } else {
                card.classList.remove('completed');
                const statusText = card.querySelector('.status-text');
                if (statusText) statusText.textContent = 'To Do';
            }
        }
    </script>
    
    <script>
        // Grid selection functionality
        document.addEventListener('DOMContentLoaded', function() {
            const gridSelections = document.querySelectorAll('.grid-selection');
            
            gridSelections.forEach(grid => {
                const type = grid.dataset.type; // 'single' or 'multiple'
                const name = grid.dataset.name;
                const items = grid.querySelectorAll('.grid-item1');
                
                items.forEach(item => {
                    item.addEventListener('click', function() {
                        const value = this.dataset.value;
                        
                        if (type === 'single') {
                            // Single selection - clear others and select this one
                            items.forEach(i => i.classList.remove('selected'));
                            this.classList.add('selected');
                            
                            // Update hidden input
                            const hiddenInput = document.getElementById(name);
                            if (hiddenInput) {
                                hiddenInput.value = value;
                            }
                        } else {
                            // Multiple selection - toggle this item
                            this.classList.toggle('selected');
                            
                            // Update form data (will be handled in form submission)
                        }
                        
                        // Check card completion
                        const card = this.closest('.package-card');
                        if (card) checkCardCompletion(card);
                    });
                });
            });
            
            // Add listeners for required form elements
            const requiredSelects = document.querySelectorAll('select[required]');
            requiredSelects.forEach(select => {
                select.addEventListener('change', function() {
                    const card = this.closest('.package-card');
                    if (card) checkCardCompletion(card);
                });
            });
            
            const requiredInputs = document.querySelectorAll('input[required]');
            requiredInputs.forEach(input => {
                input.addEventListener('input', function() {
                    const card = this.closest('.package-card');
                    if (card) checkCardCompletion(card);
                });
            });
            
            const requiredTextareas = document.querySelectorAll('textarea[required]');
            requiredTextareas.forEach(textarea => {
                textarea.addEventListener('input', function() {
                    const card = this.closest('.package-card');
                    if (card) checkCardCompletion(card);
                });
            });
            
            // Load selected package and adapt form
            const packageData = localStorage.getItem('quoteData');
            console.log('Package data from localStorage:', packageData);
            
            if (packageData) {
                const quoteData = JSON.parse(packageData);
                const selectedPackage = quoteData.package;
                console.log('Selected package:', selectedPackage);
                console.log('Package type:', selectedPackage.type);
                
                // Optional: Add package info to page
                const subtitle = document.querySelector('.setup-subtitle');
                if (subtitle) {
                    subtitle.textContent = `Configure your AI chat and reply assistants for your business needs (Customizing ${selectedPackage.name})`;
                }
                
                // Show/hide sections based on selected package
                const packageType = selectedPackage.type; // 'basic', 'social', 'pro', 'enterprise'
                
                // Business category selection (shown for all packages since they all include chat)
                const businessCategoryGroup = document.getElementById('businessCategoryGroup');
                if (businessCategoryGroup) businessCategoryGroup.style.display = 'block';
                
                // Hide all config sections by default
                const conversationalSection = document.getElementById('conversationalSection');
                const replySection = document.getElementById('replySection');
                const socialSection = document.getElementById('socialSection');
                
                console.log('Section elements found:', {
                    conversational: !!conversationalSection,
                    reply: !!replySection,
                    social: !!socialSection
                });
                
                console.log('Conversational element details:', conversationalSection);
                console.log('All elements with package-card class:', document.querySelectorAll('.package-card'));
                
                if (conversationalSection) {
                    console.log('Setting conversationalSection display to none');
                    conversationalSection.style.display = 'none';
                }
                if (replySection) {
                    console.log('Setting replySection display to none');
                    replySection.style.display = 'none';
                }
                if (socialSection) {
                    console.log('Setting socialSection display to none');
                    socialSection.style.display = 'none';
                }
                
                // Show sections based on package type
                if (packageType === 'basic') {
                    // Basic Chat: Show conversational AI config
                    console.log('Showing Basic Chat sections');
                    if (conversationalSection) conversationalSection.style.display = 'block';
                } else if (packageType === 'social') {
                    // Social Starter: Show social media + conversational AI config
                    console.log('Showing Social Starter sections');
                    if (socialSection) socialSection.style.display = 'block';
                    if (conversationalSection) conversationalSection.style.display = 'block';
                } else if (packageType === 'pro') {
                    // Pro Bundle: Show all configs
                    console.log('Showing Pro Bundle sections');
                    if (socialSection) socialSection.style.display = 'block';
                    if (conversationalSection) conversationalSection.style.display = 'block';
                    if (replySection) replySection.style.display = 'block';
                } else if (packageType === 'enterprise') {
                    // Enterprise: Show all configs
                    console.log('Showing Enterprise sections');
                    if (socialSection) socialSection.style.display = 'block';
                    if (conversationalSection) conversationalSection.style.display = 'block';
                    if (replySection) replySection.style.display = 'block';
                }
                
                const title = document.querySelector('.setup-title');
                if (title) title.textContent = 'Custom AI Automation';
            } else {
                console.log('No package data found in localStorage');
            }
            
            // After form persistence loads, check completion status of all cards
            setTimeout(() => {
                const allCards = document.querySelectorAll('.package-card');
                allCards.forEach(card => {
                    checkCardCompletion(card);
                });
            }, 300); // Delay to ensure form persistence has loaded
        });

        // Posting schedule functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Day toggle functionality
            const dayToggles = document.querySelectorAll('.day-toggle');
            dayToggles.forEach(toggle => {
                toggle.addEventListener('click', function() {
                    this.classList.toggle('active');
                    // Update hidden input for form persistence
                    const postingScheduleInput = document.getElementById('postingSchedule');
                    if (postingScheduleInput) {
                        const activeDays = Array.from(document.querySelectorAll('.day-toggle.active')).map(t => t.dataset.day);
                        postingScheduleInput.value = JSON.stringify(activeDays);
                    }
                    // Check completion status of the social media card
                    const socialCard = document.querySelector('.package-card[data-section="social"]');
                    if (socialCard) {
                        console.log('Found social card, checking completion');
                        checkCardCompletion(socialCard);
                    } else {
                        console.log('Social card not found');
                    }
                });
            });
            
            // Form section collapse/expand functionality
            const sectionTitles = document.querySelectorAll('.package-card');
            sectionTitles.forEach(card => {
                card.addEventListener('click', function(e) {
                    // Prevent collapse when clicking on form elements
                    if (e.target.tagName === 'INPUT' || e.target.tagName === 'SELECT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'BUTTON' || e.target.closest('.grid-item1') || e.target.closest('.day-toggle')) {
                        return;
                    }
                    e.preventDefault();
                    e.stopPropagation();
                    this.classList.toggle('collapsed');
                });
            });
        });

        function collectPostingSchedule() {
            const activeDays = Array.from(document.querySelectorAll('.day-toggle.active')).map(toggle => toggle.dataset.day);
            return activeDays;
        }

        function submitCustomizationForm() {
            // Collect form data manually since no form element
            const setupData = {};
            
            // Handle regular input fields
            const inputs = document.querySelectorAll('input[name], select[name], textarea[name]');
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    setupData[input.name] = input.checked;
                } else if (input.type === 'file') {
                    setupData[input.name] = input.files[0];
                } else {
                    setupData[input.name] = input.value;
                }
            });
            
            // Handle grid selections
            const toneGrid = document.querySelector('[data-name="tone"]');
            const selectedTone = toneGrid.querySelectorAll('.grid-item1.selected');
            setupData.tone = selectedTone.length > 0 ? selectedTone[0].dataset.value : null;
            
            const colorGrid = document.querySelector('[data-name="chatColors"]');
            const selectedColor = colorGrid.querySelectorAll('.grid-item1.selected');
            setupData.chatColors = selectedColor.length > 0 ? selectedColor[0].dataset.value : null;
            
            // Collect posting schedule
            setupData.postingSchedule = collectPostingSchedule();
            
            // Validate required fields
            if (!setupData.businessCategory) {
                alert('Please select a business category.');
                return;
            }
            
            if (!setupData.tone) {
                alert('Please select a chat tone.');
                return;
            }
            
            if (!setupData.chatPurpose || !setupData.chatAudience) {
                alert('Please fill in the chat purpose and target users.');
                return;
            }
            
            if (!setupData.replyGuidelines || !setupData.platformConsiderations) {
                alert('Please fill in reply guidelines and platform considerations.');
                return;
            }
            
            if (!setupData.postingSchedule || setupData.postingSchedule.length === 0) {
                alert('Please select at least one day for posting.');
                return;
            }
            
            if (!setupData.scheduleDetails) {
                alert('Please fill in your schedule details and preferences.');
                return;
            }
            
            if (!setupData.contentFocus || !setupData.targetAudience) {
                alert('Please fill in content focus and target audience.');
                return;
            }
            
            // Store customization data for Stripe integration
            setJSON('customizationData', setupData);
            
            // Redirect to quote page
            window.location.href = 'quote.html';
        }

        function scheduleConsultation() {
            // TODO: Integrate with Calendly or your scheduling system
            alert('Consultation scheduling coming soon! We\'ll contact you within 2-5 days.');
        }
    </script>
    
    <script src="../../utility/modal.js"></script>
    <script src="../legal/legalSocial.js"></script>
    <script src="step-indicator.js"></script>
    <script type="module">
        import { BusinessFormPersistence } from './businessFormPersistence.js';
        import { setJSON } from '../../utility/setJSON.js';
        
        // Make setJSON available globally for the form submission function
        window.setJSON = setJSON;
        
        // Initialize form persistence for customization form after a short delay
        // to ensure grid selection event listeners are set up
        setTimeout(() => {
            const customizationPersistence = new BusinessFormPersistence('mainContent', 'customization-form-data');
            customizationPersistence.init();
        }, 100);
    </script>
</body>
</html>

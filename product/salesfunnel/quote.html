<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Your Quote - INEXASLI</title>
    <link rel="stylesheet" href="salesflow.css">
    <link rel="icon" href="../../images/favicon.ico" type="image/x-icon">
</head>
<body>
    <div class="splash-container" id="splashContainer" style="padding-top: 40px; position: absolute; top: 0; left: 0; width: 100%; z-index: 2;">
        <img src="../../images/favicon.svg" alt="INEXASLI Logo" class="splash-logo" style="margin-top: 20px;">
    </div>

    <div class="device-container" id="mainContent" style="opacity: 0; display: block; z-index: 1;">
            
            <!-- Step Indicator -->
            <div class="step-indicator-placeholder"></div>

            <!-- Page Title -->
            <h1 class="page-title">Review Monthly Plan</h1>
            <p class="page-subtitle">Confirm your monthly subscription details before proceeding to payment</p>

            <!-- Quote Box -->
            <div class="quote-box">
                <h3 class="quote-box-title">Plan Summary</h3>
                
                <!-- Package Features Cards -->
                <div id="packageFeaturesCards">
                    <!-- Feature cards will be inserted here -->
                </div>
                
                <!-- Package Price Line -->
                <div class="quote-line package-line">
                    <span class="quote-line-label" id="packageNameLabel">Enterprise Package</span>
                    <span class="quote-line-amount" id="packagePriceAmount">$499/month</span>
                </div>
                
                <!-- Add-ons Lines -->
                <div id="addonsLines">
                    <!-- Add-on lines will be inserted here -->
                </div>

                <!-- Overall Total -->
                <div class="quote-total">
                    <span class="quote-total-label">Monthly Total</span>
                    <span class="quote-total-amount" id="totalAmount">$197/month</span>
                </div>
            </div>

            <!-- Payment Disclaimer -->
            <div class="payment-disclaimer">
                By proceeding, you agree to our <a href="#" onclick="showTerms()">Terms of Service</a> and <a href="#" onclick="showPrivacy()">Privacy Policy</a>.
                Your payment information is secured with bank-level encryption.
            </div>

            <!-- Proceed Button -->
            <button class="proceed-button" onclick="proceedToPayment()" style="margin-top: 20px;">Proceed to Payment</button>

            <!-- Back Button -->
            <a href="customization.html" class="btn-back">← Back to Customization</a>

<!-- Legal Footer -->
<div style="text-align: center; margin: 10px 0 20px 0; padding-top: 20px; border-top: 1px solid rgba(255,255,255,0.1);">
    <p style="color: #ccc; font-size: 12px; margin: 0;">
        <a href="#" onclick="showSocialTerms(); return false;" style="color: #4CAF50; text-decoration: none;">Terms of Service</a>
        • 
        <a href="#" onclick="showSocialPrivacy(); return false;" style="color: #4CAF50; text-decoration: none;">Privacy Policy</a>
        • Contact: support@inexasli.com
    </p>
</div>

</div>
    
    <script>
        // Splash screen transition
        const splash = document.getElementById('splashContainer');
        const main = document.getElementById('mainContent');
        
        // Start main content fade-in immediately
        main.style.transition = 'opacity 1.2s ease-in';
        
        setTimeout(() => {
            // Start crossfade
            main.style.opacity = '1';
            splash.style.opacity = '0';
            splash.style.transition = 'opacity 1.2s ease-out';
            
            setTimeout(() => {
                splash.style.display = 'none';
                main.style.position = 'static';
            }, 1200);
        }, 1500); // Show splash for 1.5 seconds

        // Load quote data on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadQuoteData();
        });

        let quoteData = null;

        function loadQuoteData() {
            const data = localStorage.getItem('quoteData');
            if (data) {
                quoteData = JSON.parse(data);
                displayQuote();
            } else {
                // Redirect back if no quote data
                window.location.href = 'packages.html';
            }
        }

        function displayQuote() {
            if (!quoteData) return;

            const { package: pkg, addons, platforms, total } = quoteData;

            // Get monthly fee from package data or fallback to calculation
            const monthlyFee = pkg.monthlyPrice || getMonthlyFee(pkg.type);
            
            // Package price is no longer used (subscription-only)

            // Get included addons for this package type
            const includedAddonIds = getIncludedAddons(pkg.type);
            
            // Separate addons into included (free) and extra (paid)
            const includedAddons = addons.filter(addon => includedAddonIds.includes(addon.id));
            const extraAddons = addons.filter(addon => !includedAddonIds.includes(addon.id));

            // Update package name and price in plan summary
            document.getElementById('packageNameLabel').textContent = `${pkg.name || pkg.type.charAt(0).toUpperCase() + pkg.type.slice(1)} Package`;
            document.getElementById('packagePriceAmount').textContent = `$${monthlyFee}/month`;

            // Add included addon lines (marked as included)
            const addonsContainer = document.getElementById('addonsLines');
            addonsContainer.innerHTML = '';
            
            includedAddons.forEach(addon => {
                const addonLine = document.createElement('div');
                addonLine.className = 'quote-line included-addon';
                
                addonLine.innerHTML = `
                    <span class="quote-line-label">${getAddonName(addon)}</span>
                    <span class="quote-line-amount included-text">Included</span>
                `;
                addonsContainer.appendChild(addonLine);
            });

            // Add extra addon lines (charged)
            extraAddons.forEach(addon => {
                const addonLine = document.createElement('div');
                addonLine.className = 'quote-line';
                
                // Display add-on price with correct sign
                const priceDisplay = addon.price >= 0 
                    ? `+$${addon.price}/month` 
                    : `-$${Math.abs(addon.price)}/month`;
                
                addonLine.innerHTML = `
                    <span class="quote-line-label">${getAddonName(addon)}</span>
                    <span class="quote-line-amount">${priceDisplay}</span>
                `;
                addonsContainer.appendChild(addonLine);
            });

            // Calculate monthly recurring total (base monthly + extra add-ons only)
            const extraAddonsTotal = extraAddons.reduce((sum, addon) => sum + addon.price, 0);
            const monthlyRecurringTotal = monthlyFee + extraAddonsTotal;
            
            // Update overall total (monthly subscription only)
            const totalDueToday = monthlyRecurringTotal;
            document.getElementById('totalAmount').textContent = `$${totalDueToday}/month`;

            // Update package features as cards within quote
            const featuresContainer = document.getElementById('packageFeaturesCards');
            featuresContainer.innerHTML = pkg.features.map(feature => 
                `<div class="core-feature" style="margin: 8px 0; display: block;">${feature}</div>`
            ).join('');
        }

        function getMonthlyFee(packageType) {
            const fees = { starter: 127, professional: 197, enterprise: 297 };
            return fees[packageType] || 197;
        }

        function getAddonName(addon) {
            if (addon.name) return addon.name;
            
            // Fallback: derive name from ID
            const nameMap = {
                'photos-10': '+10 Photo Storage',
                'videos-5': '+5 Video Storage', 
                'iterations-extra': '+10 Content Refinements',
                'ai-content-generation': 'AI Content Generation',
                'white-label-chat': 'White-label Chat',
                'basic-scheduling': 'Basic Scheduling Only',
                'reduced-frequency': 'Reduced Posting Frequency'
            };
            
            return nameMap[addon.id] || addon.id;
        }

        function getIncludedAddons(packageType) {
            if (packageType === 'social') return ['photos-10', 'videos-5'];
            if (packageType === 'pro') return ['photos-10', 'videos-5', 'iterations-extra', 'ai-content-generation'];
            if (packageType === 'enterprise') return ['photos-10', 'videos-5', 'iterations-extra', 'ai-content-generation', 'white-label-chat'];
            return [];
        }

        function proceedToPayment() {
            if (!quoteData) {
                alert('Quote data not found');
                return;
            }

            // Store final order data
            const orderData = {
                ...quoteData,
                monthlyFee: getMonthlyFee(quoteData.package.type),
                orderDate: new Date().toISOString(),
                orderId: 'ORD-' + Math.random().toString(36).substr(2, 9).toUpperCase()
            };

            localStorage.setItem('orderData', JSON.stringify(orderData));

            // Redirect to payment page
            window.location.href = 'payment.html';
        }

        function showTerms() {
            showSocialTerms();
        }

        function showPrivacy() {
            showSocialPrivacy();
        }
    </script>
    
    <!-- Splash Screen Transition Script -->
    <script>
        // Splash screen transition
        document.addEventListener('DOMContentLoaded', function() {
            const splash = document.getElementById('splashContainer');
            const main = document.getElementById('mainContent');
            
            // Start main content fade-in immediately
            main.style.transition = 'opacity 1.2s ease-in';
            
            setTimeout(() => {
                // Start crossfade
                main.style.opacity = '1';
                splash.style.opacity = '0';
                splash.style.transition = 'opacity 1.2s ease-out';
                
                setTimeout(() => {
                    splash.style.display = 'none';
                    main.style.position = 'static';
                    main.style.left = 'auto';
                    main.style.transform = 'none';
                }, 1200);
            }, 1500); // Show splash for 1.5 seconds
        });
    </script>
    
    <script src="../../utility/modal.js"></script>
    <script src="../legal/legalSocial.js"></script>
    <script src="step-indicator.js"></script>
</body>
</html>

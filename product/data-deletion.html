<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Deletion Instructions - INEXASLI</title>
    <script src="/utility/modal.js"></script>
    <script src="/product/legal/legalSocial.js"></script>
    <style>
        .deletion-status {
            background: rgba(255, 255, 255, 0.9);
            border: 2px solid #10b981;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
            text-align: center;
        }
        .deletion-status h3 {
            color: #059669;
            margin-top: 0;
        }
        .status-processing {
            border-color: #f59e0b;
        }
        .status-processing h3 {
            color: #d97706;
        }
        .status-completed {
            border-color: #10b981;
        }
        .status-completed h3 {
            color: #059669;
        }
    </style>
</head>
<body>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Check for deletion request parameters
            const urlParams = new URLSearchParams(window.location.search);
            const requestId = urlParams.get('request_id');
            const platform = urlParams.get('platform');

            if (requestId && platform) {
                // Show deletion status instead of general instructions
                showDeletionStatus(requestId, platform);
            } else {
                // Show general data deletion instructions
                showSocialDataDeletion();
            }
        });

        async function showDeletionStatus(requestId, platform) {
            console.log('[DataDeletion] Checking status for request:', requestId, 'platform:', platform);

            try {
                // Check deletion status from OAuth worker
                const response = await fetch(`https://oauth.4hm7q4q75z.workers.dev/oauth/deletion-status?request_id=${requestId}&platform=${platform}`);
                const statusData = await response.json();

                let statusHtml = '';

                if (statusData.status === 'processing') {
                    statusHtml = `
                        <div class="deletion-status status-processing">
                            <h3>üîÑ Data Deletion In Progress</h3>
                            <p>Your data deletion request for ${platform} has been received and is being processed.</p>
                            <p><strong>Request ID:</strong> ${requestId}</p>
                            <p><strong>Status:</strong> Processing (usually takes 1-2 business days)</p>
                            <p>You will receive an email confirmation when the deletion is complete.</p>
                        </div>
                    `;
                } else if (statusData.status === 'completed') {
                    statusHtml = `
                        <div class="deletion-status status-completed">
                            <h3>‚úÖ Data Deletion Completed</h3>
                            <p>Your data deletion request for ${platform} has been successfully processed.</p>
                            <p><strong>Request ID:</strong> ${requestId}</p>
                            <p><strong>Records Deleted:</strong> ${statusData.deletedRecords || 'N/A'}</p>
                            <p><strong>Completed:</strong> ${new Date(statusData.completedTime || Date.now()).toLocaleDateString()}</p>
                            <p>You should have received a confirmation email.</p>
                        </div>
                    `;
                } else {
                    statusHtml = `
                        <div class="deletion-status">
                            <h3>‚ùì Request Status Unknown</h3>
                            <p>We couldn't find a deletion request with ID: ${requestId}</p>
                            <p>If you believe this is an error, please contact support@inexasli.com</p>
                        </div>
                    `;
                }

                // Show status modal
                window.openCustomModal(statusHtml + '<p style="text-align: center; margin-top: 20px;"><a href="/product/data-deletion.html" style="color: #10b981;">‚Üê Back to Data Deletion Instructions</a></p>', {
                    maxWidth: '500px'
                });

            } catch (error) {
                console.error('[DataDeletion] Error checking status:', error);
                const errorHtml = `
                    <div class="deletion-status">
                        <h3>‚ö†Ô∏è Error Checking Status</h3>
                        <p>There was an error checking your deletion request status.</p>
                        <p>Please try again later or contact support@inexasli.com</p>
                        <p><strong>Request ID:</strong> ${requestId}</p>
                    </div>
                    <p style="text-align: center; margin-top: 20px;"><a href="/product/data-deletion.html" style="color: #10b981;">‚Üê Back to Data Deletion Instructions</a></p>
                `;
                window.openCustomModal(errorHtml, {
                    maxWidth: '500px'
                });
            }
        }
    </script>
</body>
</html>

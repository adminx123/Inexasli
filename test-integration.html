<!DOCTYPE html>
<html>
<head>
    <title>FormPersistence + ImageUpload Integration Test</title>
</head>
<body>
    <h1>Testing FormPersistence + ImageUpload Integration</h1>
    <div id="test-results"></div>
    
    <!-- Mock container for image upload -->
    <div id="image-upload-container" class="image-upload-container" data-image-upload data-module="fashion" data-max-images="5"></div>
    
    <!-- Test button -->
    <button id="test-btn">Run Tests</button>

    <script type="module">
        // Import our modules
        import { FormPersistence } from './utility/formPersistence.js';
        
        const results = document.getElementById('test-results');
        
        function log(message) {
            const p = document.createElement('p');
            p.textContent = message;
            results.appendChild(p);
            console.log(message);
        }
        
        function testIntegration() {
            log('Starting FormPersistence + ImageUpload integration tests...');
            
            try {
                // Test 1: Create FormPersistence instance
                const fp = FormPersistence.getInstance('fashion');
                log('✓ FormPersistence instance created successfully');
                
                // Test 2: Check if image collection methods exist
                if (typeof fp.collectImages === 'function') {
                    log('✓ collectImages method exists');
                } else {
                    log('✗ collectImages method missing');
                }
                
                if (typeof fp.restoreImages === 'function') {
                    log('✓ restoreImages method exists');
                } else {
                    log('✗ restoreImages method missing');
                }
                
                // Test 3: Test image collection (should return empty array when no images)
                const images = fp.collectImages();
                log(`✓ collectImages returned: ${Array.isArray(images) ? images.length + ' images' : 'invalid result'}`);
                
                // Test 4: Test image restoration with mock data
                const mockImages = ['data:image/jpeg;base64,/9j/test1', 'data:image/png;base64,/9j/test2'];
                fp.restoreImages(mockImages);
                log('✓ restoreImages executed without errors');
                
                log('All tests completed successfully!');
                
            } catch (error) {
                log('✗ Error during testing: ' + error.message);
                console.error(error);
            }
        }
        
        document.getElementById('test-btn').addEventListener('click', testIntegration);
        
        // Auto-run tests after page loads
        window.addEventListener('load', () => {
            setTimeout(testIntegration, 1000);
        });
    </script>
    
    <!-- Load ImageUpload utility -->
    <script src="./utility/imageUpload.js"></script>
</body>
</html>
